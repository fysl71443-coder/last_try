# -*- coding: utf-8 -*-
"""
شجرة الحسابات النهائية المعتمدة (Final Chart of Accounts).
الفرع = بُعد (Dimension) في القيد/الفاتورة وليس في رقم الحساب.
"""

# كل عنصر: code, name_ar, name_en, type, parent_code, level
# type: ASSET | LIABILITY | EQUITY | REVENUE | EXPENSE | COGS | TAX
# الحسابات التجميعية (group) لا تُستخدم في القيود؛ فقط الورقية (leaf).

NEW_COA_TREE = [
    # 1000 – الأصول (Assets) – النسخة المعتمدة النهائية
    ("1000", "الأصول", "Assets", "ASSET", None, 1),
    ("1100", "أصول متداولة", "Current Assets", "ASSET", "1000", 2),
    ("1110", "النقد وما في حكمه", "Cash and Equivalents", "ASSET", "1100", 3),
    ("1111", "صندوق رئيسي", "Main Cash", "ASSET", "1110", 4),
    ("1112", "صندوق فرعي", "Sub Cash", "ASSET", "1110", 4),
    ("1113", "صندوق POS", "POS Cash", "ASSET", "1110", 4),
    ("1120", "البنوك", "Banks", "ASSET", "1100", 3),
    ("1121", "بنك الراجحي", "Al Rajhi Bank", "ASSET", "1120", 4),
    ("1122", "بنك الأهلي", "Al Ahli Bank", "ASSET", "1120", 4),
    ("1123", "بنك الرياض", "Riyad Bank", "ASSET", "1120", 4),
    ("1130", "الشيكات", "Cheques", "ASSET", "1100", 3),
    ("1131", "شيكات واردة", "Cheques Receivable", "ASSET", "1130", 4),
    ("1132", "شيكات تحت التحصيل", "Cheques in Collection", "ASSET", "1130", 4),
    ("1133", "شيكات مرتجعة", "Cheques Bounced", "ASSET", "1130", 4),
    ("1140", "الذمم المدينة", "Accounts Receivable", "ASSET", "1100", 3),
    ("1141", "عملاء", "Customers", "ASSET", "1140", 4),
    ("1142", "ذمم مدينة أخرى", "Other Receivables", "ASSET", "1140", 4),
    ("1143", "ديون مشكوك في تحصيلها", "Doubtful Debts", "ASSET", "1140", 4),
    # ذمم مدينة منصات (تحصيل مبيعات لم تُحوَّل بعد) – حسابان لكل منصة
    ("1144", "ذمم مدينة – هنقرستيشن (تحصيل)", "AR – Hungerstation (collection)", "ASSET", "1140", 4),
    ("1145", "ذمم مدينة – كيتا (تحصيل)", "AR – Keeta (collection)", "ASSET", "1140", 4),
    ("1146", "ذمم مدينة – جاهز (تحصيل)", "AR – Jahez (collection)", "ASSET", "1140", 4),
    ("1150", "سلف وعهد", "Advances & Custody", "ASSET", "1100", 3),
    ("1151", "سلف موظفين", "Employee Advances", "ASSET", "1150", 4),
    ("1152", "عهد نقدية", "Cash Custody", "ASSET", "1150", 4),
    ("1153", "عهد تشغيلية", "Operating Custody", "ASSET", "1150", 4),
    ("1160", "المخزون", "Inventory", "ASSET", "1100", 3),
    ("1161", "مخزون بضائع", "Goods Inventory", "ASSET", "1160", 4),
    ("1162", "مخزون مواد خام", "Raw Materials Inventory", "ASSET", "1160", 4),
    ("1163", "مخزون مواد تشغيلية", "Operating Materials Inventory", "ASSET", "1160", 4),
    ("1164", "مخزون تحت التشغيل", "Work in Progress", "ASSET", "1160", 4),
    ("1170", "ضريبة القيمة المضافة – مدخلات", "VAT Input", "ASSET", "1100", 3),
    ("1180", "أصول متداولة أخرى", "Other Current Assets", "ASSET", "1100", 3),
    ("1181", "مصروفات مدفوعة مقدماً", "Prepaid Expenses", "ASSET", "1180", 4),
    ("1182", "تأمينات مدفوعة", "Prepaid Insurance", "ASSET", "1180", 4),
    ("1183", "ودائع", "Deposits", "ASSET", "1180", 4),
    ("1200", "أصول غير متداولة", "Non-current Assets", "ASSET", "1000", 2),
    ("1210", "ممتلكات ومعدات", "Property & Equipment", "ASSET", "1200", 3),
    ("1211", "أجهزة", "Equipment", "ASSET", "1210", 4),
    ("1212", "أثاث", "Furniture", "ASSET", "1210", 4),
    ("1213", "سيارات", "Vehicles", "ASSET", "1210", 4),
    ("1214", "معدات مطبخ", "Kitchen Equipment", "ASSET", "1210", 4),
    ("1215", "تحسينات مستأجرة", "Leasehold Improvements", "ASSET", "1210", 4),
    ("1220", "مجمع الإهلاك", "Accumulated Depreciation", "ASSET", "1200", 3),
    ("1221", "مجمع إهلاك أجهزة", "Acc. Dep. Equipment", "ASSET", "1220", 4),
    ("1222", "مجمع إهلاك سيارات", "Acc. Dep. Vehicles", "ASSET", "1220", 4),
    ("1223", "مجمع إهلاك معدات", "Acc. Dep. Kitchen/Equipment", "ASSET", "1220", 4),
    ("1224", "مجمع إهلاك تحسينات", "Acc. Dep. Leasehold", "ASSET", "1220", 4),
    ("1230", "أصول غير ملموسة", "Intangible Assets", "ASSET", "1200", 3),
    ("1231", "برامج وأنظمة", "Software & Systems", "ASSET", "1230", 4),
    ("1232", "تراخيص", "Licenses", "ASSET", "1230", 4),
    ("2000", "الالتزامات", "Liabilities", "LIABILITY", None, 1),
    ("2100", "التزامات متداولة", "Current Liabilities", "LIABILITY", "2000", 2),
    ("2110", "الذمم الدائنة", "Accounts Payable", "LIABILITY", "2100", 3),
    ("2111", "موردون", "Suppliers", "LIABILITY", "2110", 4),
    ("2112", "ذمم دائنة أخرى", "Other Payables", "LIABILITY", "2110", 4),
    # استحقاق المنصات الإلكترونية – مجموعة فرعية تحت الذمم الدائنة
    ("2119", "استحقاق المنصات الإلكترونية", "Platform payables (accrual)", "LIABILITY", "2110", 4),
    ("2113", "ذمم دائنة – هنقرستيشن (عمولات)", "AP – Hungerstation (commissions)", "LIABILITY", "2119", 5),
    ("2114", "ذمم دائنة – كيتا (عمولات)", "AP – Keeta (commissions)", "LIABILITY", "2119", 5),
    ("2115", "ذمم دائنة – جاهز (عمولات)", "AP – Jahez (commissions)", "LIABILITY", "2119", 5),
    ("2116", "ذمم دائنة – نون (عمولات)", "AP – Noon (commissions)", "LIABILITY", "2119", 5),
    ("2120", "مستحقات موظفين", "Employee Payables", "LIABILITY", "2100", 3),
    ("2121", "رواتب مستحقة", "Salaries Payable", "LIABILITY", "2120", 4),
    ("2122", "بدلات مستحقة", "Allowances Payable", "LIABILITY", "2120", 4),
    ("2123", "إجازات مستحقة", "Leave Payable", "LIABILITY", "2120", 4),
    ("2124", "مكافآت مستحقة", "Bonuses Payable", "LIABILITY", "2120", 4),
    ("2130", "مستحقات حكومية", "Government Payables", "LIABILITY", "2100", 3),
    ("2131", "التأمينات الاجتماعية (GOSI)", "GOSI", "LIABILITY", "2130", 4),
    ("2132", "رسوم قوى", "Qowa Fees", "LIABILITY", "2130", 4),
    ("2133", "رسوم مقيم", "Muqeem Fees", "LIABILITY", "2130", 4),
    ("2134", "زكاة مستحقة", "Zakat Payable", "LIABILITY", "2130", 4),
    ("2135", "ضرائب حكومية أخرى", "Other Government Taxes", "LIABILITY", "2130", 4),
    ("2140", "ضرائب مستحقة", "Tax Payables", "LIABILITY", "2100", 3),
    ("2141", "ضريبة القيمة المضافة – مستحقة", "VAT Payable", "LIABILITY", "2140", 4),
    ("2142", "ضريبة مقتطعة", "Withholding Tax", "LIABILITY", "2140", 4),
    ("2143", "ضرائب أخرى", "Other Taxes", "LIABILITY", "2140", 4),
    ("2150", "مصروفات مستحقة", "Accrued Expenses", "LIABILITY", "2100", 3),
    ("2151", "كهرباء مستحقة", "Electricity Payable", "LIABILITY", "2150", 4),
    ("2152", "ماء مستحق", "Water Payable", "LIABILITY", "2150", 4),
    ("2153", "اتصالات مستحقة", "Telecom Payable", "LIABILITY", "2150", 4),
    ("2154", "إيجار مستحق", "Rent Payable", "LIABILITY", "2150", 4),
    ("2155", "صيانة مستحقة", "Maintenance Payable", "LIABILITY", "2150", 4),
    ("2160", "التزامات قصيرة الأجل أخرى", "Other Current Liabilities", "LIABILITY", "2100", 3),
    ("2161", "سلف موظفين دائنة", "Employee Advances Payable", "LIABILITY", "2160", 4),
    ("2162", "عربون عملاء", "Customer Deposits", "LIABILITY", "2160", 4),
    ("2163", "إيرادات غير مكتسبة", "Unearned Revenue", "LIABILITY", "2160", 4),
    ("2200", "التزامات غير متداولة", "Non-current Liabilities", "LIABILITY", "2000", 2),
    ("2210", "قروض طويلة الأجل", "Long-term Loans", "LIABILITY", "2200", 3),
    ("2211", "قرض بنكي طويل الأجل", "Long-term Bank Loan", "LIABILITY", "2210", 4),
    ("2212", "تمويل سيارات", "Vehicle Financing", "LIABILITY", "2210", 4),
    ("2213", "تمويل معدات", "Equipment Financing", "LIABILITY", "2210", 4),
    ("2220", "مخصصات", "Provisions", "LIABILITY", "2200", 3),
    ("2221", "مخصص مكافأة نهاية الخدمة", "End-of-Service Provision", "LIABILITY", "2220", 4),
    ("2222", "مخصص قضايا", "Legal Provisions", "LIABILITY", "2220", 4),
    # 3000 – حقوق الملكية (Equity) – النسخة المعتمدة
    ("3000", "حقوق الملكية", "Equity", "EQUITY", None, 1),
    ("3100", "رأس المال", "Capital", "EQUITY", "3000", 2),
    ("3110", "رأس مال المالك", "Owner Capital", "EQUITY", "3100", 3),
    ("3120", "زيادات رأس المال", "Capital Additions", "EQUITY", "3100", 3),
    ("3130", "تخفيضات رأس المال", "Capital Reductions", "EQUITY", "3100", 3),
    ("3200", "الأرباح المحتجزة", "Retained Earnings", "EQUITY", "3000", 2),
    ("3210", "أرباح سنوات سابقة", "Prior Years Earnings", "EQUITY", "3200", 3),
    ("3220", "أرباح السنة الحالية", "Current Year Earnings", "EQUITY", "3200", 3),
    ("3300", "جاري المالك", "Owner's Current", "EQUITY", "3000", 2),
    ("3310", "مسحوبات شخصية", "Owner Drawings", "EQUITY", "3300", 3),
    ("3320", "إضافات شخصية", "Owner Additions", "EQUITY", "3300", 3),
    ("3400", "الاحتياطيات", "Reserves", "EQUITY", "3000", 2),
    ("3410", "احتياطي نظامي", "Legal Reserve", "EQUITY", "3400", 3),
    ("3420", "احتياطي عام", "General Reserve", "EQUITY", "3400", 3),
    ("3500", "تسويات حقوق الملكية", "Equity Adjustments", "EQUITY", "3000", 2),
    ("3510", "فروقات تقييم", "Revaluation Reserve", "EQUITY", "3500", 3),
    ("3520", "فروقات تحويل عملة", "Currency Translation Reserve", "EQUITY", "3500", 3),
    # 4000 – الإيرادات (Revenue) – الفرع = بُعد في القيد/الفاتورة
    ("4000", "الإيرادات", "Revenue", "REVENUE", None, 1),
    ("4100", "الإيرادات التشغيلية", "Operating Revenue", "REVENUE", "4000", 2),
    ("4110", "مبيعات", "Sales", "REVENUE", "4100", 3),
    ("4111", "مبيعات CHINA TOWN", "Sales China Town", "REVENUE", "4110", 4),
    ("4112", "مبيعات PALACE INDIA", "Sales Palace India", "REVENUE", "4110", 4),
    ("4120", "إيرادات خدمات", "Service Revenue", "REVENUE", "4100", 3),
    ("4200", "إيرادات أخرى", "Other Revenue", "REVENUE", "4000", 2),
    ("4210", "إيرادات غير تشغيلية", "Non-operating Revenue", "REVENUE", "4200", 3),
    ("4211", "أرباح فروقات عملة", "Currency Gain", "REVENUE", "4200", 3),
    ("4212", "إيرادات بيع أصول", "Gain on Asset Disposal", "REVENUE", "4200", 3),
    ("4300", "خصومات مكتسبة", "Discounts Earned", "REVENUE", "4000", 2),
    ("4310", "خصم مكتسب من الموردين", "Discount from Suppliers", "REVENUE", "4300", 3),
    # 5000 – المصروفات (Expenses) – النسخة المعتمدة
    ("5000", "المصروفات", "Expenses", "EXPENSE", None, 1),
    # 1️⃣ تكلفة المبيعات (COGS) – تُعرض منفصلة في قائمة الدخل
    ("5100", "تكلفة المبيعات", "Cost of Sales", "COGS", "5000", 2),
    ("5110", "تكلفة مواد غذائية", "Food Cost", "COGS", "5100", 3),
    ("5120", "تكلفة مشروبات", "Beverage Cost", "COGS", "5100", 3),
    ("5130", "تكلفة مواد تغليف", "Packaging Cost", "COGS", "5100", 3),
    ("5140", "تكلفة مواد تنظيف", "Cleaning Supplies Cost", "COGS", "5100", 3),
    ("5150", "تكلفة مواد تشغيل أخرى", "Other Operating Materials Cost", "COGS", "5100", 3),
    # 2️⃣ المصروفات التشغيلية
    ("5200", "المصروفات التشغيلية", "Operating Expenses", "EXPENSE", "5000", 2),
    ("5210", "مصروف كهرباء", "Electricity", "EXPENSE", "5200", 3),
    ("5215", "مصروف غاز", "Gas", "EXPENSE", "5200", 3),
    ("5220", "مصروف ماء", "Water", "EXPENSE", "5200", 3),
    ("5230", "مصروف اتصالات وإنترنت", "Telecom & Internet", "EXPENSE", "5200", 3),
    ("5240", "مصروف صيانة", "Maintenance", "EXPENSE", "5200", 3),
    ("5242", "صيانة أجهزة", "Equipment maintenance", "EXPENSE", "5200", 3),
    ("5245", "صيانة مباني", "Building maintenance", "EXPENSE", "5200", 3),
    ("5250", "مصروف نظافة", "Cleaning", "EXPENSE", "5200", 3),
    ("5255", "مصروف خدمات أمنية", "Security services", "EXPENSE", "5200", 3),
    ("5260", "مصروف نقل وتوصيل", "Transport & Delivery", "EXPENSE", "5200", 3),
    # مصروفات منصات البيع: توصيل طلبات عبر المنصات
    ("5265", "مصروف توصيل طلبات", "Order delivery expense", "EXPENSE", "5200", 3),
    ("5270", "مصروف إيجار", "Rent", "EXPENSE", "5200", 3),
    ("5275", "ضرائب عقارات", "Property tax", "EXPENSE", "5200", 3),
    ("5278", "مصروف تأمين على الممتلكات", "Property insurance", "EXPENSE", "5200", 3),
    ("5280", "مصروف أدوات ومستهلكات", "Tools & Consumables", "EXPENSE", "5200", 3),
    # 3️⃣ مصروفات الموارد البشرية
    ("5300", "مصروفات الموارد البشرية", "HR Expenses", "EXPENSE", "5000", 2),
    ("5310", "رواتب وأجور", "Salaries & Wages", "EXPENSE", "5300", 3),
    ("5315", "رواتب مؤقتة ومتعاقدين", "Temporary & contract labour", "EXPENSE", "5300", 3),
    ("5320", "بدلات", "Allowances", "EXPENSE", "5300", 3),
    ("5330", "مكافآت وحوافز", "Bonuses & Incentives", "EXPENSE", "5300", 3),
    ("5340", "تأمينات اجتماعية", "Social Insurance", "EXPENSE", "5300", 3),
    ("5350", "نهاية خدمة", "End of Service", "EXPENSE", "5300", 3),
    ("5360", "تدريب الموظفين", "Employee Training", "EXPENSE", "5300", 3),
    # 4️⃣ المصروفات الإدارية والعمومية
    ("5400", "مصروفات إدارية وعمومية", "G&A", "EXPENSE", "5000", 2),
    ("5410", "مصروفات حكومية ورسوم", "Government & Fees", "EXPENSE", "5400", 3),
    ("5420", "مصروف قرطاسية ومكتبية", "Stationery & Office", "EXPENSE", "5400", 3),
    ("5430", "مصروف اشتراكات وأنظمة", "Subscriptions & Systems", "EXPENSE", "5400", 3),
    # اشتراكات منصات وإلكترونية
    ("5435", "مصروف اشتراكات إلكترونية", "Electronic subscriptions", "EXPENSE", "5400", 3),
    ("5440", "مصروف استشارات قانونية", "Legal Consultancy", "EXPENSE", "5400", 3),
    ("5445", "مصروف استشارات", "Consultancy", "EXPENSE", "5400", 3),
    ("5450", "مصروف محاسبة وتدقيق", "Accounting & Audit", "EXPENSE", "5400", 3),
    ("5460", "مصروف غرامات ومخالفات", "Fines & Violations", "EXPENSE", "5400", 3),
    ("5470", "مصروفات متنوعة إدارية", "Miscellaneous Admin", "EXPENSE", "5400", 3),
    # 5️⃣ المصروفات البيعية والتسويقية (خصم ممنوح → هنا)
    ("5500", "مصروفات بيعية وتسويقية", "Selling & Marketing", "EXPENSE", "5000", 2),
    ("5510", "دعاية وإعلان", "Advertising", "EXPENSE", "5500", 3),
    ("5512", "مطبوعات تسويقية", "Print materials", "EXPENSE", "5500", 3),
    ("5515", "إعلانات التواصل الاجتماعي", "Social media advertising", "EXPENSE", "5500", 3),
    ("5520", "عمولات بيع", "Sales Commissions", "EXPENSE", "5500", 3),
    ("5530", "مصروف حملات تسويق", "Marketing Campaigns", "EXPENSE", "5500", 3),
    ("5535", "هدايا ترويجية", "Promotional gifts", "EXPENSE", "5500", 3),
    ("5540", "خصم ممنوح للعملاء", "Discount Granted to Customers", "EXPENSE", "5500", 3),
    # عمولات منصات البيع الإلكتروني (هنقرستيشن، كيتا، جاهز، وغيرها)
    ("5550", "مصروف عمولات منصات بيع", "Platform sales commissions", "EXPENSE", "5500", 3),
    ("5555", "مصروف خدمات منصات إلكترونية", "Platform services expense", "EXPENSE", "5500", 3),
    # 6️⃣ المصروفات البنكية والمالية (بدون 5310 فوائد بنكية ❌)
    ("5600", "مصروفات مالية وبنكية", "Financial & Banking", "EXPENSE", "5000", 2),
    ("5610", "مصروفات بنكية", "Bank Charges", "EXPENSE", "5600", 3),
    ("5620", "رسوم تحويل", "Transfer Fees", "EXPENSE", "5600", 3),
    ("5630", "فروقات عملة", "Currency Differences", "EXPENSE", "5600", 3),
    # 7️⃣ مصروفات أخرى (غير تشغيلية)
    ("5700", "مصروفات أخرى", "Other Expenses", "EXPENSE", "5000", 2),
    ("5710", "خسائر أصول", "Asset Losses", "EXPENSE", "5700", 3),
    ("5720", "تبرعات", "Donations", "EXPENSE", "5700", 3),
    ("5730", "شطب ديون معدومة", "Bad Debt Write-off", "EXPENSE", "5700", 3),
    ("5810", "مصروف فروقات جرد", "Inventory Variance Expense", "EXPENSE", "5700", 3),
    ("5820", "مصروف فروقات نقدية", "Cash Variance Expense", "EXPENSE", "5700", 3),
    # 0006 – حسابات نظامية (تسويات / ترحيل / إقفال – لا تظهر في التقارير)
    ("0006", "حسابات نظامية", "System Accounts", "ASSET", None, 1),
]

# رموز الحسابات الورقية فقط (تُستخدم في القيود).
LEAF_CODES = {
    "1111", "1112", "1113", "1121", "1122", "1123",
    "1131", "1132", "1133", "1141", "1142", "1143", "1144", "1145", "1146",
    "1151", "1152", "1153", "1161", "1162", "1163", "1164",
    "1170", "1181", "1182", "1183",
    "1211", "1212", "1213", "1214", "1215", "1221", "1222", "1223", "1224",
    "1231", "1232",
    "2111", "2112", "2113", "2114", "2115", "2116", "2121", "2122", "2123", "2124",
    "2131", "2132", "2133", "2134", "2135", "2141", "2142", "2143",
    "2151", "2152", "2153", "2154", "2155", "2161", "2162", "2163",
    "2211", "2212", "2213", "2221", "2222",
    "3110", "3120", "3130", "3210", "3220", "3310", "3320", "3410", "3420", "3510", "3520",
    "4111", "4112", "4120", "4210", "4211", "4212", "4310",
    "5110", "5120", "5130", "5140", "5150", "5160",
    "5210", "5215", "5220", "5230", "5240", "5242", "5245", "5250", "5255", "5260", "5265", "5270", "5275", "5278", "5280",
    "5310", "5315", "5320", "5325", "5330", "5340", "5350", "5360",
    "5410", "5420", "5430", "5435", "5440", "5445", "5450", "5460", "5470",
    "5510", "5512", "5515", "5520", "5530", "5535", "5540", "5550", "5555", "5610", "5620", "5630",
    "5710", "5720", "5730", "5810", "5820",
}

# خريطة قديم → جديد للهجرة ولتحديث المراجع في الكود.
OLD_TO_NEW_MAP = {
    "1011": "1111", "1012": "1112",
    "1013": "1121", "1014": "1121",
    "1020": "1141", "1021": "1141", "1022": "1141", "1130": "1141", "1140": "1141",
    "1030": "1151",
    "1040": "2151", "1041": "2151", "1042": "2151", "1310": "2151", "1320": "2152",
    "1070": "1161", "1210": "1161", "1025": "1162", "1200": "1161",
    "1031": "1162", "1032": "1162", "1033": "1163", "1034": "1163",
    "1051": "1211", "1052": "1212", "1053": "1211", "1054": "1211",
    "1510": "1211", "1520": "1212", "1530": "1211", "1540": "1211",
    "1060": "1210", "1080": "5820",
    "1100": "1170", "1171": "1170", "1300": "1170",
    "2000": "2111", "2010": "2111", "2110": "2111",
    "2020": "2111", "2023": "2141", "2024": "2141", "2050": "2141", "2120": "2141",
    "2030": "2121", "2130": "2121",
    "2040": "2122",
    "2200": "2211",
    "3000": "3110", "3010": "3110", "3020": "3310", "3030": "3210",
    "3100": "3110", "3200": "3210",
    "4000": "4111", "4010": "4111", "4011": "4111", "4012": "4112", "4013": "4120", "4014": "4111",
    "4020": "4112", "4021": "4111", "4022": "4112", "4023": "4111",
    "4030": "4210", "4040": "4210", "4140": "4310", "4220": "4310",
    "5000": "5110", "5005": "5110", "5010": "5310",
    "5020": "5210", "5030": "5260", "5040": "5280", "5050": "5230",
    "5060": "5280", "5070": "5280", "5080": "5260", "5090": "5610",
    "5100": "5410", "5110": "5110", "5120": "5120", "5130": "5130", "5140": "5140",
    "5150": "5150", "5160": "5280",
    "5310": "5310", "5320": "5320", "5330": "5330",
    "6000": "5820", "6100": "5810", "6200": "5820", "6300": "2141",
    "5111": "5110", "5112": "5110",
    "5210": "5310", "5220": "5320", "5230": "5410", "5240": "5460", "5250": "5610",
    "5260": "5470", "5270": "5540",
    "4113": "4120", "4121": "4111", "4122": "4112", "4123": "4120",
}

# رموز الإيرادات (الفرع = بُعد في القيد/الفاتورة، وليس في الحساب)
REVENUE_CODES_ALL = {"4111", "4112", "4120"}
REVENUE_CODES_CHINA_TOWN = {"4111", "4120"}
REVENUE_CODES_PLACE_INDIA = {"4112", "4120"}

def build_coa_dict():
    """تُرجع قائمة مثل CHART_OF_ACCOUNTS: { code: { 'name': ..., 'type': ..., 'name_ar': ..., 'name_en': ..., 'parent': ..., 'level': ... } }."""
    d = {}
    for row in NEW_COA_TREE:
        code, name_ar, name_en, atype, parent, level = row
        d[code] = {
            "name": name_ar,
            "name_ar": name_ar,
            "name_en": name_en,
            "type": atype,
            "parent_account_code": parent,
            "level": level,
        }
    return d

def leaf_coa_dict():
    """فقط الحسابات الورقية (للاستخدام في القيود)."""
    full = build_coa_dict()
    return {c: full[c] for c in LEAF_CODES if c in full}


def get_short_to_numeric(coa=None):
    """اختصارات العمليات → (code, name, type) بالشجرة المعتمدة."""
    coa = coa or build_coa_dict()
    def _n(code):
        c = coa.get(code, {})
        return (code, c.get("name", ""), c.get("type", "ASSET"))
    return {
        "CASH": _n("1111"),
        "BANK": _n("1121"),
        "AP": _n("2111"),
        "AR": _n("1141"),
        "AR_KEETA": _n("1141"),
        "AR_HUNGER": _n("1141"),
        "VAT_IN": _n("1170"),
        "VAT_OUT": _n("2141"),
        "VAT_SETTLE": _n("2141"),
        "REV_CT": _n("4111"),
        "REV_PI": _n("4112"),
        "REV_KEETA": _n("4111"),
        "REV_HUNGER": _n("4111"),
        "DISC_SALES": _n("4310"),
        "EXP_OP": _n("5210"),
        "RENT": _n("5270"),
        "ELEC": _n("5210"),
        "DIESEL": _n("5260"),
        "NET": _n("5230"),
        "MAINT": _n("5240"),
        "STATIONERY": _n("5420"),
        "CLEAN": _n("5250"),
        "LAUNDRY": _n("5250"),
        "BANK_COMM": _n("5610"),
        "GOV": _n("5410"),
        "SAL_ALL": _n("5310"),
        "SAL_EXP": _n("5310"),
        "EMP_ADV_EXP": _n("5310"),
        "SAL_DED": _n("5310"),
        "EXP_NONOP": _n("5470"),
        "DISC_GRANTED": _n("5540"),
        "PAYROLL": _n("2121"),
        "PAYROLL_LIAB": _n("2121"),
        "EMP_ADV": _n("1151"),
        "COGS": _n("5110"),
    }
