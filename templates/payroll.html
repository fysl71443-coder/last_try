{% extends "base.html" %}
{% block content %}
<div class="container">
  <div class="d-flex justify-content-between align-items-center">
    <h2 class="mb-2">๐งพ Payroll Statements / ูุดููุงุช ุงูุฑูุงุชุจ</h2>
    <a class="btn btn-outline-primary" href="{{ url_for('main.employees') }}">โฌ๏ธ ุฑุฌูุน ููููุธููู</a>
  </div>

  <form method="GET" class="filters d-flex gap-2 align-items-end flex-wrap">
    <label>Year / ุงูุณูุฉ</label>
    <select name="year">
      {% for y in years %}
        <option value="{{ y }}" {% if y == year %}selected{% endif %}>{{ y }}</option>
      {% endfor %}
    </select>

    <label>Month / ุงูุดูุฑ</label>
    <select name="month">
      {% for m in months %}
        <option value="{{ m.value }}" {% if m.value == month %}selected{% endif %}>{{ m.label }}</option>
      {% endfor %}
    </select>

    <label>Status / ุงูุญุงูุฉ</label>
    <select name="status">
      <option value="all" {% if status=="all" %}selected{% endif %}>ูู ุงูุญุงูุงุช</option>
      <option value="due" {% if status=="due" %}selected{% endif %}>ูุณุชุญูุฉ</option>
      <option value="partial" {% if status=="partial" %}selected{% endif %}>ุฌุฒุฆู</option>
      <option value="paid" {% if status=="paid" %}selected{% endif %}>ูุฏููุนุฉ</option>
    </select>
    <button class="btn btn-primary">๐ ุจุญุซ</button>
    <button type="button" class="btn btn-outline-secondary" onclick="openPrintModal('{{ url_for('main.payroll_print', year=year, month=month) }}')">๐จ๏ธ ุทุจุงุนุฉ ูุดู ูุฐุง ุงูุดูุฑ</button>
    <button type="button" class="btn btn-outline-dark" onclick="openPrintModal('{{ url_for('reports.payroll_report', year_from=year, month_from=month, year_to=year, month_to=month, print=1) }}')">๐จ๏ธ ุชูุฑูุฑ ุชูุตููู ูููุชุฑุฉ</button>
  </form>

  <div class="small text-muted mb-2">
    <span class="me-2">Paid/ุงููุฏููุน = <span class="text-success fw-bold">ุฃุฎุถุฑ</span></span>
    <span class="me-2">Remaining/ุงููุชุจูู = <span class="text-danger fw-bold">ุฃุญูุฑ</span> ุฅุฐุง > 0</span>
    <span class="me-2">Status = <span class="badge bg-success">ูุฏููุนุฉ</span> / <span class="badge bg-warning text-dark">ุฌุฒุฆู</span> / <span class="badge bg-danger">ูุณุชุญูุฉ</span></span>
  </div>

  <table class="styled-table">
    <thead>
      <tr>
        <th>#</th>
        <th>Employee / ุงูููุธู</th>
        <th class="text-end">Basic / ุงูุฃุณุงุณู</th>
        <th class="text-end">Allowances / ุงูุจุฏูุงุช</th>
        <th class="text-end">Deductions / ุงูุงุณุชูุทุงุนุงุช</th>
        <th class="text-end">Prev Due / ุณุงุจูุฉ</th>
        <th class="text-end">Total / ุงูุฅุฌูุงูู</th>
        <th class="text-end">Paid / ุงููุฏููุน</th>
        <th class="text-end">Remaining / ุงููุชุจูู</th>
        <th>Status / ุงูุญุงูุฉ</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody>
      {% for p in payrolls %}
      <tr>
        <td>{{ loop.index }}</td>
        <td>{{ p.employee.full_name }}</td>
        <td class="text-end">{{ "%.2f"|format(p.basic) }}</td>
        <td class="text-end">{{ "%.2f"|format(p.allowances) }}</td>
        <td class="text-end">{{ "%.2f"|format(p.deductions) }}</td>
        <td class="text-end">{{ "%.2f"|format(p.prev_due) }}</td>
        <td class="text-end">{{ "%.2f"|format(p.total) }}</td>
        <td class="text-end text-success fw-bold">{{ "%.2f"|format(p.paid) }}</td>
        <td class="text-end {% if p.remaining > 0 %}text-danger{% else %}text-success{% endif %} fw-bold">{{ "%.2f"|format(p.remaining) }}</td>
        <td>
          {% if p.status == "due" %}
            <span class="badge bg-danger">ูุณุชุญูุฉ</span>
          {% elif p.status == "partial" %}
            <span class="badge bg-warning text-dark">ุฌุฒุฆู</span>
          {% else %}
            <span class="badge bg-success">ูุฏููุนุฉ</span>
          {% endif %}
        </td>
        <td>
          <a href="{{ url_for('main.pay_salary', emp_id=p.employee.id, month=month, year=year) }}" class="btn btn-sm btn-success">๐ต ุณุฏุงุฏ</a>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>
{% endblock %}
