{% extends 'base.html' %}
{% block title %}{{ _('Reports / Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±') }}{% endblock %}
{% block content %}
<div class="container py-4">
  <div class="d-flex justify-content-between align-items-center mb-3">
    <div>
      <h3 class="mb-0">ğŸ“Š {{ _('Reports / Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±') }}</h3>
      <small class="text-muted">{{ place_lbl }} / {{ china_lbl }} â€” {{ currency }}</small>
    </div>
    <a href="{{ url_for('dashboard') }}" class="btn btn-primary">ğŸ  {{ _('Dashboard / Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…') }}</a>
  </div>

  <!-- Period Filters -->
  <form method="GET" class="row g-2 mb-4">
    <div class="col-md-3">
      <label class="form-label">{{ _('Period / Ø§Ù„ÙØªØ±Ø©') }}</label>
      <select class="form-select" name="period" onchange="toggleCustom(this.value)">
        <option value="today" {{ 'selected' if period=='today' }}> {{ _('Today / Ø§Ù„ÙŠÙˆÙ…') }} </option>
        <option value="this_week" {{ 'selected' if period=='this_week' }}> {{ _('This Week / Ù‡Ø°Ø§ Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹') }} </option>
        <option value="this_month" {{ 'selected' if period=='this_month' }}> {{ _('This Month / Ù‡Ø°Ø§ Ø§Ù„Ø´Ù‡Ø±') }} </option>
        <option value="this_year" {{ 'selected' if period=='this_year' }}> {{ _('This Year / Ù‡Ø°Ù‡ Ø§Ù„Ø³Ù†Ø©') }} </option>
        <option value="custom" {{ 'selected' if period=='custom' }}> {{ _('Custom / Ù…Ø®ØµØµ') }} </option>
      </select>
    </div>
    <div class="col-md-3">
      <label class="form-label">{{ _('Branch / Ø§Ù„ÙØ±Ø¹') }}</label>
      <select class="form-select" name="branch">
        <option value="all" {{ 'selected' if request.args.get('branch','all')=='all' }}>{{ _('All / Ø§Ù„ÙƒÙ„') }}</option>
        <option value="place_india" {{ 'selected' if request.args.get('branch')=='place_india' }}>{{ _('Place India') }}</option>
        <option value="china_town" {{ 'selected' if request.args.get('branch')=='china_town' }}>{{ _('China Town') }}</option>
      </select>
    </div>

    <div class="col-md-3">
      <label class="form-label">{{ _('From / Ù…Ù†') }}</label>
      <input type="date" class="form-control" name="start_date" value="{{ start_date }}">
    </div>
    <div class="col-md-3">
      <label class="form-label">{{ _('To / Ø¥Ù„Ù‰') }}</label>
      <input type="date" class="form-control" name="end_date" value="{{ end_date }}">
    </div>
    <div class="col-md-3 d-flex align-items-end">
      <button class="btn btn-secondary w-100">{{ _('Show Report / Ø¹Ø±Ø¶ Ø§Ù„ØªÙ‚Ø±ÙŠØ±') }}</button>
    </div>
  </form>

  <!-- Summary Cards -->
  <div class="row g-3 mb-4">
    <div class="col-md-3">
      <div class="card text-bg-success"><div class="card-body">
        <div class="d-flex justify-content-between"><div>{{ _('Sales Place India') }}</div><div>{{ '%.2f'|format(sales_place) }}</div></div>
      </div></div>
    </div>
    <div class="col-md-3">
      <div class="card text-bg-success"><div class="card-body">
        <div class="d-flex justify-content-between"><div>{{ _('Sales China Town') }}</div><div>{{ '%.2f'|format(sales_china) }}</div></div>
      </div></div>
    </div>
    <div class="col-md-3">
      <div class="card text-bg-primary"><div class="card-body">
        <div class="d-flex justify-content-between"><div>{{ _('Total Sales / Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª') }}</div><div>{{ '%.2f'|format(total_sales) }}</div></div>
      </div></div>
    </div>
    <div class="col-md-3">
      <div class="card text-bg-warning"><div class="card-body">
        <div class="d-flex justify-content-between"><div>{{ _('Profit / Ø§Ù„Ø±Ø¨Ø­') }}</div><div>{{ '%.2f'|format(profit) }}</div></div>
      </div></div>
    </div>
  </div>

  <div class="row g-3 mb-4">
    <div class="col-md-4"><div class="card"><div class="card-body">
      <div class="d-flex justify-content-between mb-1"><div>{{ _('Purchases / Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª') }}</div><div>{{ '%.2f'|format(total_purchases) }}</div></div>
      <div class="d-flex justify-content-between"><div>{{ _('Expenses / Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª') }}</div><div>{{ '%.2f'|format(total_expenses) }}</div></div>
      <div class="d-flex justify-content-between mt-2"><div>{{ _('Salaries / Ø§Ù„Ø±ÙˆØ§ØªØ¨') }}</div><div>{{ '%.2f'|format(total_salaries) }}</div></div>
    </div></div></div>
    <div class="col-md-8"><div class="card chart-container"><div class="card-body">
      <h6 class="card-title">{{ _('Sales Trend / Ø§ØªØ¬Ø§Ù‡ Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª') }}</h6>
      <canvas id="lineChart" height="80"></canvas>
    </div></div></div>
  </div>

  <div class="row g-3 mb-4">
    <div class="col-md-6"><div class="card chart-container"><div class="card-body">
      <h6 class="card-title">{{ _('Revenue Distribution / ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª') }}</h6>
      <canvas id="pieChart" height="120"></canvas>
    </div></div></div>
    <div class="col-md-6"><div class="card chart-container"><div class="card-body">
      <h6 class="card-title">{{ _('Profit Analysis / ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø£Ø±Ø¨Ø§Ø­') }}</h6>
      <canvas id="barChart" height="120"></canvas>
    </div></div></div>
  </div>

  <div class="card mb-4"><div class="card-body">
    <h5 class="mb-3">{{ _('Top Selling Products / Ø§Ù„Ø£ÙƒØ«Ø± Ù…Ø¨ÙŠØ¹Ø§Ù‹') }}</h5>
    <ul class="list-group list-group-flush">
      {% for name in top_labels %}
      <li class="list-group-item d-flex justify-content-between"><span>{{ name }}</span><span>{{ '%.2f'|format(top_values[loop.index0]) }}</span></li>
      {% else %}
      <li class="list-group-item">{{ _('No data / Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª') }}</li>
      {% endfor %}
    </ul>
  </div></div>

  <div class="card mb-4"><div class="card-body">
    <h5 class="mb-3">{{ _('Low Stock / Ø§Ù„Ù…Ø®Ø²ÙˆÙ† Ø§Ù„Ù…Ù†Ø®ÙØ¶') }}</h5>
    <ul class="list-group list-group-flush">
      {% for m in low_stock %}
      <li class="list-group-item d-flex justify-content-between"><span>{{ m.display_name }}</span><span>{{ m.stock_quantity }}</span></li>
      {% else %}
      <li class="list-group-item">{{ _('No data / Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª') }}</li>
      {% endfor %}
    </ul>
  </div></div>

  <div class="d-flex justify-content-end">
    <a href="{{ url_for('payments') }}" class="btn btn-outline-primary">ğŸ’³ {{ _('Go to Payments / Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ù„Ù„Ù…Ø³ØªØ­Ù‚Ø§Øª') }}</a>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
(function(){
  const lineCtx = document.getElementById('lineChart');
  new Chart(lineCtx, { type: 'line', data: { labels: {{ line_labels|tojson }}, datasets: [{ label: 'Sales', data: {{ line_values|tojson }}, borderColor: '#0d6efd', fill: false }] }, options:{ responsive:true, plugins:{ legend:{ display:true }}}});

  const pieCtx = document.getElementById('pieChart');
  new Chart(pieCtx, { type: 'pie', data: { labels: {{ pm_labels|tojson }}, datasets: [{ data: {{ pm_values|tojson }}, backgroundColor: ['#198754','#0d6efd','#ffc107','#dc3545','#20c997','#6f42c1','#fd7e14','#0dcaf0'] }] }, options:{ responsive:true }});

  const barCtx = document.getElementById('barChart');
  new Chart(barCtx, { type: 'bar', data: { labels: {{ comp_labels|tojson }}, datasets: [{ label: 'Totals', data: {{ comp_values|tojson }}, backgroundColor: ['#0d6efd','#dc3545','#ffc107'] }] }, options:{ responsive:true, scales:{ y:{ beginAtZero:true }}}});
})();

function toggleCustom(val){
  const sd = document.querySelector('[name="start_date"]');
  const ed = document.querySelector('[name="end_date"]');
  const enable = (val==='custom');
  sd.disabled = !enable; ed.disabled = !enable;
}

document.addEventListener('DOMContentLoaded', function(){ toggleCustom('{{ period }}'); });
</script>
{% endblock %}
