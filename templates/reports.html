{% extends 'base.html' %}
{% block title %}التقارير{% endblock %}
{% block content %}
<div class="container py-4">
  <h3>التقارير والطباعة</h3>
  <form class="row g-2 align-items-end mb-3" onsubmit="openPrint(); return false;">
    <div class="col-auto">
      <label class="form-label">النوع</label>
      <select id="rep-cat" class="form-select">
        <option value="sales">مبيعات</option>
        <option value="purchases">مشتريات</option>
        <option value="expenses">مصروفات</option>
      </select>
    </div>
    <div class="col-auto">
      <label class="form-label">من تاريخ</label>
      <input id="sd" type="date" class="form-control" value="{{ request.args.get('start_date','') }}">
    </div>
    <div class="col-auto">
      <label class="form-label">إلى تاريخ</label>
      <input id="ed" type="date" class="form-control" value="{{ request.args.get('end_date','') }}">
    </div>
    <div class="col-auto">
      <label class="form-label">طريقة الدفع</label>
      <select id="pm" class="form-select">
        <option value="all">الكل</option>
        <option value="cash">نقدي</option>
        <option value="card">بطاقة</option>
        <option value="bank">تحويل/بنك</option>
        <option value="pending">آجل</option>
      </select>
    </div>
    <div class="col-auto">
      <button type="submit" class="btn btn-primary">طباعة</button>
      <a href="{{ url_for('main.dashboard') }}" class="btn btn-outline-secondary">رجوع</a>
    </div>
  </form>

  <div class="alert alert-info">
    اختر النوع وحدد الفترة وطريقة الدفع ثم اضغط طباعة. سيتم فتح صفحة الطباعة في نافذة جديدة.
  </div>
</div>

<script>
function openPrint() {
  const cat = document.getElementById('rep-cat').value;
  const pm = document.getElementById('pm').value || 'all';
  const sd = document.getElementById('sd').value || '';
  const ed = document.getElementById('ed').value || '';
  let path = '/reports/print/all-invoices/sales';
  if (cat === 'purchases') path = '/reports/print/all-invoices/purchases';
  else if (cat === 'expenses') path = '/reports/print/all-invoices/expenses';
  const url = `${path}?payment_method=${encodeURIComponent(pm)}&start_date=${encodeURIComponent(sd)}&end_date=${encodeURIComponent(ed)}`;
  window.open(url, '_blank');
}
</script>
{% endblock %}
