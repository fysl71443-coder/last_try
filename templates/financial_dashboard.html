{% extends 'base.html' %}
{% block title %}{{ _('Financial Statements') }}{% endblock %}
{% block content %}
<div class="container py-4 ops-layout hub-wrap">
  <div class="ops-header-bar">
    <span class="ops-icon"><i class="fa-solid fa-chart-pie"></i></span>
    <div>
      <h1 class="ops-title mb-0">{{ _('Financial Control Center') }}</h1>
      <span class="ops-subtitle">{{ _('Sales, purchases, expenses, VAT and profit by period and branch') }}</span>
    </div>
    <div class="ops-actions">
      <a href="{{ url_for('dashboard') }}" class="btn btn-sm btn-outline-secondary"><i class="fa-solid fa-house me-1"></i>{{ _('Dashboard') }}</a>
      <a class="btn btn-sm btn-outline-secondary" href="{{ url_for('main.financial_dashboard', start_date=start_date, end_date=end_date, branch=branch) }}" target="_blank"><i class="fa-solid fa-print me-1"></i>{{ _('Print PDF') }}</a>
    </div>
  </div>

  <div class="ops-form-card mt-0">
    <div class="ops-form-head">{{ _('Period & Branch') }}</div>
    <div class="ops-form-body">
      <form class="row g-3 align-items-end" method="get">
        <div class="col-md-2">
          <label class="form-label">{{ _('From') }}</label>
          <input type="date" class="form-control" name="start_date" value="{{ start_date }}">
        </div>
        <div class="col-md-2">
          <label class="form-label">{{ _('To') }}</label>
          <input type="date" class="form-control" name="end_date" value="{{ end_date }}">
        </div>
        <div class="col-md-2">
          <label class="form-label">{{ _('Branch') }}</label>
          <select class="form-select" name="branch">
            <option value="all" {{ 'selected' if branch=='all' else '' }}>{{ _('All') }}</option>
            <option value="place_india" {{ 'selected' if branch=='place_india' else '' }}>Place India</option>
            <option value="china_town" {{ 'selected' if branch=='china_town' else '' }}>China Town</option>
          </select>
        </div>
        <div class="col-md-2">
          <button class="btn btn-primary" type="submit"><i class="fa-solid fa-filter me-1"></i>{{ _('Update') }}</button>
        </div>
      </form>
    </div>
  </div>

  <div class="row g-3">
    <div class="col-md-12">
      <div class="ops-form-card">
        <div class="ops-form-head">{{ _('Sales') }}</div>
        <div class="ops-form-body">
          <div class="row text-center mb-3 kpi-row">
            <div class="col">
              <div class="text-muted small">{{ _('Total') }}</div>
              <h5 class="kpi-value mb-0">﷼{{ '%.2f'|format(sales_summary.net_sales) }}</h5>
            </div>
            <div class="col">
              <div class="text-muted small">{{ _('Discounts') }}</div>
              <h5 class="kpi-value mb-0">﷼{{ '%.2f'|format(sales_summary.discount) }}</h5>
            </div>
            <div class="col">
              <div class="text-muted small">{{ _('VAT Output') }}</div>
              <h5 class="kpi-value mb-0">﷼{{ '%.2f'|format(sales_summary.vat_out) }}</h5>
            </div>
          </div>
          <div class="screen-table-wrap">
            <table class="table screen-table">
              <thead><tr><th>{{ _('Method') }}</th><th>{{ _('Count') }}</th><th>{{ _('Total') }}</th></tr></thead>
              <tbody>
                {% for r in by_payment_sales %}
                <tr><td>{{ r.method }}</td><td>{{ r.count }}</td><td>﷼{{ '%.2f'|format(r.total) }}</td></tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>

    <div class="col-md-6">
      <div class="ops-form-card">
        <div class="ops-form-head">{{ _('COGS') }}</div>
        <div class="ops-form-body">
          <div class="row text-center mb-3 kpi-row">
            <div class="col">
              <div class="text-muted small">{{ _('Purchases for Production (NO VAT)') }}</div>
              <h5 class="kpi-value mb-0">﷼{{ '%.2f'|format(purchases_summary.no_vat_amount) }}</h5>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="col-md-6">
      <div class="ops-form-card">
        <div class="ops-form-head">{{ _('Purchases') }}</div>
        <div class="ops-form-body">
          <div class="row text-center mb-3 kpi-row">
            <div class="col">
              <div class="text-muted small">{{ _('Total') }}</div>
              <h5 class="kpi-value mb-0">﷼{{ '%.2f'|format(purchases_summary.total) }}</h5>
            </div>
            <div class="col">
              <div class="text-muted small">{{ _('VAT Input') }}</div>
              <h5 class="kpi-value mb-0">﷼{{ '%.2f'|format(purchases_summary.vat_in) }}</h5>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="col-md-6">
      <div class="ops-form-card">
        <div class="ops-form-head">{{ _('Operating Expenses') }}</div>
        <div class="ops-form-body">
          <div class="row text-center mb-3 kpi-row">
            <div class="col">
              <div class="text-muted small">{{ _('Total') }}</div>
              <h5 class="kpi-value mb-0">﷼{{ '%.2f'|format(expenses_summary.total) }}</h5>
            </div>
          </div>
          <div class="screen-table-wrap">
            <table class="table screen-table">
              <thead><tr><th>{{ _('Type') }}</th><th>{{ _('Amount') }}</th></tr></thead>
              <tbody>
                {% for it in expenses_summary['items'] %}
                <tr><td>{{ it.label }}</td><td>﷼{{ '%.2f'|format(it.amount) }}</td></tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>

    <div class="col-md-6">
      <div class="ops-form-card">
        <div class="ops-form-head">{{ _('Liabilities') }}</div>
        <div class="ops-form-body">
          <div class="row text-center mb-3 kpi-row">
            <div class="col">
              <div class="text-muted small">{{ _('Suppliers Due') }}</div>
              <h5 class="kpi-value mb-0">﷼{{ '%.2f'|format(liabilities_summary.suppliers_due) }}</h5>
            </div>
            <div class="col">
              <div class="text-muted small">{{ _('Previous Owner') }}</div>
              <h5 class="kpi-value mb-0">﷼{{ '%.2f'|format(liabilities_summary.prev_owner) }}</h5>
            </div>
            <div class="col">
              <div class="text-muted small">{{ _('Other Dues') }}</div>
              <h5 class="kpi-value mb-0">﷼{{ '%.2f'|format(liabilities_summary.other_dues) }}</h5>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="col-md-6">
      <div class="ops-form-card">
        <div class="ops-form-head">{{ _('VAT') }}</div>
        <div class="ops-form-body">
          <div class="row text-center mb-3 kpi-row">
            <div class="col">
              <div class="text-muted small">{{ _('VAT Output') }}</div>
              <h5 class="kpi-value mb-0">﷼{{ '%.2f'|format(vat_summary.vat_out) }}</h5>
            </div>
            <div class="col">
              <div class="text-muted small">{{ _('VAT Input') }}</div>
              <h5 class="kpi-value mb-0">﷼{{ '%.2f'|format(vat_summary.vat_in) }}</h5>
            </div>
            <div class="col">
              <div class="text-muted small">{{ _('Net VAT Due') }}</div>
              <h5 class="kpi-value mb-0">﷼{{ '%.2f'|format(vat_summary.net_vat_due) }}</h5>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="col-md-12">
      <div class="ops-form-card">
        <div class="ops-form-head">{{ _('Profit/Loss') }}</div>
        <div class="ops-form-body">
          <div class="row text-center mb-3 kpi-row">
            <div class="col">
              <div class="text-muted small">{{ _('Gross Profit') }}</div>
              <h5 class="kpi-value mb-0">﷼{{ '%.2f'|format(gross_profit) }}</h5>
            </div>
            <div class="col">
              <div class="text-muted small">{{ _('Net Profit') }}</div>
              <h5 class="kpi-value mb-0">﷼{{ '%.2f'|format(net_profit) }}</h5>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}