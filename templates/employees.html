{% extends 'base.html' %}{% set back_url = url_for('main.dashboard') %}
{% block title %}{{ _('Employees / Ø§Ù„Ù…ÙˆØ¸ÙÙˆÙ†') }}{% endblock %}
{% block content %}
<div class="container py-4">
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h3 class="mb-0">ğŸ‘¤ {{ _('Employees / Ø§Ù„Ù…ÙˆØ¸ÙÙˆÙ†') }}</h3>
    <div class="d-flex flex-wrap gap-2">
      <a href="#" class="btn btn-success">ğŸ’µ {{ _('Monthly Salaries / Ø±ÙˆØ§ØªØ¨ Ø´Ù‡Ø±ÙŠØ©') }}</a>
      <a href="#" class="btn btn-outline-success">ğŸ§¾ {{ _('Payroll Statements / ÙƒØ´ÙˆÙØ§Øª Ø§Ù„Ø±ÙˆØ§ØªØ¨') }}</a>
      <a href="#" class="btn btn-outline-secondary">ğŸ“ {{ _('Salaries Form / Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ø±ÙˆØ§ØªØ¨') }}</a>
      <a href="{{ url_for('main.dashboard') }}" class="btn btn-primary">ğŸ  {{ _('Dashboard / Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…') }}</a>
    </div>
  </div>

  <div class="card mb-4">
    <div class="card-body">
      <form method="POST">
        {{ form.hidden_tag() }}
        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>

        <div class="row g-3">
          <div class="col-md-3">{{ form.employee_code.label(class_='form-label') }}{{ form.employee_code(class_='form-control') }}</div>
          <div class="col-md-3">{{ form.full_name.label(class_='form-label') }}{{ form.full_name(class_='form-control') }}</div>
          <div class="col-md-3">{{ form.national_id.label(class_='form-label') }}{{ form.national_id(class_='form-control') }}</div>
          <div class="col-md-3">{{ form.status.label(class_='form-label') }}{{ form.status(class_='form-select') }}</div>
          <div class="col-md-3">{{ form.department.label(class_='form-label') }}{{ form.department(class_='form-control') }}</div>
          <div class="col-md-3">{{ form.position.label(class_='form-label') }}{{ form.position(class_='form-control') }}</div>
          <div class="col-md-3">{{ form.phone.label(class_='form-label') }}{{ form.phone(class_='form-control') }}</div>
          <div class="col-md-3">{{ form.email.label(class_='form-label') }}{{ form.email(class_='form-control') }}</div>
          <div class="col-md-3">{{ form.hire_date.label(class_='form-label') }}{{ form.hire_date(class_='form-control') }}</div>
        </div>
        <hr/>
        <div class="row g-3">
          <div class="col-md-3">{{ form.base_salary.label(class_='form-label') }}{{ form.base_salary(class_='form-control') }}</div>
          <div class="col-md-3">{{ form.allowances.label(class_='form-label') }}{{ form.allowances(class_='form-control') }}</div>
          <div class="col-md-3">{{ form.deductions.label(class_='form-label') }}{{ form.deductions(class_='form-control') }}</div>
        </div>
        <div class="text-end mt-3">
          {{ form.submit(class_='btn btn-success') }}
        </div>
      </form>
    </div>
  </div>

  {% if employees %}
  <div class="card">
    <div class="card-body">
      {% set emps = employees or [] %}
      {% set total = emps|length %}
      {% set active_count = emps|selectattr('status','equalto','active')|list|length %}
      {% set inactive_count = total - active_count %}
      <div class="row g-3 mb-3">
        <div class="col-6 col-md-4"><div class="card shadow-sm h-100"><div class="card-body">
          <div class="text-muted small">{{ _('Total Employees / Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†') }}</div>
          <div class="fs-5 fw-bold">{{ total }}</div>
        </div></div></div>
        <div class="col-6 col-md-4"><div class="card shadow-sm h-100"><div class="card-body">
          <div class="text-muted small">{{ _('Active / Ù†Ø´Ø·') }}</div>
          <div class="fs-5 fw-bold text-success">{{ active_count }}</div>
        </div></div></div>
        <div class="col-6 col-md-4"><div class="card shadow-sm h-100"><div class="card-body">
          <div class="text-muted small">{{ _('Inactive / ØºÙŠØ± Ù†Ø´Ø·') }}</div>
          <div class="fs-5 fw-bold text-secondary">{{ inactive_count }}</div>
        </div></div></div>
      </div>
      <div class="row g-2 mb-2">
        <div class="col-md-4 ms-auto">
          <input type="text" class="form-control" id="empSearch" placeholder="{{ _('Search employees... / Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†...') }}">
        </div>
      </div>
      <div class="table-responsive">
        <table class="table table-bordered table-striped table-hover align-middle table-sm">
          <thead class="table-light">
            <tr>
              <th>#</th>
              <th>{{ _('Code / Ø§Ù„Ø±Ù…Ø²') }}</th>
              <th>{{ _('Name / Ø§Ù„Ø§Ø³Ù…') }}</th>
              <th>{{ _('National ID / Ø§Ù„Ù‡ÙˆÙŠØ©') }}</th>
              <th>{{ _('Department / Ø§Ù„Ù‚Ø³Ù…') }}</th>
              <th>{{ _('Position / Ø§Ù„ÙˆØ¸ÙŠÙØ©') }}</th>
              <th>{{ _('Phone / Ø§Ù„Ù‡Ø§ØªÙ') }}</th>
              <th>{{ _('Email / Ø§Ù„Ø¨Ø±ÙŠØ¯') }}</th>
              <th>{{ _('Hire Date / Ø§Ù„ØªØ¹ÙŠÙŠÙ†') }}</th>
              <th>{{ _('Status / Ø§Ù„Ø­Ø§Ù„Ø©') }}</th>
              <th>{{ _('Actions / Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª') }}</th>
            </tr>
          </thead>
          <tbody id="empTableBody">
            {% for e in employees %}
            <tr>
              <td>{{ loop.index }}</td>
              <td>{{ e.employee_code }}</td>
              <td>{{ e.full_name }}</td>
              <td>{{ e.national_id }}</td>
              <td>{{ e.department or '-' }}</td>
              <td>{{ e.position or '-' }}</td>
              <td>{% if e.phone %}<a href="tel:{{ e.phone }}">{{ e.phone }}</a>{% else %}-{% endif %}</td>
              <td>{% if e.email %}<a href="mailto:{{ e.email }}">{{ e.email }}</a>{% else %}-{% endif %}</td>
              <td>{{ e.hire_date or '-' }}</td>
              <td>{% if e.status=='active' %}<span class="badge bg-success">{{ _('Active / Ù†Ø´Ø·') }}</span>{% else %}<span class="badge bg-secondary">{{ _('Inactive / ØºÙŠØ± Ù†Ø´Ø·') }}</span>{% endif %}</td>
              <td>
                <div class="d-flex flex-wrap gap-1">
                  <a href="#" class="btn btn-sm btn-outline-primary">{{ _('Edit / ØªØ¹Ø¯ÙŠÙ„') }}</a>
                  <a href="#" class="btn btn-sm btn-outline-success">{{ _('Defaults / Ø§Ù„Ø§ÙØªØ±Ø§Ø¶Ø§Øª') }}</a>
                  <form method="POST" action="#" onsubmit="return handleDeleteEmployee(event, '{{ e.full_name }}')">
                    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
                    <button type="submit" class="btn btn-sm btn-outline-danger">{{ _('Delete / Ø­Ø°Ù') }}</button>
                  </form>
                </div>
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  </div>
  {% endif %}
</div>

<script>
window.handleDeleteEmployee = async function(event, name){
  event.preventDefault();
  const confirmed = await showConfirm("{{ _('Are you sure to delete / Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„Ø­Ø°ÙØŸ') }}\n" + name);
  if (confirmed) {
    event.target.submit();
  }
}

document.getElementById('empSearch')?.addEventListener('input', function(){
  const q = this.value.toLowerCase();
  document.querySelectorAll('#empTableBody tr').forEach(tr => {
    const txt = tr.textContent.toLowerCase();
    tr.style.display = txt.includes(q) ? '' : 'none';
  });
});
</script>

{% endblock %}
