<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>{{ report_title or 'Print Report' }}</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
  <style>
    @page { size: A4; margin: 12mm; }
    :root { --fg-muted:#666; --border-strong:#333; }
    @media print {
      body { font-size: 11pt; }
      .no-print { display: none !important; }
      a { text-decoration: none; color: inherit; }
      .table-print th, .table-print td { border-color: #bbb !important; }
      .table-print thead th { background: #f1f1f1 !important; }
      table { page-break-inside: auto; }
      tr { page-break-inside: avoid; page-break-after: auto; }
    }
    .report-title { text-align: center; margin-bottom: 6px; font-weight: 700; letter-spacing: .2px; }
    .muted { color: var(--fg-muted); font-size: 0.9rem; }
    .report-header { border-bottom: 2px solid var(--border-strong); margin-bottom: 12px; padding-bottom: 8px; }
    .header-card { border: 1px solid #ddd; border-radius: 6px; padding: 10px 12px; background: #fff; }
    .report-logo { height: 50px; max-width: 160px; object-fit: contain; }
    .chip { display: inline-block; padding: 2px 8px; border: 1px solid #ddd; border-radius: 999px; font-size: 0.8rem; margin: 2px 6px 0 0; background: #f7f7f7; }
    .monospace-numbers { font-variant-numeric: tabular-nums; font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace; }
    .table-print { font-size: 0.95rem; }
    .table-print tfoot tr { border-top: 2px solid #888; }
  </style>
</head>
<body>

  <div class="container py-3">
    <div class="header-card mb-3">
      <div class="row g-2 align-items-center">
        <div class="col-auto">
          {% if settings and settings.receipt_show_logo and settings.logo_url %}
            <img src="{{ settings.logo_url }}" alt="logo" class="report-logo" />
          {% endif %}
        </div>
        <div class="col">
          <div class="h5 mb-1">{{ settings.company_name or 'Company' }}</div>
          <div class="small text-muted">VAT: {{ settings.tax_number or '-' }}{% if settings.address %} | {{ settings.address }}{% endif %}</div>
        </div>
        <div class="col-auto text-end">
          <div class="small text-muted">Printed: {{ generated_at or '' }}</div>
        </div>
      </div>
    </div>

    <div class="report-header">
      <div class="d-flex justify-content-between align-items-center">
        <h4 class="report-title mb-0">{{ report_title }}</h4>
        <button class="btn btn-sm btn-outline-secondary no-print" onclick="window.print()">Print</button>
      </div>
      <div class="mt-1">
        {% if start_date or end_date %}<span class="chip">Range: {{ start_date or 'All' }} â†’ {{ end_date or 'All' }}</span>{% endif %}
        {% if payment_method %}<span class="chip">PM: {{ payment_method|upper }}</span>{% endif %}
        {% if branch %}<span class="chip">Branch: {{ branch }}</span>{% endif %}
      </div>
    </div>

    <div class="table-responsive">
      <table class="table table-bordered table-striped table-sm align-middle table-print">
        <thead class="table-light">
          <tr>
            {% for col in columns %}
              <th>{{ col }}</th>
            {% endfor %}
          </tr>
        </thead>
        <tbody>
          {% for row in data %}
          <tr>
            {% for col in columns %}
              {% if row[col] is number %}
                <td class="text-end monospace-numbers">{{ "%.2f"|format(row[col]) }}</td>
              {% else %}
                <td>{{ row[col] }}</td>
              {% endif %}
            {% endfor %}
          </tr>
          {% endfor %}
        </tbody>
        {% if totals and totals_columns %}
        <tfoot>
          <tr class="table-secondary fw-bold">
            <td colspan="{{ totals_colspan or 1 }}" class="text-end">Totals:</td>
            {% for col in totals_columns %}
              <td>{{ "%.2f"|format(totals[col] or 0) }}</td>
            {% endfor %}
          </tr>
        </tfoot>
        {% endif %}
      </table>
    </div>
  </div>

  <script>
    (function(){
      function autoPrint(){ setTimeout(function(){ try{ window.print(); }catch(e){} }, 300); }
      window.addEventListener('load', autoPrint);
      window.onafterprint = function(){ try{ window.close(); }catch(e){} };
    })();
  </script>
</body>
</html>

