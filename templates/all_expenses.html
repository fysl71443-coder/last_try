{% extends 'base.html' %}
{% block title %}All Expenses{% endblock %}
{% block content %}
<div class="container py-4">
  <h3 class="mb-3">All Expenses</h3>

  <div class="table-responsive">
    <table class="table table-bordered table-striped table-hover align-middle">
      <thead>
        <tr>
          <th>Date</th>
          <th>Expense No.</th>
          <th>Description</th>
          <th>Amount</th>
          <th>Payment Method</th>
        </tr>
      </thead>
      <tbody id="expense-body"></tbody>
      <tfoot id="expense-summary"></tfoot>
    </table>
  </div>
</div>

<script>
(function(){
  function fmt(n){ try{return Number(n||0).toFixed(2);}catch(e){return '0.00';} }
  fetch("/api/all-expenses", {credentials:'same-origin'})
    .then(r=>r.json())
    .then(data=>{
      const body = document.getElementById('expense-body');
      const tfoot = document.getElementById('expense-summary');
      if(!body||!tfoot) return;
      body.innerHTML=''; tfoot.innerHTML='';
      (data.expenses||[]).forEach(row=>{
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${row.date||''}</td>
          <td>${row.expense_number||''}</td>
          <td>${row.item||''}</td>
          <td>${fmt(row.amount)}</td>
          <td>${row.payment_method||''}</td>`;
        body.appendChild(tr);
      });
      const totals = data.overall_totals || {amount:0};
      const trTotal = document.createElement('tr'); trTotal.className='table-secondary fw-bold';
      trTotal.innerHTML = `
        <td colspan="3" class="text-end">Total Expenses:</td>
        <td>${fmt(totals.amount)}</td>
        <td></td>`;
      tfoot.appendChild(trTotal);
    })
    .catch(err=>{ console.error('Failed to load expenses', err); });
})();
</script>
{% endblock %}

