{% extends 'base.html' %}
{% block title %}{{ _('Login / ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„') }}{% endblock %}
{% block content %}

<style>
  body {
    background: linear-gradient(135deg, #1e3c72, #2a5298);
    min-height: 100vh;
    display: flex;
    align-items: center;
    justify-content: center;
  }
  .login-card {
    background: rgba(255, 255, 255, 0.15);
    border-radius: 15px;
    backdrop-filter: blur(10px);
    box-shadow: 0px 0px 20px rgba(0,0,0,0.2);
    padding: 2rem;
    width: 100%;
    max-width: 380px;
    color: white;
    position: relative;
  }
  .form-control {
    background: rgba(255, 255, 255, 0.1);
    border: none;
    color: white;
    padding-right: 12px;
  }
  .form-control::placeholder {
    color: rgba(255,255,255,0.7);
  }
  .btn-primary {
    background: #ff8c00;
    border: none;
  }
  .btn-primary:hover {
    background: #ff6600;
  }
  .lang-switch {
    position: absolute;
    top: 20px;
    right: 20px;
  }
  /* make input icons match style without affecting password behavior */
  .input-group-text { background: transparent; border: none; color: white; }
</style>

<div class="lang-switch">
  <a href="?lang=en" class="btn btn-light btn-sm">EN</a>
  <a href="?lang=ar" class="btn btn-light btn-sm">AR</a>
</div>

<div class="login-card">
  <div class="text-center mb-4">
    <img src="/static/logo.svg" alt="Company" style="max-width:120px;">
    <h5 style="margin-top:8px; font-weight:700;">{{ (settings.company_name if settings and settings.company_name else 'Company') }}</h5>
    <h4>{{ _('Welcome / Ù…Ø±Ø­Ø¨Ø§Ù‹') }}</h4>
    <p style="font-size:0.9rem; opacity:0.8;">{{ _('Please sign in to continue / Ø§Ù„Ø±Ø¬Ø§Ø¡ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù„Ù„Ù…ØªØ§Ø¨Ø¹Ø©') }}</p>
  </div>

  {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
      {% for category, message in messages %}
        <div class="alert alert-{{ category }} text-dark">{{ message }}</div>
      {% endfor %}
    {% endif %}
  {% endwith %}

  <form id="login-form" method="POST" novalidate accept-charset="UTF-8" autocomplete="off">
    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
    <div class="mb-3 input-group">
      <span class="input-group-text">ðŸ‘¤</span>
      <input type="text" name="username" class="form-control" placeholder="{{ _('Username / Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…') }}"
             value="{{ request.form.get('username','') }}" required autocomplete="username" inputmode="text" />
    </div>

    <div class="mb-3 input-group">
      <span class="input-group-text">ðŸ”’</span>
      <!-- PASSWORD: always type=password, NO toggle, NO reveal -->
      <input type="password" name="password" class="form-control" id="password"
             placeholder="{{ _('Password / ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±') }}" required autocomplete="current-password" inputmode="text" />
    </div>

    <div class="mb-3 form-check">
      <input type="checkbox" name="remember" class="form-check-input" id="remember" {% if request.form.get('remember') %}checked{% endif %}>
      <label for="remember" class="form-check-label">{{ _('Remember Me / ØªØ°ÙƒØ±Ù†ÙŠ') }}</label>
    </div>

    <div class="d-grid">
      <button type="submit" class="btn btn-primary btn-lg">{{ _('Login / ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„') }}</button>
    </div>
  </form>
</div>

{# Client-side validation only; no code that reveals the password or logs it #}
{% block scripts %}
<script>
(function(){
  const f = document.getElementById('login-form');
  if(!f) return;
  // replace form node to remove any previously attached malicious listeners (defensive)
  const clone = f.cloneNode(true);
  f.parentNode.replaceChild(clone, f);

  clone.addEventListener('submit', function(e){
    const u = clone.querySelector('input[name="username"]');
    const p = clone.querySelector('input[name="password"]');
    if(!u || !p || !u.value.trim() || !p.value.trim()){
      e.preventDefault();
      alert('{{ _("Please fill all required fields / ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©") }}');
      return;
    }
    // IMPORTANT: Do not read or log p.value here. Let server handle authentication securely.
    // allow normal submission to server
  }, { once:false });
})();
</script>
{% endblock %}

{% endblock %}
