{% extends 'base.html' %}
{% block title %}{{ _('Dashboard / Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…') }}{% endblock %}
{% block content %}

<style>
:root{ --card-bg:#ffffff; --card-border:rgba(0,0,0,.08); --glow-color:rgba(255,255,255,.75); --card-height:calc(clamp(100px, 11vw, 130px)); --icon-size:calc(clamp(28px, 3.2vw, 36px)) }
.dashboard-panel{ background:#fff; border-radius:20px; box-shadow:0 20px 60px rgba(18,22,33,.08); padding:12px 24px 24px 24px; max-width:1400px; margin:0 auto; min-height:92vh; height:100% }
.dashboard-side{ background:#0f172a; color:#e2e8f0; border:1px solid rgba(255,255,255,.06); border-radius:16px; box-shadow:0 6px 16px rgba(18,22,33,.12); padding:12px }
.dashboard-side .side-item{ display:flex; align-items:center; gap:10px; padding:10px 12px; border-radius:12px; color:#e2e8f0; text-decoration:none; transition:background .1s ease, transform .1s ease }
.dashboard-side .side-item:hover{ background:#1e293b; transform:translateX(2px) }
.dashboard-side .side-icon{ width:26px; height:26px; display:inline-flex; align-items:center; justify-content:center; border-radius:10px; background:#1f2937; color:#93c5fd; font-size:16px }
.dashboard-side .side-nested{ list-style:none; padding-left:8px; margin:6px 0 10px 0; display:none }
.dashboard-side .side-nested li a{ display:flex; align-items:center; gap:8px; padding:8px 10px; border-radius:10px; color:#cbd5e1; text-decoration:none }
.dashboard-side .side-nested li a:hover{ background:#0b1220 }
.stats-row{ display:grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap:10px; margin-bottom:14px }
.stat-card{ background:#fff; border:1px solid rgba(0,0,0,.06); border-radius:16px; box-shadow:0 8px 20px rgba(18,22,33,.06); padding:14px; display:flex; align-items:center; gap:12px; min-height:64px }
.stat-card .stat-icon{ width:36px; height:36px; border-radius:12px; background:linear-gradient(180deg,#4caf50,#2e7d32); color:#fff; display:flex; align-items:center; justify-content:center; filter:drop-shadow(0 6px 12px rgba(0,0,0,.18)) }
.stat-card.orange .stat-icon{ background:linear-gradient(180deg,#ff9800,#f57c00) }
.stat-card.purple .stat-icon{ background:linear-gradient(180deg,#7e57c2,#5e35b1) }
.stat-card .stat-text{ line-height:1.1 }
.stat-card .value{ font-weight:800; font-size:1.1rem }
.stat-card .label{ font-size:.8rem; opacity:.7 }
.card-link{ text-decoration:none; display:block }
.dashboard-card{ position:relative; border-radius:18px; padding:12px; text-align:center; overflow:hidden; box-shadow:0 10px 24px rgba(0,0,0,.10), 0 2px 8px rgba(0,0,0,.06); background:var(--card-bg); border:1px solid var(--card-border); transform:translateY(10px) scale(.98); opacity:0; will-change:transform,opacity; transition:transform .25s ease, opacity .25s ease, box-shadow .25s ease; display:flex; align-items:center; justify-content:center; flex-direction:column; height:var(--card-height); perspective:800px; transform-style:preserve-3d }
.dashboard-card.reveal{ transform:translateY(0) scale(1); opacity:1 }
.dashboard-card .title{ font-weight:700; margin:8px 0 0 0 }
.icon-3d{ width:var(--icon-size); height:var(--icon-size); margin:0 auto .3rem; display:block; filter:drop-shadow(0 10px 20px rgba(0,0,0,.18)) drop-shadow(0 0 18px var(--glow-color)); animation:pulseGlow 6s ease-in-out infinite; will-change:transform,filter; shape-rendering:geometricPrecision }
.dashboard-card:hover{ box-shadow:0 16px 32px rgba(0,0,0,.16) }
.dashboard-card:hover .icon-3d{ transform:translateZ(18px) scale(1.06) }
.dashboard-card::after{ content:""; position:absolute; inset:-40% -40% auto auto; height:120px; width:120px; background:radial-gradient(closest-side, rgba(255,255,255,.6), rgba(255,255,255,0)); transform:translate(0,0) rotate(25deg); opacity:0; transition:opacity .25s ease }
.dashboard-card:hover::after{ opacity:.7 }
.kind-sales,.kind-purchases,.kind-expenses,.kind-inventory,.kind-salaries,.kind-payments,.kind-reports,.kind-archive,.kind-vat,.kind-financials,.kind-journal,.kind-customers,.kind-menu,.kind-settings,.kind-users,.kind-tables,.kind-suppliers,.kind-empuvd{ background:#fff; border-color:var(--card-border) }
.dashboard-card .gate{ position:absolute; inset:0; display:flex; pointer-events:none }
.dashboard-card .gate .left,.dashboard-card .gate .right{ flex:1; background:linear-gradient(180deg, rgba(0,0,0,.08), rgba(0,0,0,.02)); backdrop-filter:saturate(120%) blur(.6px); transition:transform .45s cubic-bezier(.2,.8,.2,1) }
.dashboard-card .gate .left{ border-right:1px solid rgba(0,0,0,.06) }
.dashboard-card .gate .right{ border-left:1px solid rgba(0,0,0,.06) }
.dashboard-card.open .gate .left{ transform:translateX(-120%) }
.dashboard-card.open .gate .right{ transform:translateX(120%) }
.dashboard-card .flash{ position:absolute; inset:0; background:radial-gradient(closest-side, rgba(255,255,255,.0), rgba(255,255,255,.0)); pointer-events:none; opacity:0 }
.dashboard-card.open .flash{ animation:flash 520ms ease-out forwards }
@keyframes flash{ 0%{ opacity:0; background:radial-gradient(closest-side, rgba(255,255,255,.0), rgba(255,255,255,.0)) } 15%{ opacity:.9; background:radial-gradient(closest-side, rgba(255,255,255,.85), rgba(255,255,255,.0)) } 100%{ opacity:0 } }
.dashboard-card:hover{ transform:translateY(-2px); box-shadow:0 10px 20px rgba(0,0,0,.12) }
@media (prefers-reduced-motion: reduce){
  .autumn-scene .shape{ animation:none }
  .dashboard-card{ transition:none }
  .dashboard-card:hover{ transform:none }
}
/* Layout: sidebar and content parallel */
.layout-row{ display:grid; grid-template-columns: 280px 1fr; gap:18px; min-height:calc(100vh - 40px); align-items:stretch }
.sidebar-col,.content-col{ display:flex; flex-direction:column }
.content-col{ min-width:0; width:100%; max-width:100% }
.dashboard-side{ height:100% }
.dashboard-panel{ height:100%; display:flex; flex-direction:column; overflow-x:hidden }
.accordion#dashAccordion{ display:none }
.dashboard-side .side-item.active{ background:#eef2f7 }
.group-card{ display:block !important; margin:0; width:100% !important }
#cards-grid{ display:grid !important; grid-template-columns: repeat(4, 1fr); gap:12px; min-height:320px; margin-top:0; width:100%; padding:0 24px; box-sizing:border-box }
#cards-grid > .group-card{ width:100% !important; max-width:none !important; margin:0 !important }
#kpi-row{ grid-column: 1 / -1 }
.stat-card.loading{ position:relative; overflow:hidden }
.stat-card.loading::after{ content:""; position:absolute; inset:0; background:linear-gradient(90deg, rgba(255,255,255,0) 0%, rgba(255,255,255,.35) 50%, rgba(255,255,255,0) 100%); animation: shimmer 1.5s infinite }
@keyframes shimmer{ 0%{ transform:translateX(-100%) } 100%{ transform:translateX(100%) } }
#cards-grid{ display:grid !important; grid-template-columns: repeat(4, 1fr); gap:12px; padding:0 24px }
@media (max-width: 1200px) { #cards-grid{ grid-template-columns: repeat(3, 1fr); } }
@media (max-width: 900px) { #cards-grid{ grid-template-columns: repeat(2, 1fr); } }
@media (max-width: 600px) { #cards-grid{ grid-template-columns: 1fr; gap:10px; } }

/* ØªÙ†Ø³ÙŠÙ‚Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ© Ù„Ø¶Ù…Ø§Ù† Ø¹Ø±Ø¶ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª */
.dashboard-card {
    width: 100% !important;
    min-width: 0 !important;
    box-sizing: border-box;
    margin: 0 !important;
    padding: 10px !important;
}

.group-card {
    display: block !important;
    width: 100% !important;
    max-width: none !important;
    padding: 0 !important;
    margin: 0 !important;
    box-sizing: border-box;
}

.dashboard-card .title {
    font-size: 0.9rem !important;
    margin: 6px 0 0 0 !important;
}

.dashboard-card .icon-3d {
    margin-bottom: 0.2rem !important;
}
</style>

<div class="container-fluid py-4">
  <div class="layout-row">
    <div class="sidebar-col">
      <div class="dashboard-side">
        <div class="d-flex align-items-center gap-2 mb-2"><div class="side-icon">ğŸ </div><strong>{{ _('Dashboard / Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…') }}</strong></div>
        <a class="side-item active" href="#" data-group="sales"><div class="side-icon">ğŸ’¼</div><span>{{ _('Sales & Commercial / Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª ÙˆØ§Ù„Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„ØªØ¬Ø§Ø±ÙŠØ©') }}</span></a>
        <ul class="side-nested" data-group="sales">
          {% if can('sales','view') %}<li><a href="{{ url_for('main.sales') }}">ğŸ’° {{ _('Sales / Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª') }}</a></li>{% endif %}
          {% if can('invoices','view') %}<li><a href="{{ url_for('main.invoices') }}">ğŸ§¾ {{ _('Invoices / Ø§Ù„ÙÙˆØ§ØªÙŠØ±') }}</a></li>{% endif %}
          {% if can('customers','view') %}<li><a href="{{ url_for('main.customers') }}">ğŸ¤ {{ _('Customers / Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡') }}</a></li>{% endif %}
          {% if can('menu','view') %}<li><a href="{{ url_for('main.menu') }}">ğŸ½ï¸ {{ _('Menu / Ø§Ù„Ù…Ù†ÙŠÙˆ') }}</a></li>{% endif %}
          {% if can('payments','view') %}<li><a href="{{ url_for('main.payments') }}">ğŸ’³ {{ _('Payments / Ø§Ù„Ù…Ø¯ÙÙˆØ¹Ø§Øª') }}</a></li>{% endif %}
          {% if can('expenses','view') %}<li><a href="{{ url_for('main.expenses') }}">ğŸ§¾ {{ _('Expenses / Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª') }}</a></li>{% endif %}
        </ul>
        <a class="side-item" href="#" data-group="proc"><div class="side-icon">ğŸ›ï¸</div><span>{{ _('Procurement & Suppliers / Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª ÙˆØ§Ù„Ù…ÙˆØ±Ø¯ÙˆÙ†') }}</span></a>
        <ul class="side-nested" data-group="proc">
          {% if can('purchases','view') %}<li><a href="{{ url_for('main.purchases') }}">ğŸ›’ {{ _('Purchases / Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª') }}</a></li>{% endif %}
          {% if can('suppliers','view') %}<li><a href="{{ url_for('main.suppliers') }}">ğŸ¤ {{ _('Suppliers / Ø§Ù„Ù…ÙˆØ±Ø¯ÙˆÙ†') }}</a></li>{% endif %}
          {% if can('payments','view') %}<li><a href="{{ url_for('main.payments') }}">ğŸ’³ {{ _('Payments & Receivables / Ø§Ù„Ù…Ø¯ÙÙˆØ¹Ø§Øª ÙˆØ§Ù„Ù…Ø³ØªØ­Ù‚Ø§Øª') }}</a></li>{% endif %}
        </ul>
        <a class="side-item" href="#" data-group="acct"><div class="side-icon">ğŸ“’</div><span>{{ _('Accounting & Finance / Ø§Ù„Ù…Ø­Ø§Ø³Ø¨Ø© ÙˆØ§Ù„Ù…Ø§Ù„ÙŠØ©') }}</span></a>
        <ul class="side-nested" data-group="acct">
          <li><a href="{{ url_for('financials.accounts_hub') }}">ğŸ“š {{ _('Accounts / Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª') }}</a></li>
          {% if can('journal','view') %}<li><a href="{{ url_for('journal.list_entries') }}">ğŸ““ {{ _('Journal / Ù‚ÙŠÙˆØ¯ Ø§Ù„ÙŠÙˆÙ…ÙŠØ©') }}</a></li>{% endif %}
          {% if can('financials','view') %}<li><a href="{{ url_for('financials.trial_balance') }}">ğŸ“Š {{ _('Trial Balance / Ù…ÙŠØ²Ø§Ù† Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©') }}</a></li>{% endif %}
          <li><a href="{{ url_for('financials.accounts_hub') }}#tab-ledger">ğŸ“‘ {{ _('Ledger / Ø¯ÙØªØ± Ø§Ù„Ø£Ø³ØªØ§Ø°') }}</a></li>
          {% if can('vat','view') %}<li><a href="{{ url_for('vat.vat_dashboard') }}">ğŸ§® {{ _('VAT / Ø¶Ø±ÙŠØ¨Ø© Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ù…Ø¶Ø§ÙØ©') }}</a></li>{% endif %}
          {% if can('financials','view') %}<li><a href="{{ url_for('financials.income_statement') }}">ğŸ“˜ {{ _('Financial Statements / Ø§Ù„Ù‚ÙˆØ§Ø¦Ù… Ø§Ù„Ù…Ø§Ù„ÙŠØ©') }}</a></li>{% endif %}
          {% if can('reports','view') %}<li><a href="{{ url_for('main.reports') }}">ğŸ“Š {{ _('Reports / Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±') }}</a></li>{% endif %}
        </ul>
        <a class="side-item" href="#" data-group="inv"><div class="side-icon">ğŸ“¦</div><span>{{ _('Inventory & Resources / Ø§Ù„Ù…Ø®Ø²ÙˆÙ† ÙˆØ¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ÙˆØ§Ø±Ø¯') }}</span></a>
        <ul class="side-nested" data-group="inv">
          {% if can('inventory','view') %}<li><a href="{{ url_for('main.inventory') }}">ğŸ“¦ {{ _('Inventory / Ø§Ù„Ù…Ø®Ø²ÙˆÙ†') }}</a></li>{% endif %}
          {% if can('inventory','view') %}<li><a href="{{ url_for('main.inventory') }}">ğŸ§® {{ _('Inventory & Costs / Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØªÙƒØ§Ù„ÙŠÙ') }}</a></li>{% endif %}
        </ul>
        <a class="side-item" href="#" data-group="sys"><div class="side-icon">âš™ï¸</div><span>{{ _('System & Configuration / Ø§Ù„Ù†Ø¸Ø§Ù… ÙˆØ§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª') }}</span></a>
        <ul class="side-nested" data-group="sys">
          {% if can('settings','view') %}<li><a href="{{ url_for('main.settings') }}">âš™ï¸ {{ _('Settings / Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª') }}</a></li>{% endif %}
          {% if can('table_settings','view') %}<li><a href="{{ url_for('main.table_settings') }}">ğŸª‘ {{ _('Table Settings / Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø·Ø§ÙˆÙ„Ø§Øª') }}</a></li>{% endif %}
          {% if can('users','view') %}<li><a href="{{ url_for('main.users') }}">ğŸ‘¤ {{ _('Users & Permissions / Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙˆÙ† ÙˆØ§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª') }}</a></li>{% endif %}
        </ul>
      </div>
    </div>
    <div class="content-col">
      <div class="dashboard-panel">
        <div id="cards-grid">

        
        

    {% if can('sales','view') %}
    <div class="group-card" data-group="sales">
      <a href="{{ url_for('main.sales') }}" class="card-link">
        <div class="dashboard-card kind-sales" data-target="{{ url_for('main.sales') }}">
          <svg class="icon-3d" viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg"><defs><linearGradient id="gCoin" x1="0" y1="0" x2="1" y2="1"><stop offset="0%" stop-color="#ffd77a"/><stop offset="100%" stop-color="#ff9a3c"/></linearGradient></defs><circle cx="32" cy="32" r="22" fill="url(#gCoin)"/><circle cx="32" cy="32" r="18" fill="#fff3"/><path d="M26 36c0 4 12 4 12 0s-12-4-12 0z" fill="#fff8"/></svg>
          <div class="title">{{ _('Sales / Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª') }}</div>
          <div class="gate"><div class="left"></div><div class="right"></div></div>
          <div class="flash"></div>
        </div>
      </a>
    </div>
    {% endif %}

    {% if can('purchases','view') %}
    <div class="group-card" data-group="proc">
      <a href="{{ url_for('main.purchases') }}" class="card-link">
        <div class="dashboard-card kind-purchases" data-target="{{ url_for('main.purchases') }}">
          <svg class="icon-3d" viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg"><defs><linearGradient id="gCart" x1="0" y1="0" x2="1" y2="1"><stop offset="0%" stop-color="#ffb3b3"/><stop offset="100%" stop-color="#ff6b6b"/></linearGradient></defs><rect x="16" y="22" width="32" height="18" rx="4" fill="url(#gCart)"/><circle cx="24" cy="44" r="4" fill="#333"/><circle cx="40" cy="44" r="4" fill="#333"/></svg>
          <div class="title">{{ _('Purchases / Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª') }}</div>
          <div class="gate"><div class="left"></div><div class="right"></div></div>
          <div class="flash"></div>
        </div>
      </a>
    </div>
    {% endif %}

    {% if can('suppliers','view') %}
    <div class="group-card" data-group="proc">
      <a href="{{ url_for('main.suppliers') }}" class="card-link">
        <div class="dashboard-card kind-suppliers" data-target="{{ url_for('main.suppliers') }}">
          <svg class="icon-3d" viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg"><defs><linearGradient id="gHandshake" x1="0" y1="0" x2="1" y2="1"><stop offset="0%" stop-color="#b2ebf2"/><stop offset="100%" stop-color="#00bcd4"/></linearGradient></defs><path d="M22 32l10 6 10-6" fill="none" stroke="url(#gHandshake)" stroke-width="6" stroke-linecap="round"/></svg>
          <h6>{{ _('Suppliers / Ø§Ù„Ù…ÙˆØ±Ø¯ÙˆÙ†') }}</h6>
        </div>
      </a>
    </div>
    {% endif %}


    {% if can('expenses','view') %}
    <div class="group-card" data-group="sales">
      <a href="{{ url_for('main.expenses') }}" class="card-link">
        <div class="dashboard-card kind-expenses" data-target="{{ url_for('main.expenses') }}">
          <svg class="icon-3d" viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg"><defs><linearGradient id="gExpense" x1="0" y1="0" x2="1" y2="1"><stop offset="0%" stop-color="#ffccbc"/><stop offset="100%" stop-color="#ff7043"/></linearGradient></defs><rect x="18" y="20" width="28" height="24" rx="6" fill="url(#gExpense)"/><circle cx="32" cy="32" r="6" fill="#fff8"/></svg>
          <h6>{{ _('Expenses / Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª') }}</h6>
        </div>
      </a>
    </div>
    {% endif %}

    {% if can('invoices','view') %}
    <div class="group-card" data-group="sales">
      <a href="{{ url_for('main.invoices') }}" class="card-link">
        <div class="dashboard-card kind-reports" data-target="{{ url_for('main.invoices') }}">
          <svg class="icon-3d" viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg"><defs><linearGradient id="gDoc" x1="0" y1="0" x2="1" y2="1"><stop offset="0%" stop-color="#d1c4e9"/><stop offset="100%" stop-color="#9575cd"/></linearGradient></defs><rect x="18" y="14" width="28" height="36" rx="6" fill="url(#gDoc)"/><rect x="24" y="22" width="16" height="4" rx="2" fill="#fff9"/><rect x="24" y="30" width="16" height="4" rx="2" fill="#fff6"/></svg>
          <h6>{{ _('All Invoices / ÙƒÙ„ Ø§Ù„ÙÙˆØ§ØªÙŠØ±') }}</h6>
        </div>
      </a>
    </div>
    {% endif %}

    {% if can('inventory','view') %}
    <div class="group-card" data-group="sales inv">
      <a href="{{ url_for('main.inventory') }}" class="card-link">
        <div class="dashboard-card kind-inventory" data-target="{{ url_for('main.inventory') }}">
          <svg class="icon-3d" viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg"><defs><linearGradient id="gBox" x1="0" y1="0" x2="1" y2="1"><stop offset="0%" stop-color="#b2dfdb"/><stop offset="100%" stop-color="#26a69a"/></linearGradient></defs><path d="M16 24l16-10 16 10v20l-16 10-16-10z" fill="url(#gBox)"/></svg>
          <h6>{{ _('Inventory & Costs / Ø§Ù„Ù…Ø®Ø²ÙˆÙ† ÙˆØ§Ø¯Ø§Ø±Ø© Ø§Ù„ØªÙƒØ§Ù„ÙŠÙ') }}</h6>
        </div>
      </a>
    </div>
    {% endif %}

    

    {% if can('payments','view') %}
    <div class="group-card" data-group="sales proc">
      <a href="{{ url_for('main.payments') }}" class="card-link">
        <div class="dashboard-card kind-payments" data-target="{{ url_for('main.payments') }}">
          <svg class="icon-3d" viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg"><defs><linearGradient id="gCard" x1="0" y1="0" x2="1" y2="1"><stop offset="0%" stop-color="#c5e1a5"/><stop offset="100%" stop-color="#8bc34a"/></linearGradient></defs><rect x="14" y="20" width="36" height="24" rx="6" fill="url(#gCard)"/><rect x="18" y="26" width="20" height="4" rx="2" fill="#fff9"/></svg>
          <h6>{{ _('Payments & Receivables / Ø§Ù„Ù…Ø¯ÙÙˆØ¹Ø§Øª ÙˆØ§Ù„Ù…Ø³ØªØ­Ù‚Ø§Øª') }}</h6>
        </div>
      </a>
    </div>
    {% endif %}

    

    
    
    

    {% if can('reports','view') %}
    <div class="group-card" data-group="acct">
      <a href="{{ url_for('main.reports') }}" class="card-link">
        <div class="dashboard-card kind-reports" data-target="{{ url_for('main.reports') }}">
          <svg class="icon-3d" viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg"><defs><linearGradient id="gChart" x1="0" y1="0" x2="1" y2="1"><stop offset="0%" stop-color="#d1c4e9"/><stop offset="100%" stop-color="#7e57c2"/></linearGradient></defs><rect x="20" y="30" width="6" height="14" rx="2" fill="url(#gChart)"/><rect x="30" y="24" width="6" height="20" rx="2" fill="url(#gChart)"/><rect x="40" y="34" width="6" height="10" rx="2" fill="url(#gChart)"/></svg>
          <h6>{{ _('Reports / Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±') }}</h6>
        </div>
      </a>
    </div>
    {% endif %}

    {% if can('archive','view') %}
    <div class="group-card" data-group="acct">
      <a href="{{ url_for('main.archive') }}" class="card-link">
        <div class="dashboard-card kind-archive" data-target="{{ url_for('main.archive') }}">
          <svg class="icon-3d" viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg"><defs><linearGradient id="gFolder" x1="0" y1="0" x2="1" y2="1"><stop offset="0%" stop-color="#cfd8dc"/><stop offset="100%" stop-color="#90a4ae"/></linearGradient></defs><path d="M14 24h16l4 6h16v20H14z" fill="url(#gFolder)"/></svg>
          <h6>{{ _('Archive / Ø§Ù„Ø£Ø±Ø´ÙŠÙ') }}</h6>
        </div>
      </a>
    </div>
    {% endif %}

    {% if can('vat','view') %}
    <div class="group-card" data-group="acct">
      <a href="{{ url_for('vat.vat_dashboard') }}" class="card-link">
        <div class="dashboard-card kind-vat" data-target="{{ url_for('vat.vat_dashboard') }}">
          <svg class="icon-3d" viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg"><defs><linearGradient id="gVat" x1="0" y1="0" x2="1" y2="1"><stop offset="0%" stop-color="#ffe082"/><stop offset="100%" stop-color="#ffca28"/></linearGradient></defs><circle cx="32" cy="24" r="10" fill="url(#gVat)"/><rect x="20" y="36" width="24" height="10" rx="5" fill="#fff6"/></svg>
          <h6>{{ _('VAT / Ø¶Ø±ÙŠØ¨Ø© Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ù…Ø¶Ø§ÙØ©') }}</h6>
        </div>
      </a>
    </div>
    {% endif %}

    

    <div class="group-card" data-group="acct">
      <a href="{{ url_for('financials.accounts_hub') }}" class="card-link">
        <div class="dashboard-card kind-financials" data-target="{{ url_for('financials.accounts_hub') }}">
          <svg class="icon-3d" viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg"><defs><linearGradient id="gAcc" x1="0" y1="0" x2="1" y2="1"><stop offset="0%" stop-color="#a5d6a7"/><stop offset="100%" stop-color="#4caf50"/></linearGradient></defs><rect x="18" y="18" width="28" height="28" rx="6" fill="url(#gAcc)"/><rect x="22" y="24" width="20" height="4" rx="2" fill="#fff9"/><rect x="22" y="32" width="20" height="4" rx="2" fill="#fff6"/></svg>
          <h6>{{ _('Accounts / Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª') }}</h6>
        </div>
      </a>
    </div>

    {% if can('journal','view') %}
    <div class="group-card" data-group="acct">
      <a href="{{ url_for('journal.list_entries') }}" class="card-link">
        <div class="dashboard-card kind-journal" data-target="{{ url_for('journal.list_entries') }}">
          <svg class="icon-3d" viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg"><defs><linearGradient id="gJournal" x1="0" y1="0" x2="1" y2="1"><stop offset="0%" stop-color="#c8e6c9"/><stop offset="100%" stop-color="#66bb6a"/></linearGradient></defs><rect x="20" y="16" width="28" height="32" rx="6" fill="url(#gJournal)"/><circle cx="28" cy="32" r="3" fill="#fff9"/><circle cx="40" cy="32" r="3" fill="#fff9"/></svg>
          <h6>{{ _('Journal Entries / Ù‚ÙŠÙˆØ¯ Ø§Ù„ÙŠÙˆÙ…ÙŠØ©') }}</h6>
        </div>
      </a>
    </div>
    {% endif %}

    {% if can('customers','view') %}
    <div class="group-card" data-group="sales">
      <a href="{{ url_for('main.customers') }}" class="card-link">
        <div class="dashboard-card kind-customers" data-target="{{ url_for('main.customers') }}">
          <svg class="icon-3d" viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg"><defs><linearGradient id="gCust" x1="0" y1="0" x2="1" y2="1"><stop offset="0%" stop-color="#f8bbd0"/><stop offset="100%" stop-color="#ec407a"/></linearGradient></defs><circle cx="24" cy="26" r="7" fill="url(#gCust)"/><circle cx="40" cy="26" r="7" fill="url(#gCust)"/><rect x="18" y="36" width="28" height="10" rx="5" fill="#fff6"/></svg>
          <h6>{{ _('Customers / Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡') }}</h6>
        </div>
      </a>
    </div>
    {% endif %}

    {% if can('menu','view') %}
    <div class="group-card" data-group="sales">
      <a href="{{ url_for('main.menu') }}" class="card-link">
        <div class="dashboard-card kind-menu" data-target="{{ url_for('main.menu') }}">
          <svg class="icon-3d" viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg"><defs><linearGradient id="gMenu" x1="0" y1="0" x2="1" y2="1"><stop offset="0%" stop-color="#fff59d"/><stop offset="100%" stop-color="#fbc02d"/></linearGradient></defs><path d="M20 18h24v28H20z" fill="url(#gMenu)"/><rect x="24" y="24" width="16" height="3" rx="1.5" fill="#fff9"/><rect x="24" y="30" width="16" height="3" rx="1.5" fill="#fff6"/></svg>
          <h6>{{ _('Menu / Ø§Ù„Ù…Ù†ÙŠÙˆ') }}</h6>
        </div>
      </a>
    </div>
    {% endif %}

    {% if can('settings','view') %}
    <div class="group-card" data-group="sys">
      <a href="{{ url_for('main.settings') }}" class="card-link">
        <div class="dashboard-card kind-settings" data-target="{{ url_for('main.settings') }}">
          <svg class="icon-3d" viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg"><defs><linearGradient id="gGear" x1="0" y1="0" x2="1" y2="1"><stop offset="0%" stop-color="#b0bec5"/><stop offset="100%" stop-color="#607d8b"/></linearGradient></defs><circle cx="32" cy="32" r="8" fill="#fff6"/><path d="M32 16l4 6 6 4-6 4-4 6-4-6-6-4 6-4z" fill="url(#gGear)"/></svg>
          <h6>{{ _('Settings / Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª') }}</h6>
        </div>
      </a>
    </div>
    {% endif %}

    {% if can('table_settings','view') %}
    <div class="group-card" data-group="sys">
      <a href="{{ url_for('main.table_settings') }}" class="card-link">
        <div class="dashboard-card kind-tables" data-target="{{ url_for('main.table_settings') }}">
          <svg class="icon-3d" viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg"><defs><linearGradient id="gChair" x1="0" y1="0" x2="1" y2="1"><stop offset="0%" stop-color="#aed581"/><stop offset="100%" stop-color="#7cb342"/></linearGradient></defs><rect x="20" y="24" width="24" height="8" rx="2" fill="url(#gChair)"/><rect x="24" y="32" width="16" height="12" rx="2" fill="#fff6"/></svg>
          <h6>{{ _('Table Settings / Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø·Ø§ÙˆÙ„Ø§Øª') }}</h6>
        </div>
      </a>
    {% endif %}
    </div>
    <div class="stats-row" id="kpi-row"></div>
    </div>
  </div>

  {% if (current_user.role|default('')) == 'user' %}
  <div class="mt-4">
    <div class="alert alert-info">
      {{ _('Sales users only see sales. Use the top menu to access your branch sales tables.') }}
    </div>
  </div>
  {% endif %}
</div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function(){

  function showGroup(group){
    document.querySelectorAll('.side-nested').forEach(function(ul){
      ul.style.display = (ul.dataset.group === group) ? 'block' : 'none';
    });

    document.querySelectorAll('.group-card').forEach(function(card){
      var groups = String(card.dataset.group||'').split(' ');
      card.style.display = groups.includes(group) ? 'block' : 'none';
    });

    buildKpiCards(group);
  }
  document.querySelectorAll('.dashboard-side .side-item').forEach(function(it){
    it.addEventListener('click', function(ev){ ev.preventDefault(); var g = this.getAttribute('data-group'); document.querySelectorAll('.dashboard-side .side-item').forEach(function(x){ x.classList.remove('active'); }); this.classList.add('active'); showGroup(g); });
  });
  showGroup('sales');


  async function buildKpiCards(group){
    var grid = document.getElementById('kpi-row');
    if(!grid) return;
    grid.innerHTML = '';

    function card(icon, title, value){
      var div = document.createElement('div');
      div.className = 'stat-card';
      div.innerHTML = '<div class="stat-icon">'+icon+'</div>'+
                      '<div class="stat-text">'+
                        '<div class="value">'+value+'</div>'+
                        '<div class="label">'+title+'</div>'+
                      '</div>';
      return div;
    }

    var today = null;
    try{
      today = await fetch('/api/kpi/dashboard_full').then(function(r){ return r.json(); }).catch(function(){ return null; });
    }catch(e){ today = null; }
    if(!today) return;

    if(group === 'sales'){
      Object.keys(today.branches || {}).forEach(function(branch){
        var val = Number((today.branches[branch]||{}).sales || 0).toFixed(2) + ' '+ '{{ _("Ø±ÙŠØ§Ù„") }}';
        grid.appendChild(card('ğŸª', 'Ù…Ø¨ÙŠØ¹Ø§Øª '+branch, val));
      });

      grid.appendChild(card('ğŸ’µ', 'Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙƒØ§Ø´', Number(today.payment_cash||0).toFixed(2) + ' '+ '{{ _("Ø±ÙŠØ§Ù„") }}'));
      grid.appendChild(card('ğŸ¦', 'Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¨Ù†Ùƒ', Number(today.payment_bank||0).toFixed(2) + ' '+ '{{ _("Ø±ÙŠØ§Ù„") }}'));
      grid.appendChild(card('ğŸ§¾', 'Ø¹Ø¯Ø¯ Ø§Ù„ÙÙˆØ§ØªÙŠØ±', String(today.invoices_count||0)));
      grid.appendChild(card('ğŸ½ï¸', 'Ø¹Ø¯Ø¯ Ø§Ù„ÙˆØ¬Ø¨Ø§Øª', String(today.items_sold||0)));
    }
  }
});
</script>

{% endblock %}
