{% extends 'base.html' %}
{% block title %}{{ _('Suppliers / الموردون') }}{% endblock %}
{% block content %}
<div class="container py-3" style="font-size: 1rem;">
  <div class="section-header d-flex justify-content-between align-items-center">
    <h3 class="mb-0">{{ _('Suppliers List / قائمة الموردين') }}</h3>
    <form class="d-flex gap-2" method="get" action="{{ url_for('main.suppliers_list') }}">
      <input type="text" name="q" value="{{ request.args.get('q','') }}" class="form-control" placeholder="{{ _('Search... / بحث...') }}" style="min-width: 220px;">
      <a class="btn btn-outline-secondary" href="{{ url_for('main.suppliers_export', q=request.args.get('q')) }}">{{ _('Export CSV / تصدير CSV') }}</a>
      <a class="btn btn-outline_secondary" href="{{ url_for('main.suppliers') }}">{{ _('Add Supplier / إضافة مورد') }}</a>
      <button class="btn btn-primary">{{ _('Search / بحث') }}</button>
    </form>
  </div>

  <div class="card"><div class="card-body">
    <div class="table-responsive">
      <table class="table table-striped">
        <thead>
          <tr>
            <th>{{ _('Suppliers / الموردون') }}</th>
            <th>{{ _('Contact Person / شخص التواصل') }}</th>
            <th>{{ _('Phone / الهاتف') }}</th>
            <th>{{ _('Email / البريد الإلكتروني') }}</th>
            <th>{{ _('Tax Number / الرقم الضريبي') }}</th>
            <th>{{ _('Payment Method / طريقة الدفع') }}</th>
            <th>{{ _('CR Number / رقم السجل التجاري') }}</th>
            <th>{{ _('IBAN / رقم الآيبان') }}</th>
            <th>{{ _('Address / العنوان') }}</th>
            <th>{{ _('Notes / ملاحظات') }}</th>
            <th>{{ _('Active / نشط') }}</th>
            <th class="text-end" style="width:260px;">{{ _('Actions / إجراءات') }}</th>
          </tr>
        </thead>
        <tbody>
          {% for s in suppliers %}
          <tr>
            <td>{{ s.name }}</td>
            <td>{{ s.contact_person or '-' }}</td>
            <td>{{ s.phone or '-' }}</td>
            <td>{{ s.email or '-' }}</td>
            <td>{{ s.tax_number or '-' }}</td>
            {% set ns = namespace(cr=(s.cr_number|default('')), iban=(s.iban|default(''))) %}
            {% if not ns.cr or not ns.iban %}
              {% for part in (s.notes or '').split('|') %}
                {% set p = part.strip() %}
                {% if (not ns.cr) and p[:3] == 'CR:' %}{% set ns.cr = p[3:].strip() %}{% endif %}
                {% if (not ns.iban) and p[:5] == 'IBAN:' %}{% set ns.iban = p[5:].strip() %}{% endif %}
              {% endfor %}
            {% endif %}
            <td>{{ (s.payment_method or 'CASH') }}</td>
            <td>{{ ns.cr or '-' }}</td>
            <td>{{ ns.iban or '-' }}</td>
            <td>{{ s.address or '-' }}</td>
            <td>{{ s.notes or '-' }}</td>
            <td>{% if s.active %}<span class="badge bg-success">{{ _('Active / نشط') }}</span>{% else %}<span class="badge bg-secondary">{{ _('Inactive / غير نشط') }}</span>{% endif %}</td>
            <td class="text-end">
              <a class="btn btn-sm btn-outline-primary" href="{{ url_for('main.suppliers_edit', sid=s.id) }}">{{ _('Edit / تعديل') }}</a>
              <form method="post" action="{{ url_for('main.supplier_toggle', sid=s.id) }}" class="d-inline" onsubmit="return confirm('{{ _('Toggle status? / تبديل الحالة؟') }}')">
                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
                <button class="btn btn-sm btn-outline-secondary">{{ _('Toggle / تبديل') }}</button>
              </form>
              <form method="post" action="{{ url_for('main.supplier_delete', sid=s.id) }}" class="d-inline" onsubmit="return confirm('{{ _('Delete this supplier? / حذف هذا المورد؟') }}')">
                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
                <button class="btn btn-sm btn-outline-danger">{{ _('Delete / حذف') }}</button>
              </form>
            </td>
          </tr>
          {% else %}
          <tr><td colspan="12" class="text-center text-muted">{{ _('No suppliers yet / لا يوجد موردون بعد') }}</td></tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div></div>
</div>
{% endblock %}



