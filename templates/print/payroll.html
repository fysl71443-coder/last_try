<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8"/>
  <title>Payroll Statements / كشوفات الرواتب</title>
  <script>
    // Redirect legacy payroll print to the new detailed statement, preserving query string
    (function(){
      try{
        var qs = window.location.search || '';
        var target = "{{ url_for('main.reports_print_salaries_detailed') }}" + qs;
        if (window.location.pathname.indexOf('/reports/print/salaries') !== -1) {
          window.location.replace(target);
        }
      }catch(e){}
    })();
  </script>
  <style>
    body{font-family:Arial, sans-serif; font-size:14px}
    table{width:100%; border-collapse:collapse}
    th,td{border-bottom:1px dashed #ddd; padding:6px 4px}
    .right{text-align:right}
    .center{text-align:center}
    .muted{color:#666}
    .total-row td{font-weight:bold}
    @media print{.no-print{display:none}}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="center">
      <img src="{{ logo_url }}" alt="logo" style="height:40px"/>
      <div><strong>{{ company_name }}</strong></div>
      <div class="muted">{{ title }}</div>
      <div class="muted">{{ meta }}</div>
    </div>

    <!-- Current Month -->
    <h3 class="center">{{ _('Current Month / الشهر الحالي') }}</h3>
    <table>
      <thead>
        <tr>
          <th>{{ _('Employee / الموظف') }}</th>
          <th class="right">{{ _('Basic') }}</th>
          <th class="right">{{ _('Allowances') }}</th>
          <th class="right">{{ _('Deductions') }}</th>
          <th class="right">{{ _('Prev. Due') }}</th>
          <th class="right">{{ _('Total') }}</th>
          <th class="right">{{ _('Paid') }}</th>
          <th class="right">{{ _('Remaining') }}</th>
          <th>{{ _('Status') }}</th>
        </tr>
      </thead>
      <tbody>
        {% for r in rows %}
        <tr>
          <td>{{ r.employee_name }}</td>
          <td class="right">{{ '%.2f'|format(r.basic) }}</td>
          <td class="right">{{ '%.2f'|format(r.allow) }}</td>
          <td class="right">{{ '%.2f'|format(r.ded) }}</td>
          <td class="right">{{ '%.2f'|format(r.prev) }}</td>
          <td class="right">{{ '%.2f'|format(r.total) }}</td>
          <td class="right">{{ '%.2f'|format(r.paid) }}</td>
          <td class="right">{{ '%.2f'|format(r.remaining) }}</td>
          <td>{{ r.status }}</td>
        </tr>
        {% else %}
        <tr><td colspan="9" class="center muted">{{ _('No data') }}</td></tr>
        {% endfor %}
      </tbody>
      {% if totals %}
      <tfoot>
        <tr class="total-row">
          <td>{{ _('Totals') }}</td>
          <td class="right">{{ '%.2f'|format(totals.basic) }}</td>
          <td class="right">{{ '%.2f'|format(totals.allow) }}</td>
          <td class="right">{{ '%.2f'|format(totals.ded) }}</td>
          <td class="right">{{ '%.2f'|format(totals.prev) }}</td>
          <td class="right">{{ '%.2f'|format(totals.total) }}</td>
          <td class="right">{{ '%.2f'|format(totals.paid) }}</td>
          <td class="right">{{ '%.2f'|format(totals.remaining) }}</td>
          <td></td>
        </tr>
      </tfoot>
      {% endif %}
    </table>

    <!-- Previous Months (Aggregated per employee) -->
    {% if prev_rows is not none %}
    <h3 class="center" style="margin-top:18px">{{ _('Previous Dues Summary / إجمالي مستحقات الشهور السابقة') }}</h3>
    <table>
      <thead>
        <tr>
          <th>{{ _('Employee / الموظف') }}</th>
          <th class="right">{{ _('Total Due / إجمالي المستحق') }}</th>
          <th class="right">{{ _('Paid / إجمالي المدفوع') }}</th>
          <th class="right">{{ _('Remaining / المتبقي') }}</th>
        </tr>
      </thead>
      <tbody>
        {% for r in prev_rows %}
        <tr>
          <td>{{ r.employee_name }}</td>
          <td class="right">{{ '%.2f'|format(r.due) }}</td>
          <td class="right">{{ '%.2f'|format(r.paid) }}</td>
          <td class="right">{{ '%.2f'|format((r.due or 0) - (r.paid or 0)) }}</td>
        </tr>
        {% else %}
        <tr><td colspan="4" class="center muted">{{ _('No data') }}</td></tr>
        {% endfor %}
      </tbody>
      {% if prev_totals %}
      <tfoot>
        <tr class="total-row">
          <td>{{ _('Totals / الإجماليات') }}</td>
          <td class="right">{{ '%.2f'|format(prev_totals.due) }}</td>
          <td class="right">{{ '%.2f'|format(prev_totals.paid) }}</td>
          <td class="right">{{ '%.2f'|format((prev_totals.remaining if prev_totals.remaining is not none else (prev_totals.due - prev_totals.paid))) }}</td>
        </tr>
      </tfoot>
      {% endif %}
    </table>
    {% endif %}

    <div class="center no-print" style="margin-top:8px">
      <button onclick="window.print()">{{ _('Print / طباعة') }}</button>
    </div>
  </div>
</body>
</html>

