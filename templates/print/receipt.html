<!doctype html>
<html lang="en" dir="ltr">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Sales Receipt</title>
  <style>
    {% set pw = (settings.receipt_paper_width if settings and settings.receipt_paper_width else '80') %}
    {% set fs = (settings.receipt_font_size if settings and settings.receipt_font_size else 12) %}
    {% set logo_h = (settings.receipt_logo_height if settings and settings.receipt_logo_height else 100) %}
    {% set extra_bottom = (settings.receipt_extra_bottom_mm if settings and (settings.receipt_extra_bottom_mm is not none) else 15) %}
    {% set effective_logo_height = branch_settings.receipt_logo_height if branch_settings and branch_settings.receipt_logo_height else logo_h %}
    
    body{
      font-family: 'Courier New', monospace; 
      font-size: {{ fs }}px; 
      line-height: 1.3;
      margin: 0;
      padding: 8px;
      color: #000;
      font-weight: 700;
    }
    body, h1, h2, h3, h4, h5, h6, p, span, div, td, th, small, strong, em, b, i,
    .muted, .small, .company-name, .grand-total { color: #000 !important; font-weight: 700 !important; }
    .wrap{
      width: {{ pw }}mm; 
      max-width: {{ pw }}mm; 
      margin: 0 auto;
      padding: 0;
    }
    .center{text-align: center; margin-bottom: 8px;}
    .muted{color: #000; font-size: {{ (fs|int - 1) if (fs|int > 8) else fs }}px;}
    .small{font-size: {{ (fs|int - 2) if (fs|int > 8) else fs }}px; color: #000;}
    .logo-img{
      height: {{ effective_logo_height }}px; 
      max-width: 90%; 
      margin-bottom: 10px; 
      object-fit: contain;
      display: block;
      margin-left: auto;
      margin-right: auto;
    }
    .company-name{
      font-size: {{ (fs|int + 3) if fs else 15 }}px;
      font-weight: bold;
      margin-bottom: 6px;
    }
    table{
      width: 100%; 
      border-collapse: collapse;
      margin: 8px 0;
      font-size: {{ (fs|int - 1) if (fs|int > 8) else fs }}px;
    }
    th{
      padding: 4px 2px; 
      border-bottom: 1px solid #000;
      font-weight: 700;
      font-size: {{ (fs|int + 1) if (fs|int > 8) else (fs|int) }}px;
      color: #000;
    }
    td{
      padding: 3px 2px; 
      border-bottom: 1px solid #000;
      vertical-align: top;
      color: #000;
    }
    .total-row td{
      font-weight: 700;
      border-bottom: 1px solid #000;
      padding: 4px 2px;
      color: #000;
    }
    .grand-total{
      border-top: 2px solid #000 !important;
      border-bottom: 2px solid #000 !important;
      font-size: {{ (fs|int + 3) if fs else 15 }}px;
      font-weight: 700;
      color: #000;
    }
    .right{text-align: right;}
    .center-text{text-align: center;}
    .left{text-align: left;}
    hr{
      margin: 8px 0;
      border: none;
      border-top: 2px solid #000;
    }
    .footer{
      margin-top: 12px;
      font-size: {{ (fs|int - 1) if (fs|int > 8) else fs }}px;
    }
    @media print{
      .no-print{display: none !important;}
      body{
        background: #fff; 
        font-size: {{ (fs|int + 2) if (fs|int < 15) else fs }}px;
        margin: 0;
        padding: 4px;
        -webkit-print-color-adjust: exact;
        color-adjust: exact;
        print-color-adjust: exact;
        color: #000;
        font-weight: 700;
      }
      body, h1, h2, h3, h4, h5, h6, p, span, div, td, th, small, strong, em, b, i,
      table, .company-name, .muted, .small, .grand-total { color: #000 !important; font-weight: 700 !important; }
      .wrap{
        width: {{ pw }}mm;
        max-width: {{ pw }}mm;
        margin: 0;
        padding: 0;
      }
      .logo-img{
        height: {{ effective_logo_height }}px;
        max-width: 85%;
        margin-bottom: 8px;
      }
      table{
        page-break-inside: avoid;
        margin: 6px 0;
      }
      hr{
        margin: 4px 0;
        page-break-after: avoid;
      }
      .footer{
        margin-top: 8px;
        page-break-inside: avoid;
      }
      @page{ 
        margin: 2mm 2mm {{ extra_bottom }}mm 2mm; 
        size: {{ pw }}mm auto;
      }
    }
    {% if items and items|length <= 3 %}
    .footer{margin-top: 15px;}
    {% elif items and items|length <= 6 %}
    .footer{margin-top: 12px;}
    {% else %}
    .footer{margin-top: 8px;}
    {% endif %}
  </style>
</head>
<body>
  {% set currency_src = None %}
  {% if settings and settings.currency_image %}
    {% set currency_src = settings.currency_image %}
  {% elif settings and settings.currency and (settings.currency.startswith('http') or settings.currency.startswith('/')) %}
    {% set currency_src = settings.currency %}
  {% endif %}
  <div class="wrap">
    <div class="center">
      {% set branch_code_top = (inv.branch or inv.branch_code or '')|lower %}
      {% set is_china_top = branch_code_top[0:5] == 'china' %}
      {% set is_india_top = ('place' in branch_code_top) or ('india' in branch_code_top) %}
      {% set branch_logo_url = None %}
      {% if is_china_top and settings and settings.china_town_logo_url %}
        {% set branch_logo_url = settings.china_town_logo_url %}
      {% elif is_india_top and settings and settings.place_india_logo_url %}
        {% set branch_logo_url = settings.place_india_logo_url %}
      {% endif %}
      {% if logo_data_url %}
      <img src="{{ logo_data_url }}" alt="logo" class="logo-img"/>
      {% elif branch_settings and branch_settings.receipt_show_logo and branch_settings.branch_data_url %}
      <img src="{{ branch_settings.branch_data_url }}" alt="logo" class="logo-img"/>
      {% elif branch_settings and branch_settings.receipt_show_logo and branch_settings.logo_url %}
      <img src="{{ branch_settings.logo_url }}" alt="logo" class="logo-img"/>
      {% elif branch_logo_url and (not settings or settings.receipt_show_logo) %}
      <img src="{{ branch_logo_url }}" alt="logo" class="logo-img"/>
      {% elif settings and settings.receipt_show_logo and settings.logo_url %}
      <img src="{{ settings.logo_url }}" alt="logo" class="logo-img"/>
      {% elif (not settings or settings.receipt_show_logo) and logo_url %}
      <img src="{{ logo_url }}" alt="logo" class="logo-img"/>
      {% endif %}
      <div class="company-name">{{ settings.company_name if settings else company_name }}</div>
      {% set show_vat = (not settings) or (settings and settings.receipt_show_tax_number) %}
      {% if show_vat %}
        {% if settings and settings.tax_number %}
        <div class="small muted">{{ _('VAT No.') }}: {{ settings.tax_number }}</div>
        {% elif tax_number %}
        <div class="small muted">{{ _('VAT No.') }}: {{ tax_number }}</div>
        {% endif %}
      {% endif %}
      {% set branch_code = (inv.branch or inv.branch_code or '')|lower %}
      {% set is_china = branch_code[0:5] == 'china' %}
      {% set is_india = ('place' in branch_code) or ('india' in branch_code) %}
      {% if is_china %}
        {% if settings and (settings.china_town_phone1 or settings.china_town_phone2) %}
        <div class="small muted">
          {{ _('Phone') }}: {{ (settings.china_town_phone1 or '') ~ ((' / ' ~ settings.china_town_phone2) if settings.china_town_phone2 else '') }}
        </div>
       
