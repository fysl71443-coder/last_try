{% extends 'base.html' %}
{% block title %}{{ _('Supplier Statement') }} â€” {{ supplier.name }}{% endblock %}
{% block content %}
<style>
.supplier-stmt { font-family: 'Cairo', 'Tajawal', sans-serif; }
.supplier-stmt .stmt-header { background: #f8fafc; border: 1px solid #e2e8f0; border-radius: 10px; padding: 1.25rem 1.5rem; margin-bottom: 1.5rem; }
.supplier-stmt .stmt-title { font-size: 1.25rem; font-weight: 700; margin: 0 0 0.5rem 0; }
.supplier-stmt .stmt-period { font-size: 0.95rem; color: #64748b; margin: 0; }
.supplier-stmt .stmt-supplier { font-size: 1rem; margin: 0.5rem 0 0 0; }
.supplier-stmt .stmt-supplier span { font-weight: 600; }
.supplier-stmt table { font-size: 0.9rem; }
.supplier-stmt .status-unpaid { background: rgba(239,68,68,.15); color: #b91c1c; }
.supplier-stmt .status-partial { background: rgba(245,158,11,.2); color: #b45309; }
.supplier-stmt .status-paid { background: rgba(34,197,94,.15); color: #15803d; }
@media print {
  .no-print { display: none !important; }
  body, .supplier-stmt, .supplier-stmt * { color: #000 !important; -webkit-print-color-adjust: exact; print-color-adjust: exact; }
  .supplier-stmt .stmt-header { box-shadow: none; border-color: #333 !important; }
  .supplier-stmt .stmt-period { color: #000 !important; }
  .supplier-stmt table th, .supplier-stmt table td { border-color: #333 !important; }
  .supplier-stmt table thead th { background: #e8e8e8 !important; color: #000 !important; }
  .text-muted { color: #000 !important; }
  .text-danger { color: #000 !important; font-weight: 700; }
}
</style>
<div class="container py-4 supplier-stmt">
  <div class="d-flex justify-content-between align-items-start flex-wrap gap-3 mb-4 no-print">
    <div>
      <h1 class="ops-title mb-1">{{ _('Supplier Statement') }}</h1>
      <p class="text-muted small mb-0">{{ supplier.name }}</p>
    </div>
    <div class="d-flex gap-2">
      <button type="button" class="btn btn-sm btn-primary" onclick="window.print()"><i class="fa-solid fa-print me-1"></i>{{ _('Print') }}</button>
      <a href="{{ url_for('suppliers.suppliers_payments_statements') }}?supplier_id={{ supplier.id }}&start_date={{ start_date.strftime('%Y-%m-%d') }}&end_date={{ end_date.strftime('%Y-%m-%d') }}" class="btn btn-sm btn-outline-secondary"><i class="fa-solid fa-edit me-1"></i>{{ _('Change dates') }}</a>
      <a href="{{ url_for('suppliers.suppliers_list') }}" class="btn btn-sm btn-outline-secondary"><i class="fa-solid fa-arrow-left me-1"></i>{{ _('Back') }}</a>
    </div>
  </div>

  <div class="stmt-header">
    <h2 class="stmt-title">{{ _('Supplier Statement') }}</h2>
    <p class="stmt-period">{{ _('From') }} {{ start_date.strftime('%Y-%m-%d') }} {{ _('to') }} {{ end_date.strftime('%Y-%m-%d') }}</p>
    <div class="stmt-supplier">
      <span>{{ _('Supplier') }}:</span> {{ supplier.name }}
      {% if supplier.contact_person %}<span class="ms-2">|</span> {{ supplier.contact_person }}{% endif %}
      {% if supplier.phone %}<span class="ms-2">|</span> {{ supplier.phone }}{% endif %}
      {% if supplier.tax_number %}<span class="ms-2">|</span> {{ _('Tax') }}: {{ supplier.tax_number }}{% endif %}
    </div>
  </div>

  <div class="ops-form-card mb-4">
    <div class="ops-form-head">{{ _('Purchase Invoices') }}</div>
    <div class="ops-form-body p-0">
      <div class="table-responsive">
        <table class="table table-sm table-hover mb-0">
          <thead>
            <tr>
              <th>{{ _('Invoice No') }}</th>
              <th>{{ _('Date') }}</th>
              <th class="text-end">{{ _('Total') }}</th>
              <th class="text-end">{{ _('Paid') }}</th>
              <th class="text-end">{{ _('Remaining') }}</th>
              <th>{{ _('Status') }}</th>
            </tr>
          </thead>
          <tbody>
            {% for inv in invoices %}
            <tr>
              <td>{{ inv.invoice_number }}</td>
              <td>{{ inv.date.strftime('%Y-%m-%d') if inv.date else '-' }}</td>
              <td class="text-end">{{ '{:,.2f}'.format(inv.total) }}</td>
              <td class="text-end">{{ '{:,.2f}'.format(inv.paid) }}</td>
              <td class="text-end">{{ '{:,.2f}'.format(inv.remaining) }}</td>
              <td><span class="badge status-{{ inv.status }}">{{ inv.status }}</span></td>
            </tr>
            {% else %}
            <tr><td colspan="6" class="text-center text-muted py-4">{{ _('No invoices in this period') }}</td></tr>
            {% endfor %}
          </tbody>
          {% if invoices %}
          <tfoot>
            <tr class="fw-bold">
              <td colspan="2">{{ _('Total') }}</td>
              <td class="text-end">{{ '{:,.2f}'.format(total_invoices) }}</td>
              <td class="text-end">{{ '{:,.2f}'.format(total_paid) }}</td>
              <td class="text-end">{{ '{:,.2f}'.format(balance_due) }}</td>
              <td></td>
            </tr>
          </tfoot>
          {% endif %}
        </table>
      </div>
    </div>
  </div>

  <div class="ops-form-card">
    <div class="ops-form-head">{{ _('Payments') }}</div>
    <div class="ops-form-body p-0">
      <div class="table-responsive">
        <table class="table table-sm table-hover mb-0">
          <thead>
            <tr>
              <th>{{ _('Date') }}</th>
              <th class="text-end">{{ _('Amount') }}</th>
              <th>{{ _('Method') }}</th>
            </tr>
          </thead>
          <tbody>
            {% for p in payments %}
            <tr>
              <td>{{ p.date.strftime('%Y-%m-%d %H:%M') if p.date else '-' }}</td>
              <td class="text-end">{{ '{:,.2f}'.format(p.amount) }}</td>
              <td>{{ p.method or '-' }}</td>
            </tr>
            {% else %}
            <tr><td colspan="3" class="text-center text-muted py-4">{{ _('No payments recorded') }}</td></tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <div class="mt-4 p-3 rounded border bg-light">
    <strong>{{ _('Balance due') }}:</strong> <span class="fs-4 text-danger">{{ '{:,.2f}'.format(balance_due) }} {{ _('SAR') }}</span>
  </div>
</div>
{% endblock %}
