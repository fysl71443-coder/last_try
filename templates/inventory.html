{% extends 'base.html' %}
{% set back_url = url_for('main.dashboard') %}

{% block title %}{{ _('Inventory & Cost Management / المخزون وإدارة التكاليف') }}{% endblock %}
{% block content %}

<style>
body {
  background: #f4f6f9;
}
.inventory-card {
  background: white;
  border-radius: 12px;
  box-shadow: 0px 4px 8px rgba(0,0,0,0.05);
  padding: 1.5rem;
  margin-bottom: 1rem;
}
.stats-card {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: white;
  border-radius: 12px;
  padding: 1.5rem;
  text-align: center;
  margin-bottom: 1rem;
}
.action-card {
  background: white;
  border-radius: 12px;
  box-shadow: 0px 4px 8px rgba(0,0,0,0.05);
  padding: 2rem;
  text-align: center;
  transition: all 0.2s ease-in-out;
  height: 100%;
}
.action-card:hover {
  transform: translateY(-3px);
  box-shadow: 0px 6px 14px rgba(0,0,0,0.1);
}
.action-icon {
  font-size: 3rem;
  margin-bottom: 1rem;
  color: #2a5298;
}
.cost-highlight {
  font-weight: bold;
  color: #2e7d32;
}
.price-highlight {
  font-weight: bold;
  color: #1976d2;
}
</style>

<div class="container py-4">
    <!-- شريط التنقل السريع -->
    <div class="row mb-3">
        <div class="col-md-6">
            <h3 class="mb-0">📦 {{ _('Inventory & Cost Management / المخزون وإدارة التكاليف') }}</h3>
        </div>
        <div class="col-md-6 text-end">
            <a href="{{ url_for('main.purchases') }}" class="btn btn-outline-warning me-2">
                🛒 {{ _('Purchases / المشتريات') }}
            </a>
            <a href="{{ url_for('main.sales') }}" class="btn btn-outline-info me-2">
                💰 {{ _('Sales / المبيعات') }}
            </a>
            <a href="{{ url_for('main.dashboard') }}" class="btn btn-primary">
                🏠 {{ _('Dashboard / لوحة التحكم') }}
            </a>
        </div>
    </div>

    <!-- إحصائيات سريعة -->
    <div class="row mb-4">
        <div class="col-md-4">
            <div class="stats-card">
                <h4>{{ raw_materials|length }}</h4>
                <p class="mb-0">{{ _('Raw Materials / مواد خام') }}</p>
            </div>
        </div>
        <div class="col-md-4">
            <div class="stats-card">
                <h4>{{ meals|length }}</h4>
                <p class="mb-0">{{ _('Ready Meals / وجبات جاهزة') }}</p>
            </div>
        </div>
        <div class="col-md-4">
            <div class="stats-card">
                <h4>${{ "%.2f"|format(meals|sum(attribute='total_cost') or 0) }}</h4>
                <p class="mb-0">{{ _('Total Investment / إجمالي الاستثمار') }}</p>
            </div>
        </div>
    </div>

    <!-- أزرار الإجراءات الرئيسية -->
    <div class="row mb-4">
        <div class="col-md-6">
            <a href="{{ url_for('main.raw_materials') }}" class="text-decoration-none">
                <div class="action-card">
                    <div class="action-icon">🥘</div>
                    <h5>{{ _('Manage Raw Materials / إدارة المواد الخام') }}</h5>
                    <p class="text-muted">{{ _('Add and manage ingredients, spices, and raw materials with their costs / إضافة وإدارة المكونات والتوابل والمواد الخام مع تكاليفها') }}</p>
                </div>
            </a>
        </div>
        <div class="col-md-6">
            <a href="{{ url_for('main.meals') }}" class="text-decoration-none">
                <div class="action-card">
                    <div class="action-icon">🍽️</div>
                    <h5>{{ _('Create Meals / إنشاء الوجبات') }}</h5>
                    <p class="text-muted">{{ _('Create meals from raw materials, calculate costs, and set selling prices / إنشاء الوجبات من المواد الخام وحساب التكاليف وتحديد أسعار البيع') }}</p>
                </div>
            </a>
        </div>
    </div>

    <!-- ملخص المواد الخام -->
    {% if raw_materials %}
    <div class="inventory-card">
        <h5 class="mb-3">{{ _('Raw Materials Summary / ملخص المواد الخام') }}</h5>

        <div class="table-responsive">
            <table class="table table-sm">
                <thead class="table-light">
                    <tr>
                        <th>{{ _('Material / المادة') }}</th>
                        <th>{{ _('Unit / الوحدة') }}</th>
                        <th>{{ _('Cost per Unit / التكلفة لكل وحدة') }}</th>
                        <th>{{ _('Category / الفئة') }}</th>
                    </tr>
                </thead>
                <tbody>
                    {% for material in raw_materials[:10] %}
                    <tr>
                        <td>{{ material.display_name }}</td>
                        <td><span class="badge bg-secondary">{{ material.unit }}</span></td>
                        <td class="cost-highlight">${{ "%.4f"|format(material.cost_per_unit) }}</td>
                        <td>{{ material.category or '-' }}</td>
                    </tr>
                    {% endfor %}
                    {% if raw_materials|length > 10 %}
                    <tr>
                        <td colspan="4" class="text-center text-muted">
                            <em>{{ _('And') }} {{ raw_materials|length - 10 }} {{ _('more materials...') }}</em>
                        </td>
                    </tr>
                    {% endif %}
                </tbody>
            </table>
        </div>

        <div class="text-end">
            <a href="{{ url_for('main.raw_materials') }}" class="btn btn-outline-primary">
                {{ _('View All Materials / عرض جميع المواد') }}
            </a>
        </div>
    </div>
    {% endif %}

    <!-- ملخص الوجبات -->
    {% if meals %}
    <div class="inventory-card">
        <h5 class="mb-3">{{ _('Meals Summary / ملخص الوجبات') }}</h5>

        <div class="table-responsive">
            <table class="table table-sm">
                <thead class="table-light">
                    <tr>
                        <th>{{ _('Meal / الوجبة') }}</th>
                        <th>{{ _('Ingredients / المكونات') }}</th>
                        <th>{{ _('Total Cost / إجمالي التكلفة') }}</th>
                        <th>{{ _('Profit Margin / هامش الربح') }}</th>
                        <th>{{ _('Selling Price / سعر البيع') }}</th>
                    </tr>
                </thead>
                <tbody>
                    {% for meal in meals[:10] %}
                    <tr>
                        <td><strong>{{ meal.display_name }}</strong></td>
                        <td>{{ meal.ingredients|length }} {{ _('items / عناصر') }}</td>
                        <td class="cost-highlight">${{ "%.2f"|format(meal.total_cost) }}</td>
                        <td>{{ "%.1f"|format(meal.profit_margin_percent) }}%</td>
                        <td class="price-highlight">${{ "%.2f"|format(meal.selling_price) }}</td>
                    </tr>
                    {% endfor %}
                    {% if meals|length > 10 %}
                    <tr>
                        <td colspan="5" class="text-center text-muted">
                            <em>{{ _('And') }} {{ meals|length - 10 }} {{ _('more meals...') }}</em>
                        </td>
                    </tr>
                    {% endif %}
                </tbody>
            </table>
        </div>

        <div class="text-end">
            <a href="{{ url_for('main.meals') }}" class="btn btn-outline-success">
                {{ _('View All Meals / عرض جميع الوجبات') }}
            </a>
        </div>
    </div>
    {% endif %}

    <!-- رسالة البداية -->
    {% if not raw_materials and not meals %}
    <div class="inventory-card text-center">
        <div class="action-icon">🚀</div>
        <h5>{{ _('Welcome to Cost Management / مرحباً بك في إدارة التكاليف') }}</h5>
        <p class="text-muted mb-4">
            {{ _('Start by adding raw materials, then create meals to calculate costs and set selling prices / ابدأ بإضافة المواد الخام، ثم أنشئ الوجبات لحساب التكاليف وتحديد أسعار البيع') }}
        </p>
        <div class="row">
            <div class="col-md-6">
                <a href="{{ url_for('main.raw_materials') }}" class="btn btn-primary btn-lg w-100">
                    🥘 {{ _('Add Raw Materials / إضافة المواد الخام') }}
                </a>
            </div>
            <div class="col-md-6">
                <a href="{{ url_for('main.meals') }}" class="btn btn-success btn-lg w-100">
                    🍽️ {{ _('Create Meals / إنشاء الوجبات') }}
                </a>
            </div>
        </div>
    </div>
    {% endif %}
</div>

{% endblock %}
