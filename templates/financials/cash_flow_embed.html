{% extends 'financials/base_statement_embed.html' %}
{% block title %}{{ _('Cash flow') }}{% endblock %}
{% block content %}
<style>
  .cf-embed-wrap { max-height: 60vh; overflow: auto; }
  .cf-embed-wrap .stmt-table thead th { position: sticky; top: 0; background: #374151; color: #fff; z-index: 1; box-shadow: 0 1px 0 #4b5563; }
  .cf-debit { color: #198754; }
  .cf-credit { color: #dc3545; }
  @media print {
    .cf-embed-wrap { max-height: none; overflow: visible; }
    .cf-embed-wrap .stmt-table thead th { position: static; }
    .cf-embed-wrap tbody tr:nth-of-type(25n) { page-break-after: always; }
  }
</style>
<div class="stmt-header">
  <h2 class="stmt-title">{{ _('Cash flow') }}</h2>
  <div class="stmt-meta">{{ _('Period') }}: {{ data.start_date }} → {{ data.end_date }}</div>
</div>
<div class="stmt-cards">
  <div class="stmt-card" style="background:#e8f5e9; border-color:#198754;">
    <div class="val">{{ '%.2f'|format(data.inflow or 0) }}</div>
    <div class="lbl">{{ _('Inflow') }} SAR</div>
  </div>
  <div class="stmt-card" style="background:#ffebee; border-color:#dc3545;">
    <div class="val">{{ '%.2f'|format(data.outflow or 0) }}</div>
    <div class="lbl">{{ _('Outflow') }} SAR</div>
  </div>
  <div class="stmt-card {% if (data.net or 0) >= 0 %}stmt-profit{% else %}stmt-loss{% endif %}" style="{% if (data.net or 0) >= 0 %}background:#e8f5e9; border-color:#198754;{% else %}background:#ffebee; border-color:#dc3545;{% endif %}">
    <div class="val">{{ '%.2f'|format(data.net or 0) }}</div>
    <div class="lbl">{{ _('Net') }} SAR</div>
  </div>
</div>
<div class="stmt-panel">
  <div class="stmt-panel-head">{{ _('Cash movements') }}</div>
  <div class="p-2">
    <div class="cf-embed-wrap">
      <table class="stmt-table table table-sm">
        <thead><tr><th>{{ _('Account') }}</th><th>{{ _('Date') }}</th><th class="text-end">{{ _('Debit') }} ({{ _('Inflow') }})</th><th class="text-end">{{ _('Credit') }} ({{ _('Outflow') }})</th><th class="text-end">{{ _('Balance') }}</th></tr></thead>
        <tbody>
          {% for r in (data.rows or []) %}
          <tr>
            <td>{{ r.code }} – {{ r.name }}</td>
            <td>{{ r.date }}</td>
            <td class="stmt-num text-end cf-debit">{{ '%.2f'|format(r.debit or 0) }}</td>
            <td class="stmt-num text-end cf-credit">{{ '%.2f'|format(r.credit or 0) }}</td>
            <td class="stmt-num text-end fw-semibold">{{ '%.2f'|format(r.running_balance | default(0)) }}</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
    {% if data.pagination and data.pagination.total_pages > 1 %}
    <div class="d-flex flex-wrap align-items-center gap-2 mt-2 no-print">
      {% set pag = data.pagination %}
      <span class="small text-muted">{{ pag.total }} {{ _('rows') }} — {{ _('Page') }} {{ pag.page }} / {{ pag.total_pages }}</span>
      <a href="{{ url_for('financials.cash_flow', start_date=data.start_date, end_date=data.end_date, page=pag.prev_num or 1, per_page=pag.per_page, embed=1) }}" class="btn btn-sm btn-outline-secondary {% if not pag.has_prev %}disabled{% endif %}">{{ _('Previous') }}</a>
      <a href="{{ url_for('financials.cash_flow', start_date=data.start_date, end_date=data.end_date, page=pag.next_num or pag.total_pages, per_page=pag.per_page, embed=1) }}" class="btn btn-sm btn-outline-secondary {% if not pag.has_next %}disabled{% endif %}">{{ _('Next') }}</a>
    </div>
    {% endif %}
    {% if not (data.rows or []) %}
    <div class="p-3 text-center text-muted">{{ _('No movements in this period.') }}</div>
    {% endif %}
  </div>
</div>
{% endblock %}
