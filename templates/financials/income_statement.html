{% extends 'base.html' %}
{% block title %}قائمة الدخل{% endblock %}
{% block content %}
<div class="container py-4">
  <h3>قائمة الدخل (Advanced Income Statement)</h3>

  <form method="get" class="row g-2 align-items-end mb-3">
    <div class="col-auto">
      <label class="form-label">الفترة</label>
      <select name="period" class="form-select">
        <option value="today" {% if data.period=='today' %}selected{% endif %}>اليوم</option>
        <option value="this_week" {% if data.period=='this_week' %}selected{% endif %}>هذا الأسبوع</option>
        <option value="this_month" {% if data.period=='this_month' %}selected{% endif %}>هذا الشهر</option>
        <option value="this_year" {% if data.period=='this_year' %}selected{% endif %}>هذه السنة</option>
        <option value="custom" {% if data.period=='custom' %}selected{% endif %}>مخصص</option>
      </select>
    </div>
    <div class="col-auto">
      <label class="form-label">من تاريخ</label>
      <input type="date" name="start_date" class="form-control" value="{{ data.start_date }}">
    </div>
    <div class="col-auto">
      <label class="form-label">إلى تاريخ</label>
      <input type="date" name="end_date" class="form-control" value="{{ data.end_date }}">
    </div>
    <div class="col-auto">
      <button class="btn btn-primary">عرض</button>
    </div>

  <div class="d-flex gap-2 mb-3">
    <a class="btn btn-outline-secondary" href="{{ url_for('financials.balance_sheet') }}">المركز المالي</a>
    <a class="btn btn-outline-secondary" href="{{ url_for('financials.trial_balance') }}">ميزان المراجعة</a>
    <a target="_blank" class="btn btn-outline-secondary" href="{{ url_for('financials.income_statement', period=data.period, start_date=data.start_date, end_date=data.end_date) }}">طباعة</a>
  </div>

  </form>

  <div class="d-flex flex-wrap align-items-center gap-2 mb-3">
    <span class="badge bg-light text-dark border">الفترة: {{ data.period }}</span>
    <span class="badge bg-light text-dark border">من: {{ data.start_date }}</span>
    <span class="badge bg-light text-dark border">إلى: {{ data.end_date }}</span>
  </div>

  <div class="row g-3">
    <div class="col-6 col-md-3"><div class="card shadow-sm p-3 h-100"><div class="text-muted small">الإيرادات</div><div class="fs-4 fw-bold text-end">{{ '%.2f'|format(data.revenue) }}</div></div></div>
    <div class="col-6 col-md-3"><div class="card shadow-sm p-3 h-100"><div class="text-muted small">تكلفة المبيعات (COGS)</div><div class="fs-4 fw-bold text-end">{{ '%.2f'|format(data.cogs) }}</div></div></div>
    <div class="col-6 col-md-3"><div class="card shadow-sm p-3 h-100"><div class="text-muted small">الربح الإجمالي</div><div class="fs-4 fw-bold text-end">{{ '%.2f'|format(data.gross_profit) }}</div></div></div>
    <div class="col-6 col-md-3"><div class="card shadow-sm p-3 h-100"><div class="text-muted small">المصاريف التشغيلية</div><div class="fs-4 fw-bold text-end">{{ '%.2f'|format(data.operating_expenses) }}</div></div></div>
    <div class="col-6 col-md-3"><div class="card shadow-sm p-3 h-100"><div class="text-muted small">الربح التشغيلي</div><div class="fs-4 fw-bold text-end">{{ '%.2f'|format(data.operating_profit) }}</div></div></div>
    <div class="col-6 col-md-3"><div class="card shadow-sm p-3 h-100"><div class="text-muted small">دخل آخر</div><div class="fs-4 fw-bold text-end">{{ '%.2f'|format(data.other_income) }}</div></div></div>
    <div class="col-6 col-md-3"><div class="card shadow-sm p-3 h-100"><div class="text-muted small">مصروفات أخرى</div><div class="fs-4 fw-bold text-end">{{ '%.2f'|format(data.other_expenses) }}</div></div></div>
    <div class="col-6 col-md-3"><div class="card shadow-sm p-3 h-100"><div class="text-muted small">الربح قبل الضريبة</div><div class="fs-4 fw-bold text-end">{{ '%.2f'|format(data.net_profit_before_tax) }}</div></div></div>
    <div class="col-6 col-md-3"><div class="card shadow-sm p-3 h-100"><div class="text-muted small">ضريبة (دخل)</div><div class="fs-4 fw-bold text-end">{{ '%.2f'|format(data.tax) }}</div></div></div>
    <div class="col-6 col-md-3"><div class="card shadow-sm p-3 h-100"><div class="text-muted small">الربح بعد الضريبة</div><div class="fs-4 fw-bold text-end">{{ '%.2f'|format(data.net_profit_after_tax) }}</div></div></div>
  </div>

  <div class="mt-3 small text-muted">الفترة: {{ data.start_date }} إلى {{ data.end_date }}</div>
</div>
{% endblock %}
