{% extends "base.html" %}

{% block title %}{{ _('Expense Invoice Details') }} - {{ invoice.invoice_number }}{% endblock %}

{% block content %}
<div class="container py-4 ops-layout hub-wrap">
  <div class="ops-header-bar">
    <span class="ops-icon"><i class="fa-solid fa-receipt"></i></span>
    <div>
      <h1 class="ops-title mb-0">{{ _('Expense Invoice Details') }}</h1>
      <span class="ops-subtitle">{{ invoice.invoice_number }}</span>
    </div>
    <div class="ops-actions">
      <button class="btn btn-sm btn-outline-secondary" onclick="window.close()"><i class="fa-solid fa-xmark me-1"></i>{{ _('Close') }}</button>
      <button class="btn btn-sm btn-primary" onclick="window.print()"><i class="fa-solid fa-print me-1"></i>{{ _('Print') }}</button>
    </div>
  </div>

  <div class="row g-3">
    <div class="col-md-6">
      <div class="ops-form-card">
        <div class="ops-form-head">{{ _('Invoice Information') }}</div>
        <div class="ops-form-body">
          <table class="table table-borderless table-sm mb-0">
                        <tr>
                            <td><strong>{{ _('Invoice Number') }}:</strong></td>
                            <td>{{ invoice.invoice_number }}</td>
                        </tr>
                        <tr>
                            <td><strong>{{ _('Date') }}:</strong></td>
                            <td>{{ invoice.date.strftime('%Y-%m-%d') }}</td>
                        </tr>
                        <tr>
                            <td><strong>{{ _('Payment Method') }}:</strong></td>
                            <td>
                                {% set pm = (invoice.payment_method or '')|lower %}
                                {% if pm == 'cash' %}{{ _('Cash') }}{% elif pm == 'bank' %}{{ _('Bank') }}{% elif pm == 'internal' %}{{ _('Internal') }}{% else %}{{ invoice.payment_method or '-' }}{% endif %}
                            </td>
                        </tr>
                        <tr>
                            <td><strong>{{ _('Status') }}:</strong></td>
                            <td>
                                {% if invoice.status == 'paid' %}<span class="badge bg-success">{{ _('Paid') }}</span>{% elif invoice.status == 'partial' %}<span class="badge bg-warning">{{ _('Partial') }}</span>{% else %}<span class="badge bg-danger">{{ _('Unpaid') }}</span>{% endif %}
                            </td>
                        </tr>
          </table>
        </div>
      </div>
    </div>
    <div class="col-md-6">
      <div class="ops-form-card">
        <div class="ops-form-head">{{ _('Financial Summary') }}</div>
        <div class="ops-form-body">
          <table class="table table-borderless table-sm mb-0">
                        <tr>
                            <td><strong>{{ _('Subtotal') }}:</strong></td>
                            <td class="text-end">﷼{{ "%.2f"|format(invoice.total_before_tax) }}</td>
                        </tr>
                        <tr>
                            <td><strong>{{ _('Tax') }}:</strong></td>
                            <td class="text-end">﷼{{ "%.2f"|format(invoice.tax_amount) }}</td>
                        </tr>
                        <tr>
                            <td><strong>{{ _('Discount') }}:</strong></td>
                            <td class="text-end text-danger">-﷼{{ "%.2f"|format(invoice.discount_amount) }}</td>
                        </tr>
            <tr class="border-top"><td><strong class="fs-5">{{ _('Total') }}:</strong></td><td class="text-end"><strong class="fs-5">﷼{{ "%.2f"|format(invoice.total_after_tax_discount) }}</strong></td></tr>
          </table>
        </div>
      </div>
    </div>
  </div>

  <div class="ops-form-card mt-3">
    <div class="ops-form-head">{{ _('Invoice Items') }}</div>
    <div class="ops-form-body">
      {% if items %}
      <div class="screen-table-wrap">
        <table class="table screen-table">
          <thead>
            <tr>
                                    <th>{{ _('Description') }}</th>
                                    <th class="text-center">{{ _('Quantity') }}</th>
                                    <th class="text-end">{{ _('Unit Price') }}</th>
                                    <th class="text-end">{{ _('Tax') }}</th>
                                    <th class="text-end">{{ _('Discount') }}</th>
                                    <th class="text-end">{{ _('Total') }}</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for item in items %}
                                <tr>
                                    <td><strong>{{ item.description }}</strong></td>
                                    <td class="text-center">{{ item.quantity }}</td>
                                    <td class="text-end">﷼{{ "%.2f"|format(item.price_before_tax) }}</td>
                                    <td class="text-end">﷼{{ "%.2f"|format(item.tax) }}</td>
                                    <td class="text-end text-danger">-﷼{{ "%.2f"|format(item.discount) }}</td>
                                    <td class="text-end"><strong>﷼{{ "%.2f"|format(item.total_price) }}</strong></td>
                                </tr>
                                {% endfor %}
          </tbody>
        </table>
      </div>
      {% else %}
      <p class="text-muted mb-0">{{ _('No items found') }}</p>
      {% endif %}
    </div>
  </div>

  <div class="text-center mt-3">
    <small class="text-muted">{{ _('Generated on') }}: {{ moment().format('YYYY-MM-DD HH:mm:ss') }}</small>
  </div>
</div>

<style>
@media print {
    .btn {
        display: none !important;
    }
    .card {
        border: 1px solid #000 !important;
    }
    .card-header {
        background-color: #f8f9fa !important;
        color: #000 !important;
    }
}
</style>
{% endblock %}

