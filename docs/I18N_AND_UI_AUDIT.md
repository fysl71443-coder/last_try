# فحص شامل: الترجمة والواجهة والاستجابة والطباعة
## Full Audit: i18n, Buttons, Icons, Responsive, Filtering, Print

تاريخ الإعداد: 2026-02

---

## ١. دعم تبديل اللغة الكامل (i18n)

### المطلوب
- **جميع الصفحات، النماذج، الأزرار، رسائل التنبيه، التلميحات، عناوين الأعمدة، والقوائم** تستخدم الترجمة.
- **ملف ترجمات موحد**: `translations/ar/LC_MESSAGES/messages.po` و `translations/en/LC_MESSAGES/messages.po` (Babel/gettext).
- **كل رسالة flash، tooltip، placeholder، label** تُستدعى عبر `_('...')` في القوالب أو `gettext`/`_()` في بايثون.
- **الاختبار**: تغيير اللغة من الواجهة (رابط EN/ع في base.html) → كل النصوص تتحول بدون قص أو تشوه.

### المطبوعات والتقارير
- **PDF / HTML للطباعة** يجب أن يعكس اللغة المختارة: استخدام `get_locale()` في القالب و `lang="{{ get_locale() or 'ar' }}"` و `dir="rtl"` أو `ltr` حسب اللغة.
- إذا **لم تُدعَم لغة** في التقرير، إظهار رسالة تنبيه للمستخدم (مثلاً: "هذا التقرير متوفر حالياً بالعربية فقط").

### الحالة الحالية
- التطبيق يستخدم **Flask-Babel** و `session['locale']` وروابط **set_language** (EN/ع) في base.html.
- كثير من القوالب تستخدم `{{ _('...') }}`؛ بعض النصوص ما زالت ثابتة (عربي أو إنجليزي فقط).
- قوالب الطباعة التي تم فحصها تستخدم `get_locale()` في `lang` و `dir`.

### خطوات عملية للمطور
1. استخراج النصوص الجديدة: `pybabel extract -F babel.cfg -o messages.pot .` ثم `pybabel update -i messages.pot -d translations`.
2. إكمال ترجمة `translations/ar/LC_MESSAGES/messages.po` و `translations/en/LC_MESSAGES/messages.po`.
3. في كل **flash(...)** استخدم `flash(_('النص'), 'success'|'danger'|'warning')`.
4. في القوالب: كل نص يظهر للمستخدم يجب أن يكون داخل `{{ _('النص') }}` أو ما يعادله.
5. **compile**: `pybabel compile -d translations` (أو `python compile_translations.py` إن وُجد).

---

## ٢. الأزرار والوظائف

### التحقق لكل زر
| العنصر | المطلوب |
|--------|---------|
| **وجود الزر** | حفظ، تعديل، حذف، فلترة، إضافة، طباعة، إقفال سنة، تجاوز تدقيق، إلخ — حسب صلاحية الشاشة. |
| **النص** | مترجم بالكامل عبر `_('...')`. |
| **الأيقونة** | FontAwesome أو SVG مناسب للوظيفة (مثلاً حفظ = fa-save، حذف = fa-trash). |
| **اللون** | primary (أزرق)، secondary (رمادي)، danger (أحمر)، success (أخضر)، warning (أصفر). |
| **Hover/Focus** | واضح ومميز (تحت خط، لون خلفية، إلخ). |

### الوظائف المرتبطة
- التأكد أن الزر **يؤدي الوظيفة الصحيحة** بدون أخطاء.
- **منع التكرار**: تعطيل الزر بعد الضغط (أو استخدام نموذج واحد فقط) حيث ينطبق.
- **منع العمليات غير المرخصة**: التحقق من الصلاحيات قبل تنفيذ الحفظ/التعديل/الحذف.

---

## ٣. الأيقونات والألوان والتنسيق

### الأيقونات
- جميع الأزرار أو الإجراءات المهمة لها **أيقونة مناسبة**.
- الأيقونات توضح وظيفة الزر بشكل **بديهي**.

### الألوان
- **موحدة**: primary (أزرق)، danger (أحمر)، success (أخضر)، warning (أصفر)، info (أزرق فاتح).
- **تباين**: التأكد من وضوح النص على الخلفية (contrast).

### التنسيق
- الهوامش، **padding**، **font-size** متناسقة.
- **الجداول**: قابلة للقراءة (striped، hover)، فواصل بين الأعمدة والأزرار واضحة.

---

## ٤. الاستجابة (Responsive)

### الاختبار على
- Desktop, Laptop, Tablet, Mobile.

### التحقق
- القوائم الجانبية تختفي أو تتحول إلى **قائمة hamburger** على الشاشات الصغيرة.
- **الجداول** قابلة للتمرير أفقياً عند الحاجة (`overflow-x: auto` أو جدول داخل حاوية scroll).
- الأزرار والمكونات **متجاوبة** عند تغيير حجم الشاشة (لا قص أو تداخل).

---

## ٥. الفلترة والحفظ والتعديل والحذف

### الفلترة
- كل القوائم (فواتير، حسابات، مخزون، تقارير) يمكن **فلترتها** حسب: التاريخ، الفرع، نوع العملية، الحالة (حسب ما ينطبق).
- نتائج الفلترة **دقيقة وسريعة**، بدون تحميل زائد (استخدام استعلامات بخيارات فلترة من الخادم).

### الحفظ / التعديل / الحذف
- كل عملية **تحقق شروط التحقق** (الحساب، نوع العملية، القيود الورقية) كما في `services/account_validation` و `services/gl_truth`.
- عرض **رسائل نجاح وفشل واضحة** (ومترجمة).
- **منع** الحفظ أو الحذف بدون صلاحية أو بيانات غير صحيحة.

### الأرشيف وإعادة الفتح
- عمليات **إعادة الفتح** والتعديل تعمل بشكل صحيح؛ الأرشيف يعرض العناصر المؤرشفة فقط حسب التصميم.

---

## ٦. الطباعة والمطبوعات

### المطلوب
- **جميع المطبوعات** (فواتير، كشف حساب مورد، تقرير PDF رسمي، ميزان مراجعة): تنسيق رسمي — غلاف، جدول مرتب، ألوان واضحة، **عناوين الأعمدة مترجمة**.
- **خيارات الطباعة**: Print from browser (HTML) أو PDF عبر WeasyPrint إن توفر.
- **تلميح** للمستخدم إذا لم يتوفر PDF مباشر.
- إزالة عناصر واجهة غير مطبوعة (أزرار، tooltips) في نسخة الطباعة (media print أو قالب print مخصص).

### اللغة في المطبوعات
- استخدام `get_locale()` في قوالب الطباعة و `lang` و `dir` حتى يعكس المطبوع اللغة المختارة.

---

## ٧. جدول التقييم الشامل (كل شاشة / تقرير)

يُعبَّأ بعد إجراء الفحص لكل شاشة. المعايير: لغة، أزرار، أيقونات، ألوان، تنسيق، استجابة، فلترة، حفظ/تعديل/حذف، طباعة، ملاحظات.

| الشاشة / التقرير | لغة | أزرار | أيقونات | ألوان | تنسيق | استجابة | فلترة | حفظ/تعديل/حذف | طباعة | ملاحظات |
|------------------|-----|-------|---------|-------|-------|----------|--------|-----------------|--------|----------|
| Sales / Invoices | ⬜ | ⬜ | ⬜ | ⬜ | ⬜ | ⬜ | ⬜ | ⬜ | ⬜ | — |
| Expenses | ⬜ | ⬜ | ⬜ | ⬜ | ⬜ | ⬜ | ⬜ | ⬜ | ⬜ | — |
| Purchases | ⬜ | ⬜ | ⬜ | ⬜ | ⬜ | ⬜ | ⬜ | ⬜ | ⬜ | — |
| Customers | ⬜ | ⬜ | ⬜ | ⬜ | ⬜ | ⬜ | ⬜ | ⬜ | ⬜ | — |
| Suppliers | ⬜ | ⬜ | ⬜ | ⬜ | ⬜ | ⬜ | ⬜ | ⬜ | ⬜ | — |
| Payments | ⬜ | ⬜ | ⬜ | ⬜ | ⬜ | ⬜ | ⬜ | ⬜ | ⬜ | — |
| Reports (Sales/Expenses/Purchases) | ⬜ | ⬜ | ⬜ | ⬜ | ⬜ | ⬜ | ⬜ | — | ⬜ | — |
| Financials (Trial Balance, Balance Sheet, Income, Cash Flow) | ⬜ | ⬜ | ⬜ | ⬜ | ⬜ | ⬜ | ⬜ | — | ⬜ | — |
| Journal / قيود اليومية | ⬜ | ⬜ | ⬜ | ⬜ | ⬜ | ⬜ | ⬜ | ⬜ | ⬜ | — |
| Fiscal Years / السنوات المالية | ⬜ | ⬜ | ⬜ | ⬜ | ⬜ | ⬜ | ⬜ | ⬜ | ⬜ | إقفال، تجاوز تدقيق |
| VAT | ⬜ | ⬜ | ⬜ | ⬜ | ⬜ | ⬜ | ⬜ | — | ⬜ | — |
| Employees / Payroll | ⬜ | ⬜ | ⬜ | ⬜ | ⬜ | ⬜ | ⬜ | ⬜ | ⬜ | — |
| Inventory | ⬜ | ⬜ | ⬜ | ⬜ | ⬜ | ⬜ | ⬜ | ⬜ | ⬜ | — |
| Menu / القائمة | ⬜ | ⬜ | ⬜ | ⬜ | ⬜ | ⬜ | ⬜ | ⬜ | ⬜ | — |
| Users / Settings | ⬜ | ⬜ | ⬜ | ⬜ | ⬜ | ⬜ | ⬜ | ⬜ | — | — |
| Dashboard | ⬜ | ⬜ | ⬜ | ⬜ | ⬜ | ⬜ | ⬜ | — | — | — |
| Customer Statement (كشف حساب عميل) | ⬜ | ⬜ | ⬜ | ⬜ | ⬜ | ⬜ | ⬜ | — | ⬜ | — |
| Supplier Statement (كشف حساب مورد) | ⬜ | ⬜ | ⬜ | ⬜ | ⬜ | ⬜ | ⬜ | — | ⬜ | — |
| Audit Report | ⬜ | ⬜ | ⬜ | ⬜ | ⬜ | ⬜ | ⬜ | ⬜ | ⬜ | — |
| Archive | ⬜ | ⬜ | ⬜ | ⬜ | ⬜ | ⬜ | ⬜ | ⬜ | ⬜ | — |
| Login | ⬜ | ⬜ | ⬜ | ⬜ | ⬜ | ⬜ | — | — | — | — |

**رموز التعبئة**: ✅ اجتاز الفحص | ⬜ لم يُفحص بعد | ❌ يحتاج إصلاح (يُوضح في الملاحظات).

---

## مراجع سريعة

- **الترجمة**: `babel.cfg`, `translations/*/LC_MESSAGES/messages.po`, `compile_translations.py`, `scripts/add_new_translations.py`, `scripts/merge_translations.py`.
- **اللغة في الطلب**: `session['locale']`, `main.set_language`, `get_locale()` في app (Babel).
- **القوالب**: استخدام `{{ _('msgid') }}` و `lang="{{ get_locale() or 'ar' }}"` و `dir="rtl"|"ltr"` في الطباعة.
