# ุงูุฅุทุงุฑ ุงูุดุงูู ูุงุฎุชุจุงุฑ ุงููุธุงู (System-Wide Audit & QA)

**ูุงุนุฏุฉ ุงูุงุฎุชุจุงุฑ:** ุงููุธุงู ูููุณููู ุฅูู 6 ุทุจูุงุช ูุชุฑุงุจุทุฉ. **ุฃู ุฎูู ูู ุทุจูุฉ = ูุดู ุงููุธุงู** ุญุชู ูู ุงูุจุงูู ูุนูู.

**ูุฑุงุฌุน ุฐุงุช ุตูุฉ:**
- [IMMUTABLE_ACCOUNTING_RULES.md](IMMUTABLE_ACCOUNTING_RULES.md) โ ููุงุนุฏ ุงููุญุงุณุจุฉ ุงูุซุงุจุชุฉ
- [FINANCIAL_YEAR_GUARD.md](FINANCIAL_YEAR_GUARD.md) โ ุญุงุฑุณ ุงูุณูุฉ ุงููุงููุฉ
- [AUDIT_FINDINGS_AND_FIXES.md](AUDIT_FINDINGS_AND_FIXES.md) โ ุชุตุญูุญุงุช ุงูุชุฏููู

---

## ุงูุทุจูุฉ 0๏ธโฃ: ุงูุฃุณุงุณ (Foundation Layer)

### ุงููุทุงู
| ุงูุจูุฏ | ุงููุตู |
|--------|--------|
| Logo / ุงูุดุฑูุฉ | ุงุณู ุงูุดุฑูุฉุ ุงูุดุนุงุฑุ VATุ ุงูุนููุงู |
| ุงูุฅุนุฏุงุฏุงุช ุงูุนุงูุฉ | ุงูุซููุ ุงููุบุฉุ ุงูุนููุฉุ ุฅุนุฏุงุฏุงุช ุงูุทุจุงุนุฉ |
| ุงููุณุชุฎุฏููู | ุฅูุดุงุกุ ุชุนุฏููุ ุชุนุทูู |
| ุงูุตูุงุญูุงุช | ุดุงุดุฉ/ุนูููุฉ ุญุณุจ ุงูุฏูุฑ ูุงููุฑุน |
| ุงูุณููุงุช ุงููุงููุฉ | ุฅูุดุงุกุ ูุชุญุ ุฅููุงูุ ุฅุนุงุฏุฉ ูุชุญ ุงุณุชุซูุงุฆูุฉ |

### ุงุฎุชุจุงุฑุงุช ุฅูุฒุงููุฉ
- [ ] **ูุง ุชูุฌุฏ ุดุงุดุฉ ุชุนูู ุจุฏูู ุณูุฉ ูุงููุฉ ููุชูุญุฉ** (ููุนูููุงุช ุงูุชู ุชูุฏุฎู ุจูุงูุงุช ูุงููุฉ).
- [ ] **ูู ุนูููุฉ ูุฑุชุจุทุฉ ุจุณูุฉ ููุชุฑุฉ** โ ุงูุชุงุฑูุฎ ูุญุฏุฏ ุงูุณูุฉุ ุงูุชุญูู ูู `services/gl_truth.py`:
  - `is_period_open_for_date(d)`
  - `can_create_invoice_on_date(d)`
  - `can_mutate_journal(je)`
- [ ] **ุงูุตูุงุญูุงุช ุชููุน:**
  - ุงูุชุนุฏูู ุจุนุฏ ุงูุฅููุงู (403 + ุฑุณุงูุฉ ูุงุถุญุฉ).
  - ุงูุญุฐู ุบูุฑ ุงููุตุฑูุญ.
- [ ] **ุงุณู ุงูุดุฑูุฉ ู VAT ูุธูุฑุงู ูู:** ุงูุชูุงุฑูุฑุ ุงูุทุจุงุนุฉุ PDF.

> ๐ด **ูุนูุงุฑู:** ุฃู ุนูููุฉ ูุง ุชุชุญูู ูู ุงูุณูุฉ ุงููุงููุฉ = ุฎูู ูุนูุงุฑู.

---

## ุงูุทุจูุฉ 1๏ธโฃ: ุงููุงุฌูุงุช ูุงูุชููู (UI & Navigation)

### ุงููุทุงู
- ุงูุฑุฆูุณูุฉ (ููุญุฉ ุงูุชุญูู)
- ุงููุตูู ุงูุณุฑูุน (ุงูุจุทุงูุงุช)
- ุงูููุงุฆู ุงูุฌุงูุจูุฉ / ุงูุฑูุงุจุท
- ุงูุฑูุงุจุท ุงููุชูุงุทุนุฉ ุจูู ุงูุดุงุดุงุช

### ุงุฎุชุจุงุฑุงุช ุฅูุฒุงููุฉ
- [ ] ูุง ููุฌุฏ ุฒุฑ ูุง ูุนูู.
- [ ] ูุง ููุฌุฏ ุชุญููู ุฌุฒุฆู ุจุฏูู ูุคุดุฑ (loading).
- [ ] ูุง ููุฌุฏ ุชุฃุฎูุฑ ุบูุฑ ูุจุฑุฑ.
- [ ] ูู ุฒุฑ ูููุฏ ููุณุงุฑู ุงูุตุญูุญ (ูุง 404ุ ูุง ุชูุฌูู ุฎุงุทุฆ).

### ุงุฎุชุจุงุฑ ูุณุงุฑ ุญุฑุฌ
- [ ] **ุงูุฏุฎูู ูู ุงูุฑุฆูุณูุฉ โ ุงููุจูุนุงุช โ ุญูุธ โ ุงูุฑุฌูุน โ ุงูุชูุฑูุฑ** ุฏูู ุฅุนุงุฏุฉ ุชุญููู ูุงูู ุฃู ููุฏุงู ุญุงูุฉ.

---

## ุงูุทุจูุฉ 2๏ธโฃ: ุงูุนูููุงุช ุงูุชุดุบูููุฉ (Operational Transactions)

### 1. ุงููุจูุนุงุช
| ุงูุจูุฏ | ุงูุชุญูู |
|--------|--------|
| ููุฏู / ุขุฌู | ุทุฑููุฉ ุงูุฏูุน โ ุงูุญุณุงุจ ุงูุตุญูุญ (ุตูุฏูู/ุจูู/ุนููู) |
| VAT | ุญุณุงุจ ุถุฑูุจุฉ ูุฎุฑุฌุงุช ุตุญูุญุ ุงููุจูุบ ูู ุงูููุฏ |
| ุฎุตู | ูุง ูุคุซุฑ ุนูู ุชูุงุฒู ุงูููุฏุ ุงูุฅูุฑุงุฏ ุตุงูู |
| ุชุญููู ููุฎุฒูู | ุฅู ููุฌุฏุ ุฑุจุท ุจุงููุฎุฒูู |
| ุชูููุฏ ูุงุชูุฑุฉ | ุฑูู ูุงุชูุฑุฉุ ุนูููุ ุชุงุฑูุฎ |
| ุชูููุฏ ููุฏ | ููุฏ ููุดูุฑ ูุฑุชุจุท ุจุงููุงุชูุฑุฉ (`invoice_id` + `invoice_type`) |

**ุงูุชุญูู:** ุงูุนููู ุงูุตุญูุญุ ุญุณุงุจ ุงูุฅูุฑุงุฏ ุงูุตุญูุญุ ุญุณุงุจ VAT ุงูุตุญูุญุ ุญุณุงุจ ุงูุตูุฏูู/ุงูุจูู/ุงูุนููู.

### 2. ุงููุดุชุฑูุงุช
| ุงูุจูุฏ | ุงูุชุญูู |
|--------|--------|
| ููุฑุฏ | ุงูููุฑุฏ ูุฑุชุจุท ุจุญุณุงุจ ุฐูู ุฏุงุฆูุฉ (2111) ุฃู ูุง ููุนุชูุฏ |
| ููุฏ / ุขุฌู | ููุฏ โ ุตูุฏูู/ุจููุ ุขุฌู โ ููุฑุฏ |
| VAT | ุถุฑูุจุฉ ูุฏุฎูุงุช ูู ุงูุญุณุงุจ ุงููุนุชูุฏ |
| ูุฎุฒูู | ุญุณุงุจ ูุฎุฒูู ุฃู ูุตุฑูู ุญุณุจ ููุน ุงููุดุชุฑูุงุช |
| ุงูููุฏ ูุชูุงุฒู | ูุฏูู = ุฏุงุฆู |

### 3. ุงููุตุฑููุงุช
| ุงูุจูุฏ | ุงูุชุญูู |
|--------|--------|
| ููุฏ / ุจูู | ูุง ุฎูุท ูุน ุญุณุงุจ ุงูููุฑุฏ ุนูุฏ ุงูุณุฏุงุฏ ุงูููุฏู/ุงูุจููู |
| ุฎุงุถุน / ุบูุฑ ุฎุงุถุน | ุฑุจุท ููุน ุงููุตุฑูู ุจู VAT |
| ุชุดุบูููุฉ / ุบูุฑ ุชุดุบูููุฉ | ุงูุญุณุงุจ ูู ุงูุดุฌุฑุฉ (ูุฌููุนุฉ 5xxx ููุงุณุจุฉ) |
| ุงูุญุณุงุจ ุงููุณุชุฎุฏู | ูู ุงูุดุฌุฑุฉุ ุนุฏู ุงุณุชุฎุฏุงู ุญุณุงุจ ุนุงู ุฎุงุทุฆ |

### 4. ุงููุฏููุนุงุช
| ุงูุจูุฏ | ุงูุชุญูู |
|--------|--------|
| ุณุฏุงุฏ ููุฑุฏ | ุชูููู ุฐูู ุงูููุฑุฏุ ูุง ูููุฏ ูุตุฑูู/ุฅูุฑุงุฏ |
| ุชุญุตูู ุนููู | ุชูููู ุฐูู ุงูุนูููุ ูุง ูููุฏ ุฅูุฑุงุฏ ุฅุถุงูู |
| ุฌุฒุฆู / ูุงูู | ุงููุจูุบ ููุณุฌูู ุตุญูุญุ ุงูุฑุตูุฏ ุงููุชุจูู ุตุญูุญ |

**ุงูุชุญูู:** ูุง ูููุฏ ูุตุฑูู ุฃู ุฅูุฑุงุฏุ ููุท ุชุณููุฉ ุญุณุงุจุงุช.

---

## ุงูุทุจูุฉ 3๏ธโฃ: ุงูุจูุงูุงุช ุงููุฑุฌุนูุฉ (Masters)

### ุงูุดุงุดุงุช
ุงูุนููุงุกุ ุงูููุฑุฏููุ ุงูุฃุตูุงูุ ุงููุฎุฒููุ ุงูููููุ ุงูุทุงููุงุชุ ุงูููุธููู.

### ุงุฎุชุจุงุฑุงุช ุฅูุฒุงููุฉ
- [ ] ูุง ูููู ุญุฐู ุณุฌู **ูุณุชุฎุฏู ูู ุนูููุงุช** (ุฃู ุญุฐู ูุน ุชุญุฐูุฑ ูุจุฏูู).
- [ ] ุงูุชุนุฏูู ููุนูุณ ููุฑูุง ูู ุงูููุงุฆู ูุงูุนูููุงุช ุงููุฑุชุจุทุฉ.
- [ ] ูู ููุงู ูุฑุชุจุท **ุจุญุณุงุจ ุงูุชุฑุงุถู ุตุญูุญ** (ููุฑุฏ โ 2111ุ ุนููู โ 1141ุ ุฅูุฎ).

**ูุนูุงุฑู:** ููุฑุฏ ุจุฏูู ุญุณุงุจ = ูุง ูุณูุญ ุจุฅูุดุงุก ูุงุชูุฑุฉ ูุดุชุฑูุงุช (ุฃู ููุนุชูุฏ ุญุณุงุจ ุงูุชุฑุงุถู ููุซู).

---

## ุงูุทุจูุฉ 4๏ธโฃ: ุงููุญุงุณุจุฉ (Accounting Core โ ุฑูุญ ุงููุธุงู)

### ุงูุดุงุดุฉ ุงููุฑูุฒูุฉ
**ุดุงุดุฉ ุงูุญุณุงุจุงุช ุงููุชูุงููุฉ:** ุดุฌุฑุฉ ุงูุญุณุงุจุงุชุ ูููุฏ ุงูููููุฉุ ุฏูุชุฑ ุงูุฃุณุชุงุฐุ ููุฒุงู ุงููุฑุงุฌุนุฉุ ุงููุดููุงุชุ ุงูุนูููุงุชุ ุฅุนุฏุงุฏุงุช ุงูุญุณุงุจุงุช.

### ุงุฎุชุจุงุฑุงุช ุฌููุฑูุฉ
- [ ] **ูุง ูุณูุญ ุจุงูููุฏ ุนูู Parent** โ ููุท ุงูุญุณุงุจุงุช ุงููุฑููุฉ (Leaf) ุชูุจู ูููุฏุงู.
- [ ] **ุงูููุฏ ุฏุงุฆููุง ูุชูุงุฒู** โ ูุฏูู = ุฏุงุฆู ูุจู ุงููุดุฑ.
- [ ] **ูุง ููุฏ ุจุฏูู ุนูููุฉ ุฃู ุณุจุจ** โ ุงููููุฏ ุงููุฏููุฉ ูุณููุญุฉุ ุงููููุฏ ุงูุชููุงุฆูุฉ ูุฑุชุจุทุฉ ุจูุงุชูุฑุฉ/ุนูููุฉ.
- [ ] **ูู ููุฏ ูุนูุฏ ููุตุฏุฑู** โ ูู ุงูููุฏ โ ุงูุนูููุฉ โ ุงููุณุชุฎุฏู โ ุงูุณูุฉ.

### ุงุฎุชุจุงุฑ ุนูุณู
- [ ] ุงุฎุชุฑ ููุฏ โ ุงุนุฑู ุงูุนูููุฉ โ ุงุนุฑู ุงููุณุชุฎุฏู โ ุงุนุฑู ุงูุณูุฉ (ุชุชุจุน ูุงูู).

---

## ุงูุทุจูุฉ 5๏ธโฃ: ุงูุชูุงุฑูุฑ ูุงูููุงุฆู ุงููุงููุฉ

### ุงูุชูุงุฑูุฑ
ููุฒุงู ุงููุฑุงุฌุนุฉุ ุฏูุชุฑ ุงูุฃุณุชุงุฐุ ูุดู ุนููู/ููุฑุฏุ VATุ ุงูุฃุฑุดูู.

### ุงูููุงุฆู ุงููุงููุฉ
ูุงุฆูุฉ ุงูุฏุฎูุ ุงููุฑูุฒ ุงููุงูู (ุงูููุฒุงููุฉ)ุ ุงูุชุฏูู ุงูููุฏู.

### ุงุฎุชุจุงุฑุงุช ุฅูุฒุงููุฉ
- [ ] **ููุณ ุงูุญุณุงุจ ูุง ูุธูุฑ ูู ุชูุฑูุฑูู ุจุดูู ุบูุฑ ููุทูู** (ุชูุฑุงุฑ ุฃู ุชุถุงุฑุจ).
- [ ] **ุงูุฃุฑูุงู = ูุฌููุน ุงููููุฏ ููุท** โ ูุง ูุตุฏุฑ ุขุฎุฑ ููุฃุฑูุงู.
- [ ] **ูุง ุญุณุงุจ Parent ูุธูุฑ ุจุฑุตูุฏ** โ ููุท ุงูุญุณุงุจุงุช ุงููุฑููุฉ ููุง ุฃุฑูุงูุ ุงูุชุฌููุนูุฉ ุนูุงููู ุฃู ูุฌุงููุน ูู ุงูุฃุจูุงุก.
- [ ] **ุงูุฑุตูุฏ ููุนุฑุถ ุจุดูู ูููู** โ ูุฏูู/ุฏุงุฆู ุฃู "X ูุฏูู" / "X ุฏุงุฆู" ูููุณ ุฑููุงู ุณุงูุจุงู ููุท.

> ๐ด **ูุนูุงุฑู:** ุงูููุงุฆู ุงููุงููุฉ **ูุง ุชูุญุณุจ ูุจุงุดุฑุฉ**ุ ุจู **ุชูุณุชุฎุฑุฌ ูู ุงููููุฏ ููุท**.

---

## ุงูุทุจูุฉ 6๏ธโฃ: ุงูุชุฏููู ูุงูุฅููุงู (Audit & Close)

### ุงูุดุงุดุงุช
ุงููุญุงุณุจุฉ ูุงูุชุฏููู (ุชูุฑูุฑ ุงูุชุฏููู)ุ ุงูุณููุงุช ุงููุงููุฉ (ุชูุงุตููุ ุฅููุงูุ ุฅุนุงุฏุฉ ูุชุญ).

### ุงุฎุชุจุงุฑุงุช ุฅูุฒุงููุฉ
- [ ] **ุงูุชุฏููู ููุชุดู:** ูููุฏ ุบูุฑ ูุชูุงุฒูุฉุ ุญุณุงุจุงุช ุฎุงุทุฆุฉุ ูุชุฑุงุช ูุบููุฉุ ููุงุชูุฑ ุจุฏูู ููุฏุ ุฅูุฎ.
- [ ] **ูุง ุฅููุงู ูุน ููุงุญุธุงุช ุญุฑุฌุฉ** ุฅูุง ุจุชุฌุงูุฒ ููุซู (ูุจุฑุฑ + ูุณุชุฎุฏู).
- [ ] **ูู ุฅููุงู ูู:** ูุณุชุฎุฏูุ ุชุงุฑูุฎุ ููุทุฉ ุชุฏููู (snapshot).

---

## ๐ ูุตูููุฉ ุงูุงุฎุชุจุงุฑ ุงูููุงุฆูุฉ (Test Matrix)

ููู ุดุงุดุฉ/ุนูููุฉ ููุชุญูู ูู: UIุ ุงูููุทูุ ุงูููุฏุ ุงูุชูุฑูุฑุ ุงููุงุฆูุฉ ุงููุงููุฉ.

| ุงูุจูุฏ | UI | ููุทู | ููุฏ | ุชูุฑูุฑ | ูุงุฆูุฉ ูุงููุฉ |
|--------|:---:|:---:|:---:|:---:|:---:|
| ุงููุจูุนุงุช | โ | โ | โ | โ | โ |
| ุงููุดุชุฑูุงุช | โ | โ | โ | โ | โ |
| ุงููุตุฑููุงุช | โ | โ | โ | โ | โ |
| ุงููุฏููุนุงุช | โ | โ | โ | โ | โ |
| ุงููุฎุฒูู | โ | โ | โ | โ | โ |
| **ุงูุญุณุงุจุงุช** | โ | โ | ๐ฅ | ๐ฅ | ๐ฅ |
| **ุงูุณููุงุช ุงููุงููุฉ** | โ | โ | โ | ๐ฅ | ๐ฅ |

**๐ฅ = ูุง ููุจู ุฃู ุฎุทุฃ** (ูุนูุงุฑ ูุจูู ุตุงุฑู).

---

## ๐ฏ ุงููุงุชุฌ ุงูููุงุฆู (Acceptance Result)

ุจุนุฏ ุชูููุฐ ูุฐุง ุงูุฅุทุงุฑ ูุงูุงุฎุชุจุงุฑ ุจูุฌุงุญ:

| ุงููุนูุงุฑ | ุงููุชูุฌุฉ |
|---------|---------|
| ุงููุธุงู ุตุงูุญ ูุญุงุณุจููุง | โ |
| ุงูููุงุฆู ุงููุงููุฉ ููุซููุฉ | โ |
| ุงูุชูุงุฑูุฑ ูุงุจูุฉ ูููุฑุงุฌุนุฉ | โ |
| ุงูุชุฏููู ููุณ ุดููููุง | โ |
| ุงููุธุงู ูุนุชูุฏ ููุตุฏุฑ ุญูููุฉ | โ |

---

## ุฑุจุท ุจุงูููุฏ ูุงูุงุฎุชุจุงุฑุงุช ุงูุญุงููุฉ

| ุงูุทุจูุฉ | ูุฑุงุฌุน ุงูููุฏ / ุงูุงุฎุชุจุงุฑุงุช |
|--------|---------------------------|
| 0 | `services/gl_truth.py`, `routes/fiscal_years.py`, `app/routes.py` (settings, users) |
| 1 | `templates/base.html`, `templates/dashboard.html`, `static/js/nav-partial.js` |
| 2 | `routes/sales.py`, `routes/purchases.py`, `routes/expenses.py`, `routes/payments.py` |
| 3 | `routes/` (customers, suppliers, menu, employees), `models.py` |
| 4 | `routes/financials.py` (accounts_hub), `routes/journal.py`, `data/coa_new_tree.py` |
| 5 | `routes/financials.py` (trial_balance, income_statement, balance_sheet, account_statement) |
| 6 | `routes/journal.py` (audit), `routes/fiscal_years.py` (close, reopen), `modules/audit/` |

**ุงุฎุชุจุงุฑุงุช ุฃูุชููุงุชูููุฉ:** `tools/e2e_smoke.py`, `tests/test_audit_engine.py`, `tests/test_routes_smoke_pytest.py`.

---

*ุขุฎุฑ ุชุญุฏูุซ: ููู ุฅุทุงุฑ ุงูุงุฎุชุจุงุฑ ุงูุดุงูู ุงููุชูู ุนููู.*
