# ุฎุฑูุทุฉ ุงููุธุงู ุงูุญุงููุฉ โ China Town / Place India

ูุซููุฉ ุชุตู **ุงูุจููุฉ ุงููุนููุฉ** ูููุธุงู ุงูุญุงูู ูุฏุนู ุงูุชุญุณูู ูุงูุตูุงูุฉ.

---

## ูก. ูุธุฑุฉ ุนุงูุฉ

| ุงูุจูุฏ | ุงููุตู |
|--------|--------|
| **ุงูููุน** | ุชุทุจูู ููุจ ูุญุงุณุจู + ููุทุฉ ุจูุน (POS) ููุทุนููู: China Town ู Place India |
| **ุงูุฅุทุงุฑ** | Flask (Python) |
| **ูุงุนุฏุฉ ุงูุจูุงูุงุช** | SQLite (ูุญูู) / PostgreSQL (ุฅูุชุงุฌุ ูุซุงู: Render) |
| **ุงููุงุฌูุฉ** | Jinja2 + Bootstrap 5 + Font Awesome + CSS ูุฎุตุต (`screens.css`, `style.css`) |
| **ุงููุตุงุฏูุฉ** | Flask-Login + bcrypt |
| **ุงููุบุฉ** | ุนุฑุจู + ุฅูุฌููุฒู (ุฏุนู RTLุ ูููุงุช ุชุฑุฌูุฉ ูู `translations/`) |

---

## ูข. ููุทุฉ ุงูุฏุฎูู ูุงูุชุดุบูู

```
wsgi.py
  โโโ from app import app   โ  application (ูู Gunicorn)

app/__init__.py
  โโโ create_app()
  โโโ app = create_app()    โ  ุงูุชุทุจูู ุงููุนูู ุงูููุตุฏููุฑ
```

- **ุงููุดุฑ (Render):** `Procfile` โ `run_migrations.py` ุซู `gunicorn ... wsgi:application`
- **ูุญููุงู:** `python app.py` ุฃู `python -m app` ุฃู `flask run` (ุญุณุจ ุงูุฅุนุฏุงุฏ)

ููู **`app.py`** ูู ุงูุฌุฐุฑ ุนุจุงุฑุฉ ุนู **monolith ูุฏูู** ูุญุฏุซุ ุงูุชุนููู ูููู ุฅู ุงูุชุทุจูู ุงูุฑุฆูุณู ุงูุชูู ุฅูู **`app/`**. ูุนุธู ุงูุณูุฑุจุชุงุช ูุงูุงุฎุชุจุงุฑุงุช ุชุณุชูุฑุฏ `from app import create_app` ุฃู `from app import app`.

---

## ูฃ. ูููู ุงููุดุฑูุน (ุงููุฌูุฏุงุช ุงูุฑุฆูุณูุฉ)

```
CHINA TOWN-PLACE INDIA/
โโโ app/                      โ ุญุฒูุฉ ุงูุชุทุจูู ุงูุฑุฆูุณูุฉ
โ   โโโ __init__.py           โ create_app(), ุชุณุฌูู Blueprints
โ   โโโ routes.py             โ main + vat (ุงูุฌุฒุก ุงูุฃูุจุฑ ูู ุงููุณุงุฑุงุช)
โ   โโโ models.py             โ User, AppKV, TableLayout
โ   โโโ emp_pay.py            โ payroll / ุฏูุน ุงูุฑูุงุชุจ
โ   โโโ reports/
โ       โโโ payroll_reports.py
โโโ routes/                   โ Blueprints ูููุตูุฉ (ุชูุณุฌููู ูู app)
โ   โโโ journal.py            โ /journal/*  (ูููุฏ ุงูููููุฉ)
โ   โโโ financials.py         โ /financials/* (ุญุณุงุจุงุชุ ููุฒุงูุ ูุงุฆูุฉ ุฏุฎูุ ุฅูุฎ)
โ   โโโ vat.py                โ (ูุฏ ููุณุชุฎุฏู ูุฌุฒุก ูู VAT)
โ   โโโ print_receipt.py      โ (ุทุจุงุนุฉ ุฅูุตุงูุงุช โ ูุฏ ูุง ูููู ููุณุฌูููุงู)
โโโ models.py                 โ ุงูููุงุฐุฌ ุงูุฑุฆูุณูุฉ (ุฌุฏุงูู DB)
โโโ forms.py                  โ WTForms
โโโ config.py                 โ ุฅุนุฏุงุฏุงุช (DB, SECRET_KEY, ุฅูุฎ)
โโโ extensions.py             โ db, bcrypt, login_manager, migrate, babel, csrf
โโโ templates/                โ ููุงูุจ Jinja2 (ุฃุบูุจ ุงูุดุงุดุงุช)
โโโ static/                   โ css, js, ุตูุฑุ ุฑูุน ูููุงุช
โโโ migrations/               โ Alembic (ูุณุฎ ูุงุนุฏุฉ ุงูุจูุงูุงุช)
โโโ translations/             โ ูููุงุช .po / .mo ููุชุฑุฌูุฉ
โโโ accounting-service/       โ ุฎุฏูุฉ Node.js (ูุญุงุณุจุฉ ูููุตูุฉุ REST)
โโโ scripts/                  โ ุณูุฑุจุชุงุช ูุณุงุนุฏุฉุ ุจุฐูุฑุ ุฅุตูุงุญุงุช
โโโ tests/                    โ ุงุฎุชุจุงุฑุงุช
โโโ docs/                     โ ุชูุซูู (ุจูุง ูููุง ูุฐู ุงูุฎุฑูุทุฉ)
```

---

## ูค. ุงูุจููุฉ ุงูุชุทุจูููุฉ (Blueprints + ุงููุณุงุฑุงุช)

### โ ุจุนุฏ Phase 2 (ุชูุณูู ุงููุณุงุฑุงุช)

ุงูุชุทุจูู ูุณุฌูู ุงูู Blueprints ุงูุชุงููุฉ ูู **`app/__init__.py`**:

| Blueprint | ุงููุตุฏุฑ | ุงููุธููุฉ |
|-----------|--------|---------|
| **main** | `app.routes` | Auth, Dashboard, Employees/Salaries, Menu, Users, Settings, Invoices |
| **vat** | `app.routes` | ููุญุฉ VATุ ุทุจุงุนุฉ VAT |
| **journal** | `routes.journal` | ูููุฏ ุงูููููุฉ |
| **financials** | `routes.financials` | ุดุฌุฑุฉ ุงูุญุณุงุจุงุชุ ููุฒุงู ุงููุฑุงุฌุนุฉุ ูุงุฆูุฉ ุงูุฏุฎูุ ุงูููุฒุงููุฉ |
| **expenses** | `routes.expenses` | `/expenses` โ ููุงุชูุฑ ุงููุตุฑููุงุช |
| **purchases** | `routes.purchases` | `/purchases`, `/raw-materials`, `/meals` โ ุงููุดุชุฑูุงุช ูุงูููุงุฏ |
| **suppliers** | `routes.suppliers` | `/suppliers` โ ุงูููุฑุฏูู |
| **customers** | `routes.customers` | `/customers` โ ุงูุนููุงุก |
| **payments** | `routes.payments` | `/payments` โ ุงููุฏููุนุงุช ูุงูุชุญุตููุงุช |
| **inventory** | `routes.inventory` | `/inventory` โ ุงููุฎุฒูู ูุงูุฐูุงุก |
| **reports** | `routes.reports` | `/reports` โ ุงูุชูุงุฑูุฑ ุงููุทุจูุนุฉ |
| **sales** | `routes.sales` | `/sales`, `/pos/*` โ ุงููุจูุนุงุช ูููุงุท ุงูุจูุน |

- **`app/routes.py`** ุชูููุต ูู ~12000 ุณุทุฑ ุฅูู ~7500 ุณุทุฑ.
- **`routes/common.py`** ูุญุชูู ุนูู ุงููุณุงุนุฏุงุช ุงููุดุชุฑูุฉ (`kv_get`, `kv_set`, `BRANCH_LABELS`, `user_can`).

---

## ูฅ. ูุงุนุฏุฉ ุงูุจูุงูุงุช (ุงูููุงุฐุฌ ุงูุฑุฆูุณูุฉ)

ุงูููุงุฐุฌ ููุนุฑูููุฉ ูู **`models.py`** (ุงูุฌุฐุฑ) ู **`app/models.py`** (User, AppKV, TableLayout).

### ุงูุฌุฏุงูู ุงูุฃุณุงุณูุฉ

| ุงูุฌุฏูู | ุงูุบุฑุถ |
|--------|--------|
| **users** | ุงููุณุชุฎุฏููู ููููุงุช ุงููุฑูุฑ |
| **sales_invoices** | ููุงุชูุฑ ุงููุจูุนุงุช |
| **sales_invoice_items** | ุจููุฏ ููุงุชูุฑ ุงููุจูุนุงุช |
| **purchase_invoices** | ููุงุชูุฑ ุงููุดุชุฑูุงุช |
| **purchase_invoice_items** | ุจููุฏ ุงููุดุชุฑูุงุช |
| **expense_invoices** | ููุงุชูุฑ ุงููุตุฑููุงุช |
| **expense_invoice_items** | ุจููุฏ ุงููุตุฑููุงุช |
| **payments** | ุงููุฏููุนุงุช (ุฑุจุท ููุน ุงููุงุชูุฑุฉ + invoice_id) |
| **customers** | ุงูุนููุงุก |
| **suppliers** | ุงูููุฑุฏูู |
| **accounts** | ุดุฌุฑุฉ ุงูุญุณุงุจุงุช |
| **journal_entries** | ูููุฏ ุงูููููุฉ |
| **journal_lines** | ุฃุณุทุฑ ุงููููุฏ |
| **ledger_entries** | ุญุฑูุงุช ุฏูุชุฑ ุงูุฃุณุชุงุฐ |
| **employees** | ุงูููุธููู |
| **salaries** | ุงูุฑูุงุชุจ |
| **meals** | ุงููุฌุจุงุช |
| **meal_ingredients** | ููููุงุช ุงููุฌุจุงุช |
| **raw_materials** | ุงูููุงุฏ ุงูุฎุงู |
| **tables** | ุงูุทุงููุงุช |
| **draft_orders** | ุทูุจุงุช ุงููุณูุฏุฉ (POS) |
| **settings** | ุฅุนุฏุงุฏุงุช ุงููุธุงู ูุงูุดุฑูุฉ |
| **app_kv** | ุชุฎุฒูู ููุชุงุญโูููุฉ (ุตูุงุญูุงุชุ ุฅูุฎ) |

ุงูููุงุฑุณ ุงูุดุงุฆุนุฉ: `journal_entries` (entry_number, date, branch_code, status, invoice_id, invoice_type), `journal_lines` (journal_id, account_id), `ledger_entries` (account_id, date)ุ ุฅูุฎ.

---

## ูฆ. ุงููุงุฌูุงุช ุงูุฃูุงููุฉ

- **ุงููุงุนุฏุฉ:** `templates/base.html` (navbarุ ุฅุนุฏุงุฏุงุช ุนุงูุฉุ Bootstrapุ ุณูุฑุจุชุงุช ูุดุชุฑูุฉ).
- **ููุญุฉ ุงูุชุญูู:** `dashboard.html` โ ุจูุงุจุฉ ูุน sidebar (ูุฌููุนุงุช: ูุจูุนุงุชุ ูุดุชุฑูุงุชุ ูุญุงุณุจุฉุ ูุฎุฒููุ ูุธุงู) ูุจุทุงูุงุช ุชูุฌูู ููู ุดุงุดุฉ.
- **ุงูุดุงุดุงุช ุงูุฑุฆูุณูุฉ** ุชูุชุฏ `base.html` ูุชุณุชุฎุฏู ููุท **Hub** (ูุซู `ops-layout`, `hub-wrap`, `ops-header-bar`, `ops-form-card`) ุญุณุจ `docs/REDESIGN_PLAN_HUB.md`:
  - **ูุงููุฉ:** `journal_entries.html`, `financials/*`, `vat/vat_dashboard.html`, `reports.html`, `payments.html`, `invoices.html`, `expenses.html`, `purchases.html`, โฆ
  - **ุนููุงุก/ููุฑุฏูู:** `customers.html`, `suppliers.html`, โฆ
  - **ูุธุงู:** `settings.html`, `users.html`, `menu.html`, โฆ
- **ุงููุจูุนุงุช (POS):** `sales.html`, `sales_tables.html`, `sales_table_invoice.html`, โฆ (ูุณุชุซูุงุฉ ูู ุฎุทุฉ ุฅุนุงุฏุฉ ุงูุชุตููู ุงูุญุงููุฉ).
- **ุงูุฃุตูู ุงูุซุงุจุชุฉ:** `static/css/style.css`, `static/css/screens.css`, `static/js/main.js`, `modal-system.js`, `printInvoice.js`, `pos_table.js`, โฆ

---

## ูง. ุงูุฎุฏูุงุช ูุงูููุญูุงุช ุงูุฎุงุฑุฌูุฉ

| ุงูููููู | ุงููุตู |
|---------|--------|
| **accounting-service/** | ุฎุฏูุฉ Node.js (Express + PostgreSQL) โ **ูุตุฏุฑ ุงูุญูููุฉ ูููุญุงุณุจุฉ**. ุชุชูุงูู ูุน Flask ุนุจุฑ REST (ูุซูุงู ุชุฑุญูู ูููุฏ). |
| **TableManagerWinForms** | ุชุทุจูู ูููุฏูุฒ (C#) ูุณุชูู ูุฅุฏุงุฑุฉ ุงูุทุงููุงุชุ ููุณ ุฌุฒุกุงู ูู ุฎุงุฏู ุงูููุจ. |

---

## ูจ. ุงูุฅุนุฏุงุฏ ูุงููุดุฑ

- **ุงูุฅุนุฏุงุฏ:** `config.py` ููุฑุฃ `DATABASE_URL` (PostgreSQL ูู ุงูุฅูุชุงุฌ) ุฃู ูุณุชุฎุฏู SQLite ูุญููุงู. ููุงุชูุญ ุงูุฌูุณุฉ ูุงูู CSRF ูู ุงููุชุบูุฑุงุช ุงูุจูุฆูุฉ ุฅู ููุฌุฏุช.
- **ุงููุฌุฑุฉ:** `migrations/` (Alembic) + `run_migrations.py` ุนูุฏ ุงููุดุฑ.
- **ุงููุดุฑ:** `Procfile` โ Gunicorn ูุน `wsgi:application`. ุจูุงุก ุฅุถุงูู (ูุซูุงู `build.sh`) ุญุณุจ ุงูููุตุฉ.

---

## ูฉ. ุฎูุงุตุฉ ุงูุจููุฉ

1. **Monolith ูุจูุฑ ูู `app/routes.py`**  
   ูุนุธู ุงููุณุงุฑุงุช ูุงูู logic ูู ููู ูุงุญุฏ (main + vat + ุฅูุดุงุก ูููุฏ ูู ููุงุชูุฑุ ุฑูุงุชุจุ ูุฏููุนุงุชุ ุชูุงุฑูุฑุ โฆ). ูุฐุง ูุนููุฏ ุงูุตูุงูุฉ ูุงูุงุฎุชุจุงุฑ.

2. **ุงุฒุฏูุงุฌูุฉ ูุญุชููุฉ**  
   - **VAT:** ูุณุงุฑุงุช ูู `app.routes` (vat) ูููู `routes/vat.py` ูููุตู.  
   - **ุงููุงููุฉ:** ุฌุฒุก ูู `app.routes` (ูุซู chart-of-accountsุ ุฅูุดุงุก ูููุฏ) ูุฌุฒุก ูู `routes/financials`.

3. **ุชุจุนูุงุช ูุชุจุงุฏูุฉ**  
   `app.routes` ูุณุชุฏุนู ุฏูุงู ูู `routes.journal` (ูุซู `api_transactions_post`, `api_reconcile_vat`)ุ ุฃู ุงูู monolith ูุนุชูุฏ ุนูู ุงูู Blueprints ุงููููุตูุฉ.

4. **ูุงุนุฏุฉ ุจูุงูุงุช ูุงุญุฏุฉ**  
   ูู ูู Flask ู**accounting-service** ูุฏ ูุณุชุฎุฏูุงู PostgreSQLุ ุงูุชูุงูู ุนุจุฑ API ูููุณ ูุดุงุฑูุฉ ุฌุฏุงูู ูุจุงุดุฑุฉ ููุท.

5. **ููุท ุงููุงุฌูุฉ**  
   ุงูุดุงุดุงุช (ูุง ุนุฏุง ุงููุจูุนุงุช) ุชุชุจุน ูุธุงู **Hub Blue** ุงูููุซูู ูู `REDESIGN_PLAN_HUB.md` ู`DESIGN_SYSTEM.md` (ุชูุญูุฏ ุงูุฃููุงูุ ุงูุจุทุงูุงุชุ ุงูุฌุฏุงููุ ุงูุชุฎุทูุท).

---

## ูกู. ุงูุฎุทูุงุช ุงูููุชููุฉ ูุงูุชุงููุฉ

### โ ุงูููุชูู

| ุงููุฑุญูุฉ | ุงูุฅูุฌุงุฒ |
|---------|---------|
| **Phase 1** | ุชุฎููู ุงูุญูู โ ูุง ุชุญููู ูู accounts/settings/permissions ูู context_processor |
| **Phase 2** | ุชูุณูู ุงููุณุงุฑุงุช โ 8 blueprints ุฌุฏูุฏุฉ (expenses, purchases, suppliers, customers, payments, inventory, reports, sales) |
| **Phase 3** | Cache ุญูููู โ Flask-Caching + Redis (ุฃู SimpleCache). ูุงุด ูู settings (10 ุฏ)ุ COA (15 ุฏ)ุ VAT (5 ุฏ)ุ reports preview (2 ุฏ). |
| **Phase 4** | ุชุญุณูู ุงูุชููู โ ุชููู ุฌุฒุฆู (fetch + ุงุณุชุจุฏุงู `#app-messages` ู `#app-main` ููุท). ุงูููุฏุฑ ุซุงุจุชุ ูุคุดุฑ ุชุญูููุ ุฏุนู ุฒุฑ ุงูุฑุฌูุน. |

### ๐ ุงูุฎุทูุงุช ุงูุชุงููุฉ

| ุงููุฏู | ุงูุฅุฌุฑุงุก ุงูููุชุฑุญ |
|-------|------------------|
| **ุชูุญูุฏ VAT** | ุงูุงุนุชูุงุฏ ุนูู ูุตุฏุฑ ูุงุญุฏ ูู VAT |
| **ุงุฎุชุจุงุฑุงุช** | ุฒูุงุฏุฉ ุชุบุทูุฉ ุงุฎุชุจุงุฑุงุช ุงููุณุงุฑุงุช ูุงูู API |

---

ุชู ุฅุนุฏุงุฏ ูุฐู ุงูุฎุฑูุทุฉ ุงูุทูุงูุงู ูู ูููู ุงููุดุฑูุน ูุงูููุฏ ุงูุญุงูู. ูููู ุชูุณูุน ุฃู ูุณู ูุงุญูุงู (ูุซูุงู ุชูุตูู ูู Blueprintุ ุฃู ุฌุฏูู ุงููุณุงุฑุงุช ูุงููุงู) ุญุณุจ ุงูุญุงุฌุฉ.
