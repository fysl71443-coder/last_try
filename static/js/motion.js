(function(){
  const config = { flyingCloneWidth: 68, flyDuration: 0.85, throwDuration: 0.85, particleCount: 14, particleColors: ['#FFD166','#06D6A0','#118AB2','#FB5607'], useGSAP: typeof gsap !== 'undefined' };
  if (config.useGSAP && typeof MotionPathPlugin !== 'undefined') { try{ gsap.registerPlugin(MotionPathPlugin); }catch(_e){} }
  let particleCanvas = null;
  function ensureParticleCanvas(){ if(particleCanvas) return particleCanvas; particleCanvas = document.createElement('canvas'); particleCanvas.className='motion-particles'; particleCanvas.style.pointerEvents='none'; document.body.appendChild(particleCanvas); particleCanvas.width=window.innerWidth; particleCanvas.height=window.innerHeight; window.addEventListener('resize', ()=>{ particleCanvas.width=window.innerWidth; particleCanvas.height=window.innerHeight; }); return particleCanvas; }
  function spawnParticles(x,y,opts){ const colors=(opts&&opts.colors)||config.particleColors; const count=(opts&&opts.count)||config.particleCount; for(let i=0;i<count;i++){ const p=document.createElement('div'); p.className='motion-particle'; const size=6+Math.round(Math.random()*10); p.style.position='fixed'; p.style.left=x+'px'; p.style.top=y+'px'; p.style.width=size+'px'; p.style.height=size+'px'; p.style.borderRadius='50%'; p.style.background=colors[Math.floor(Math.random()*colors.length)]; p.style.zIndex=1300; p.style.pointerEvents='none'; p.style.opacity='0.95'; p.style.transform='translate3d(0,0,0) scale(1)'; document.body.appendChild(p); const ang=Math.random()*Math.PI*2; const dist=40+Math.random()*160; const destX=Math.cos(ang)*dist; const destY=Math.sin(ang)*dist-(30+Math.random()*60); if(config.useGSAP){ try{ gsap.to(p,{duration:0.9+Math.random()*0.6,x:destX,y:destY,opacity:0,scale:0.2,ease:'power2.out',onComplete:()=>{ try{ p.remove(); }catch(_e){} } }); }catch(_e){ } } else { p.style.transition='transform 0.9s ease-out, opacity 0.9s'; requestAnimationFrame(()=>{ p.style.transform=`translate(${destX}px, ${destY}px) scale(0.2)`; p.style.opacity='0'; }); setTimeout(()=>{ try{ p.remove(); }catch(_e){} },1100); } } }
  function centerOfRect(rect){ return { x: rect.left + rect.width/2, y: rect.top + rect.height/2 }; }
  function flyToTarget(sourceEl,targetEl,options,onComplete){ if(!sourceEl||!targetEl){ if(onComplete) onComplete(); return; } const rectFrom=sourceEl.getBoundingClientRect(); const rectTo=targetEl.getBoundingClientRect(); const clone=sourceEl.cloneNode(true); clone.classList.add('flying-clone'); clone.style.width=(rectFrom.width||config.flyingCloneWidth)+'px'; clone.style.height=(rectFrom.height||config.flyingCloneWidth)+'px'; clone.style.left=rectFrom.left+'px'; clone.style.top=rectFrom.top+'px'; clone.style.margin=0; clone.style.transform='none'; clone.style.opacity='1'; document.body.appendChild(clone); const start=centerOfRect(rectFrom); const end=centerOfRect(rectTo); spawnParticles(start.x,start.y,options&&options.particles); if(config.useGSAP && typeof MotionPathPlugin!=='undefined'){ const ctrlX=(start.x+end.x)/2 + (Math.random()>0.5 ? -120 : 120); const ctrlY=Math.min(start.y,end.y) - 120 - Math.random()*60; const path=[ {x:start.x-rectFrom.left,y:start.y-rectFrom.top}, {x:ctrlX-rectFrom.left,y:ctrlY-rectFrom.top}, {x:end.x-rectFrom.left,y:end.y-rectFrom.top} ]; try{ gsap.to(clone,{ duration:(options&&options.duration)||config.flyDuration, motionPath:{ path:path, curviness:1.25, autoRotate:true }, scale:(options&&options.endScale)||0.28, rotation:()=> (Math.random()>0.5?20:-20), ease:'power1.inOut', onComplete:()=>{ try{ targetEl.classList && targetEl.classList.add('invoice-hit'); setTimeout(()=>{ try{ targetEl.classList.remove('invoice-hit'); }catch(_e){} },700); }catch(_e){} spawnParticles(end.x,end.y,options&&options.particles); try{ clone.remove(); }catch(_e){} if(onComplete) onComplete(); } }); }catch(_e){ try{ clone.remove(); }catch(__){} if(onComplete) onComplete(); } } else { const dx=end.x - start.x; const dy=end.y - start.y; const duration=((options&&options.duration)||config.flyDuration)*1000; clone.style.transition=`transform ${duration}ms cubic-bezier(.2,.8,.2,1), opacity ${duration}ms`; requestAnimationFrame(()=>{ clone.style.transform=`translate(${dx}px, ${dy}px) scale(0.28) rotate(20deg)`; clone.style.opacity='0.85'; }); setTimeout(()=>{ try{ targetEl.classList && targetEl.classList.add('invoice-hit'); setTimeout(()=>{ try{ targetEl.classList.remove('invoice-hit'); }catch(_e){} },700); }catch(_e){} spawnParticles(end.x,end.y,options&&options.particles); try{ clone.remove(); }catch(_e){} if(onComplete) onComplete(); }, duration+20); }
  }
  function throwToTrash(sourceEl,trashSelector,options,onComplete){ const trashEl=document.querySelector(trashSelector); if(!sourceEl||!trashEl){ if(onComplete) onComplete(); return; } const rectFrom=sourceEl.getBoundingClientRect(); const rectTo=trashEl.getBoundingClientRect(); const clone=sourceEl.cloneNode(true); clone.classList.add('flying-clone'); clone.style.width=rectFrom.width+'px'; clone.style.height=rectFrom.height+'px'; clone.style.left=rectFrom.left+'px'; clone.style.top=rectFrom.top+'px'; document.body.appendChild(clone); const start=centerOfRect(rectFrom); const end=centerOfRect(rectTo); if(config.useGSAP){ try{ gsap.to(clone,{ duration:(options&&options.duration)||config.throwDuration, x:end.x - start.x, y:end.y - start.y, rotation:720, scale:0.18, ease:'back.in(1.6)', onComplete:()=>{ spawnParticles(end.x,end.y,{count:8}); try{ clone.remove(); }catch(_e){} if(onComplete) onComplete(); } }); }catch(_e){ try{ clone.remove(); }catch(__){} if(onComplete) onComplete(); } } else { const dx=end.x - start.x; const dy=end.y - start.y; const duration=((options&&options.duration)||config.throwDuration)*1000; clone.style.transition=`transform ${duration}ms cubic-bezier(.6,.0,.2,1), opacity ${duration}ms`; requestAnimationFrame(()=>{ clone.style.transform=`translate(${dx}px, ${dy}px) scale(0.18) rotate(360deg)`; clone.style.opacity='0'; }); setTimeout(()=>{ spawnParticles(end.x,end.y,{count:8}); try{ clone.remove(); }catch(_e){} if(onComplete) onComplete(); }, duration+20); }
  }
  function enableButtonInteractions(selector){ document.querySelectorAll(selector||'.btn').forEach(btn=>{ btn.style.position=btn.style.position||'relative'; btn.addEventListener('pointerdown', function(e){ const rect=this.getBoundingClientRect(); const ripple=document.createElement('span'); ripple.className='ripple-effect'; const size=Math.max(rect.width, rect.height)*1.2; ripple.style.width=ripple.style.height=size+'px'; ripple.style.left=(e.clientX - rect.left - size/2)+'px'; ripple.style.top=(e.clientY - rect.top - size/2)+'px'; this.appendChild(ripple); if(config.useGSAP){ try{ gsap.fromTo(ripple,{scale:0,opacity:0.6},{scale:1,opacity:0,duration:0.6,ease:'power1.out',onComplete:()=>{ try{ ripple.remove(); }catch(_e){} }}); }catch(_e){ } } else { ripple.style.transition='transform 0.6s ease, opacity 0.6s'; requestAnimationFrame(()=>{ ripple.style.transform='scale(1)'; ripple.style.opacity='0'; }); setTimeout(()=>{ try{ ripple.remove(); }catch(_e){} },650); } }); }); }
  function enableCardParallax(selector){ document.querySelectorAll(selector||'.dashboard-card, .item-card').forEach(card=>{ card.style.transformStyle='preserve-3d'; card.addEventListener('pointermove', e=>{ const r=card.getBoundingClientRect(); const cx=r.left + r.width/2; const cy=r.top + r.height/2; const dx=(e.clientX - cx)/(r.width/2); const dy=(e.clientY - cy)/(r.height/2); const rotX=(-dy)*6; const rotY=(dx)*8; if(config.useGSAP){ try{ gsap.to(card,{duration:0.35,rotationX:rotX,rotationY:rotY,z:0.01,transformPerspective:600,ease:'power3.out'}); }catch(_e){ } } else { card.style.transform=`perspective(600px) rotateX(${rotX}deg) rotateY(${rotY}deg) translateZ(0) scale(1.02)`; } }); card.addEventListener('pointerleave', ()=>{ if(config.useGSAP){ try{ gsap.to(card,{duration:0.5,rotationX:0,rotationY:0,scale:1,ease:'power3.out'}); }catch(_e){ } } else { card.style.transform=''; } }); }); }
  function staggerIn(selector,opts){ const elems=Array.from(document.querySelectorAll(selector)); elems.forEach((el,i)=>{ const delay=((opts&&opts.delay)||80)*i; if(config.useGSAP){ try{ gsap.fromTo(el,{y:20,opacity:0},{y:0,opacity:1,duration:0.6,delay:delay/1000,ease:'back.out(1.4)'}); }catch(_e){ } } else { el.style.opacity=0; el.style.transform='translateY(20px)'; setTimeout(()=>{ el.style.transition='all 0.6s cubic-bezier(.2,.9,.2,1)'; el.style.opacity=1; el.style.transform='translateY(0)'; }, delay); } }); }
  function initMotion(options){ try{ Object.assign(config, options||{}); }catch(_e){} enableButtonInteractions('.btn'); enableCardParallax('.dashboard-card, .item-card'); staggerIn('.dashboard-card, .item-card, .invoice-item, .table-row, .report-card', { delay: 90 }); document.querySelectorAll('[data-action="add-to-invoice"]').forEach(btn=>{ btn.addEventListener('click', function(){ const source=this.closest('[data-item-id]')||this; const targetSelector=this.dataset.target||'.invoice-container'; const target=document.querySelector(targetSelector); flyToTarget(source,target,{},()=>{ const addFnName=this.dataset.callback; if(addFnName && typeof window[addFnName]==='function'){ try{ window[addFnName](this); }catch(_e){} } }); }); }); document.querySelectorAll('[data-action="delete-item"]').forEach(btn=>{ btn.addEventListener('click', function(){ const itemEl=this.closest('.invoice-item')||this.closest('[data-item-id]'); const trash=this.dataset.trash||'.trash-target'; throwToTrash(itemEl,trash,{},()=>{ try{ if(itemEl && itemEl.parentNode){ itemEl.parentNode.removeChild(itemEl); } }catch(_e){} const cb=this.dataset.callback; if(cb && typeof window[cb]==='function'){ try{ window[cb](this); }catch(__){} } }); }); }); }
  window.MotionUI = { init: initMotion, flyToTarget, throwToTrash, spawnParticles, staggerIn };
  document.addEventListener('DOMContentLoaded', ()=>{ setTimeout(()=>{ try{ initMotion(); }catch(_e){} }, 120); });
})();
